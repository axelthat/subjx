/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _objectWithoutPropertiesLoose(t,e){if(null==t)return{};var r,a,n={},o=Object.keys(t);for(a=0;a<o.length;a++)r=o[a],e.indexOf(r)>=0||(n[r]=t[r]);return n}function _objectWithoutProperties(t,e){if(null==t)return{};var r,a,n=_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)r=o[a],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _createSuper(t){return function(){var e,r=_getPrototypeOf(t);if(_isNativeReflectConstruct()){var a=_getPrototypeOf(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var a=_superPropBase(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],a=!0,n=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){n=!0,o=t}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}return r}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=_unsupportedIterableToArray(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,o=!0,i=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return o=t.done,t},e:function(t){i=!0,n=t},f:function(){try{o||null==a.return||a.return()}finally{if(i)throw n}}}}var requestAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},_Array$prototype=Array.prototype,forEach=_Array$prototype.forEach,arrSlice=_Array$prototype.slice,arrMap=_Array$prototype.map,arrReduce=_Array$prototype.reduce,_console=console,warn=_console.warn,isDef=function(t){return null!=t},isUndef=function(t){return null==t},isFunc=function(t){return"function"==typeof t},createMethod=function(t){return isFunc(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}},Helper=function(){function t(e){if(_classCallCheck(this,t),"string"==typeof e){var r=document.querySelectorAll(e);this.length=r.length;for(var a=0;a<this.length;a++)this[a]=r[a]}else if("object"!==_typeof(e)||1!==e.nodeType&&e!==document)if(e instanceof t){this.length=e.length;for(var n=0;n<this.length;n++)this[n]=e[n]}else{if(!isIterable(e))throw new Error("Passed parameter must be selector/element/elementArray");this.length=e.length;for(var o=0;o<this.length;o++)1===e[o].nodeType&&(this[o]=e[o])}else this[0]=e,this.length=1}return _createClass(t,[{key:"css",value:function(t){var e=function(e){for(var r=e.length;r--;)return e[r].currentStyle?e[r].currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e[r],"")[t]:e[r].style[t]},r=function(t,e){for(var r=t.length;r--;)for(var a in e)t[r].style[a]=e[a];return t.style},a={setStyle:function(t){return r(this,t)},getStyle:function(){return e(this)}};return"string"==typeof t?a.getStyle.apply(this,arrSlice.call(arguments,1)):"object"!==_typeof(t)&&t?(warn("Method ".concat(t," does not exist")),!1):a.setStyle.apply(this,arguments)}},{key:"on",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=arguments[1]:listenerDelegate(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}},{key:"off",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=null:listenerDelegate(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}},{key:"is",value:function(t){if(isUndef(t))return!1;for(var e=helper(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),t}();function listenerDelegate(t,e,r,a,n,o){var i=function(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&a.call(e,t),e=e.parentNode};!0===o?document.addEventListener?t.addEventListener(e,i,n||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,n||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function isIterable(t){return isDef(t)&&"object"===_typeof(t)&&(Array.isArray(t)||isDef(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||isDef(t.forEach)||"number"==typeof t.length&&(0===t.length||t.length>0&&t.length-1 in t))}function helper(t){return new Helper(t)}var MIN_SIZE=2,THEME_COLOR="#00a8ff",LIB_CLASS_PREFIX="sjx-",E_MOUSEDOWN="mousedown",E_MOUSEUP="mouseup",E_MOUSEMOVE="mousemove",E_TOUCHSTART="touchstart",E_TOUCHEND="touchend",E_TOUCHMOVE="touchmove",E_DRAG_START="dragStart",E_DRAG="drag",E_DRAG_END="dragEnd",E_RESIZE_START="resizeStart",E_RESIZE="resize",E_RESIZE_END="resizeEnd",E_ROTATE_START="rotateStart",E_ROTATE="rotate",E_ROTATE_END="rotateEnd",E_SET_POINT_START="setPointStart",E_SET_POINT_END="setPointEnd",EMITTER_EVENTS=[E_DRAG_START,E_DRAG,,E_DRAG_END,E_RESIZE_START,E_RESIZE,E_RESIZE_END,E_ROTATE_START,E_ROTATE,E_ROTATE_END,E_SET_POINT_START,E_SET_POINT_END],CSS_PREFIXES=["","-webkit-","-moz-","-ms-","-o-"],ON_GETSTATE="ongetstate",ON_APPLY="onapply",ON_MOVE="onmove",ON_RESIZE="onresize",ON_ROTATE="onrotate",NOTIFIER_EVENTS=[ON_GETSTATE,ON_APPLY,ON_MOVE,ON_RESIZE,ON_ROTATE],NOTIFIER_CONSTANTS={NOTIFIER_EVENTS:NOTIFIER_EVENTS,ON_GETSTATE:ON_GETSTATE,ON_APPLY:ON_APPLY,ON_MOVE:ON_MOVE,ON_RESIZE:ON_RESIZE,ON_ROTATE:ON_ROTATE},EVENT_EMITTER_CONSTANTS={EMITTER_EVENTS:EMITTER_EVENTS,E_DRAG_START:E_DRAG_START,E_DRAG:E_DRAG,E_DRAG_END:E_DRAG_END,E_RESIZE_START:E_RESIZE_START,E_RESIZE:E_RESIZE,E_RESIZE_END:E_RESIZE_END,E_ROTATE_START:E_ROTATE_START,E_ROTATE:E_ROTATE,E_ROTATE_END:E_ROTATE_END,E_SET_POINT_START:E_SET_POINT_START,E_SET_POINT_END:E_SET_POINT_END},CLIENT_EVENTS_CONSTANTS={E_MOUSEDOWN:E_MOUSEDOWN,E_MOUSEUP:E_MOUSEUP,E_MOUSEMOVE:E_MOUSEMOVE,E_TOUCHSTART:E_TOUCHSTART,E_TOUCHEND:E_TOUCHEND,E_TOUCHMOVE:E_TOUCHMOVE},TRANSFORM_HANDLES_KEYS={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},TRANSFORM_EDGES_KEYS={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},TRANSFORM_HANDLES_CONSTANTS={TRANSFORM_HANDLES_KEYS:TRANSFORM_HANDLES_KEYS,TRANSFORM_EDGES_KEYS:TRANSFORM_EDGES_KEYS},ON_GETSTATE$1=NOTIFIER_CONSTANTS.ON_GETSTATE,ON_APPLY$1=NOTIFIER_CONSTANTS.ON_APPLY,ON_MOVE$1=NOTIFIER_CONSTANTS.ON_MOVE,ON_RESIZE$1=NOTIFIER_CONSTANTS.ON_RESIZE,ON_ROTATE$1=NOTIFIER_CONSTANTS.ON_ROTATE,Observable=function(){function t(){_classCallCheck(this,t),this.observers={}}return _createClass(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return isUndef(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(isDef(r[t])){var a=r[t].indexOf(e);r[t].splice(a,1)}return this}},{key:"notify",value:function(t,e,r){isUndef(this.observers[t])||this.observers[t].forEach((function(a){if(e!==a)switch(t){case ON_MOVE$1:a.notifyMove(r);break;case ON_ROTATE$1:a.notifyRotate(r);break;case ON_RESIZE$1:a.notifyResize(r);break;case ON_APPLY$1:a.notifyApply(r);break;case ON_GETSTATE$1:a.notifyGetState(r)}}))}}]),t}(),Event=function(){function t(e){_classCallCheck(this,t),this.name=e,this.callbacks=[]}return _createClass(t,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),t}(),EventDispatcher=function(){function t(){_classCallCheck(this,t),this.events={}}return _createClass(t,[{key:"registerEvent",value:function(t){this.events[t]=new Event(t)}},{key:"emit",value:function(t,e,r){this.events[e].callbacks.forEach((function(e){e.call(t,r)}))}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),E_DRAG$1=EVENT_EMITTER_CONSTANTS.E_DRAG,E_MOUSEMOVE$1=CLIENT_EVENTS_CONSTANTS.E_MOUSEMOVE,E_MOUSEUP$1=CLIENT_EVENTS_CONSTANTS.E_MOUSEUP,E_TOUCHMOVE$1=CLIENT_EVENTS_CONSTANTS.E_TOUCHMOVE,E_TOUCHEND$1=CLIENT_EVENTS_CONSTANTS.E_TOUCHEND,SubjectModel=function(){function t(e){_classCallCheck(this,t),this.el=e,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new EventDispatcher,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return _createClass(t,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){throwNotImplementedError()}},{key:"_init",value:function(){throwNotImplementedError()}},{key:"_destroy",value:function(){throwNotImplementedError()}},{key:"_processOptions",value:function(){throwNotImplementedError()}},{key:"_start",value:function(){throwNotImplementedError()}},{key:"_moving",value:function(){throwNotImplementedError()}},{key:"_end",value:function(){throwNotImplementedError()}},{key:"_animate",value:function(){throwNotImplementedError()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,a=_objectWithoutProperties(t,["dx","dy"]),n=_objectSpread2({dx:e,dy:r,transform:this._processMove(e,r)},a);this.proxyMethods.onMove.call(this,n),this._emitEvent(E_DRAG$1,n)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),helper(document).on(E_MOUSEMOVE$1,this._onMouseMove).on(E_MOUSEUP$1,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),helper(document).on(E_TOUCHMOVE$1,this._onTouchMove).on(E_TOUCHEND$1,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){helper(document).off(E_MOUSEMOVE$1,this._onMouseMove).off(E_MOUSEUP$1,this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){helper(document).off(E_TOUCHMOVE$1,this._onTouchMove).off(E_TOUCHEND$1,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),t}(),throwNotImplementedError=function(){throw Error("Method not implemented")},RAD=Math.PI/180,snapCandidate=function(t,e){return 0===e?t:Math.round(t/e)*e},snapToGrid=function(t,e){if(0===e)return t;var r=snapCandidate(t,e);return r-t<e?r:void 0},floatToFixed=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return Number(t.toFixed(e))},getMinMaxOf2DIndex=function(t,e){var r=t.map((function(t){return t[e]}));return[Math.min.apply(Math,_toConsumableArray(r)),Math.max.apply(Math,_toConsumableArray(r))]},getOffset=function(t){return t.getBoundingClientRect()},addClass=function(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach((function(e){return t.classList.add(e)}))}return t}},removeClass=function(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach((function(e){return t.classList.remove(e)}))}return t}},objectsCollide=function(t,e){var r=getOffset(t),a=r.top,n=r.left,o=getOffset(e),i=o.top,s=o.left,l=helper(t),c=helper(e);return!(a<i||a+parseFloat(l.css("height"))>i+parseFloat(c.css("height"))||n<s||n+parseFloat(l.css("width"))>s+parseFloat(c.css("width")))},matrixToCSS=function(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}},getStyle=function(t,e){var r,a=window.getComputedStyle(t),n=null,o=_createForOfIteratorHelper(CSS_PREFIXES);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(n=a.getPropertyValue("".concat(i).concat(e))||n)break}}catch(t){o.e(t)}finally{o.f()}return n},NOTIFIER_EVENTS$1=NOTIFIER_CONSTANTS.NOTIFIER_EVENTS,ON_GETSTATE$2=NOTIFIER_CONSTANTS.ON_GETSTATE,ON_APPLY$2=NOTIFIER_CONSTANTS.ON_APPLY,ON_MOVE$2=NOTIFIER_CONSTANTS.ON_MOVE,ON_RESIZE$2=NOTIFIER_CONSTANTS.ON_RESIZE,ON_ROTATE$2=NOTIFIER_CONSTANTS.ON_ROTATE,EMITTER_EVENTS$1=EVENT_EMITTER_CONSTANTS.EMITTER_EVENTS,E_DRAG_START$1=EVENT_EMITTER_CONSTANTS.E_DRAG_START,E_DRAG$2=EVENT_EMITTER_CONSTANTS.E_DRAG,E_DRAG_END$1=EVENT_EMITTER_CONSTANTS.E_DRAG_END,E_RESIZE_START$1=EVENT_EMITTER_CONSTANTS.E_RESIZE_START,E_RESIZE$1=EVENT_EMITTER_CONSTANTS.E_RESIZE,E_RESIZE_END$1=EVENT_EMITTER_CONSTANTS.E_RESIZE_END,E_ROTATE_START$1=EVENT_EMITTER_CONSTANTS.E_ROTATE_START,E_ROTATE$1=EVENT_EMITTER_CONSTANTS.E_ROTATE,E_ROTATE_END$1=EVENT_EMITTER_CONSTANTS.E_ROTATE_END,TRANSFORM_HANDLES_KEYS$1=TRANSFORM_HANDLES_CONSTANTS.TRANSFORM_HANDLES_KEYS,TRANSFORM_EDGES_KEYS$1=TRANSFORM_HANDLES_CONSTANTS.TRANSFORM_EDGES_KEYS,E_MOUSEDOWN$1=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$1=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,E_MOUSEMOVE$2=CLIENT_EVENTS_CONSTANTS.E_MOUSEMOVE,E_MOUSEUP$2=CLIENT_EVENTS_CONSTANTS.E_MOUSEUP,E_TOUCHMOVE$2=CLIENT_EVENTS_CONSTANTS.E_TOUCHMOVE,E_TOUCHEND$2=CLIENT_EVENTS_CONSTANTS.E_TOUCHEND,TOP_LEFT=TRANSFORM_HANDLES_KEYS$1.TOP_LEFT,TOP_CENTER=TRANSFORM_HANDLES_KEYS$1.TOP_CENTER,TOP_RIGHT=TRANSFORM_HANDLES_KEYS$1.TOP_RIGHT,BOTTOM_LEFT=TRANSFORM_HANDLES_KEYS$1.BOTTOM_LEFT,BOTTOM_RIGHT=TRANSFORM_HANDLES_KEYS$1.BOTTOM_RIGHT,BOTTOM_CENTER=TRANSFORM_HANDLES_KEYS$1.BOTTOM_CENTER,MIDDLE_LEFT=TRANSFORM_HANDLES_KEYS$1.MIDDLE_LEFT,MIDDLE_RIGHT=TRANSFORM_HANDLES_KEYS$1.MIDDLE_RIGHT,TOP_EDGE=TRANSFORM_EDGES_KEYS$1.TOP_EDGE,BOTTOM_EDGE=TRANSFORM_EDGES_KEYS$1.BOTTOM_EDGE,LEFT_EDGE=TRANSFORM_EDGES_KEYS$1.LEFT_EDGE,RIGHT_EDGE=TRANSFORM_EDGES_KEYS$1.RIGHT_EDGE,Transformable=function(t){_inherits(r,SubjectModel);var e=_createSuper(r);function r(t,a,n){var o;if(_classCallCheck(this,r),(o=e.call(this,t)).constructor===r)throw new TypeError("Cannot construct Transformable instances directly");return o.observable=n,EMITTER_EVENTS$1.forEach((function(t){return o.eventDispatcher.registerEvent(t)})),_get(_getPrototypeOf(r.prototype),"enable",_assertThisInitialized(o)).call(_assertThisInitialized(o),a),o}return _createClass(r,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,a=_objectWithoutProperties(t,["radians"]),n=_objectSpread2({transform:this._processRotate(e),delta:e},a);this.proxyMethods.onRotate.call(this,n),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_ROTATE$1,n)}},{key:"_resize",value:function(t){var e=t.dx,a=t.dy,n=_objectWithoutProperties(t,["dx","dy"]),o=_objectSpread2({},this._processResize(e,a),{dx:e,dy:a},n);this.proxyMethods.onResize.call(this,o),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_RESIZE$1,o)}},{key:"_processOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.el;addClass(e,"".concat(LIB_CLASS_PREFIX,"drag"));var r=t.each,a=void 0===r?{move:!1,resize:!1,rotate:!1}:r,n=t.snap,o=void 0===n?{x:10,y:10,angle:10}:n,i=t.axis,s=void 0===i?"xy":i,l=t.cursorMove,c=void 0===l?"auto":l,u=t.cursorResize,h=void 0===u?"auto":u,f=t.cursorRotate,_=void 0===f?"auto":f,T=t.rotationPoint,p=void 0!==T&&T,d=t.restrict,E=t.draggable,y=void 0===E||E,v=t.resizable,x=void 0===v||v,m=t.rotatable,b=void 0===m||m,S=t.scalable,g=void 0!==S&&S,O=t.applyTranslate,M=void 0!==O&&O,A=t.onInit,N=void 0===A?function(){}:A,R=t.onDrop,C=void 0===R?function(){}:R,D=t.onMove,I=void 0===D?function(){}:D,k=t.onResize,w=void 0===k?function(){}:k,P=t.onRotate,V=void 0===P?function(){}:P,L=t.onDestroy,$=void 0===L?function(){}:L,j=t.container,F=void 0===j?e.parentNode:j,G=t.controlsContainer,H=void 0===G?F:G,U=t.proportions,Y=void 0!==U&&U,X=t.rotatorAnchor,B=void 0===X?null:X,z=t.rotatorOffset,W=void 0===z?50:z,Z=t.showNormal,K=void 0===Z||Z,q=t.custom;this.options={axis:s,cursorMove:c,cursorRotate:_,cursorResize:h,rotationPoint:p,restrict:d?helper(d)[0]||document.body:null,container:helper(F)[0],controlsContainer:helper(H)[0],snap:_objectSpread2({},o,{angle:o.angle*RAD}),each:a,proportions:Y,draggable:y,resizable:x,rotatable:b,scalable:g,applyTranslate:M,custom:"object"===_typeof(q)&&q||null,rotatorAnchor:B,rotatorOffset:W,showNormal:K},this.proxyMethods={onInit:createMethod(N),onDrop:createMethod(C),onMove:createMethod(I),onResize:createMethod(w),onRotate:createMethod(V),onDestroy:createMethod($)},this.subscribe(a)}},{key:"_animate",value:function(){var t=this.observable,e=this.storage,a=this.options;if(!isUndef(e)&&(e.frame=requestAnimFrame(this._animate),e.doDraw)){e.doDraw=!1;var n=e.dox,o=e.doy,i=e.clientX,s=e.clientY,l=e.doDrag,c=e.doResize,u=e.doRotate,h=e.doSetCenter,f=e.revX,_=e.revY,T=a.snap,p=a.each,d=p.move,E=p.resize,y=p.rotate,v=a.draggable,x=a.resizable,m=a.rotatable;if(c&&x){var b=e.transform,S=b.scX,g=b.scY,O=e.cx,M=e.cy,A=this._pointToElement({x:i,y:s}),N=A.x,R=A.y,C=n?snapToGrid(N-O,T.x/S):0,D=o?snapToGrid(R-M,T.y/g):0,I={dx:C=n?f?-C:C:0,dy:D=o?_?-D:D:0,clientX:i,clientY:s};this._resize(I),E&&t.notify(ON_RESIZE$2,this,I)}if(l&&v){var k=e.nx,w=e.ny,P={dx:n?snapToGrid(i-k,T.x):0,dy:o?snapToGrid(s-w,T.y):0,clientX:i,clientY:s};_get(_getPrototypeOf(r.prototype),"_drag",this).call(this,P),d&&t.notify(ON_MOVE$2,this,P)}if(u&&m){var V=e.pressang,L=e.center,$=Math.atan2(s-L.y,i-L.x)-V,j={clientX:i,clientY:s};this._rotate(_objectSpread2({radians:snapToGrid($,T.angle)},j)),y&&t.notify(ON_ROTATE$2,this,_objectSpread2({radians:$},j))}if(h&&m){var F=e.bx,G=e.by,H=this._pointToControls({x:i,y:s}),U=H.x,Y=H.y;this._moveCenterHandle(U-F,Y-G)}}}},{key:"_start",value:function(t){var e=t.clientX,a=t.clientY,n=this.observable,o=this.storage,i=this.storage.handles,s=this.options,l=s.axis,c=s.each,u=this.el,h=Object.values(i).some((function(e){return helper(t.target).is(e)}))||u.contains(t.target);if(o.isTarget=h,h){var f=this._compute(t,u);Object.keys(f).map((function(t){return o[t]=f[t]}));var _=f.onRightEdge,T=f.onBottomEdge,p=f.onTopEdge,d=f.onLeftEdge,E=f.handle,y=f.factor,v=f.revX,x=f.revY,m=f.doW,b=f.doH,S=_||T||p||d,g=i.rotator,O=i.center,M=i.radius;isDef(M)&&removeClass(M,"".concat(LIB_CLASS_PREFIX,"hidden"));var A=E.is(g),N=!!isDef(O)&&E.is(O),R=u.contains(t.target)&&!(A||S||N),C=this._cursorPoint({clientX:e,clientY:a}),D=C.x,I=C.y,k=this._pointToElement({x:D,y:I}),w=k.x,P=k.y,V=this._pointToControls({x:D,y:I}),L={clientX:e,clientY:a,cx:w,cy:P,nx:D,ny:I,bx:V.x,by:V.y,doResize:S,doDrag:R,doRotate:A,doSetCenter:N,onExecution:!0,cursor:null,dox:/\x/.test(l)&&(!S||(E.is(i.ml)||E.is(i.mr)||E.is(i.tl)||E.is(i.tr)||E.is(i.bl)||E.is(i.br)||E.is(i.le)||E.is(i.re))),doy:/\y/.test(l)&&(!S||(E.is(i.br)||E.is(i.bl)||E.is(i.bc)||E.is(i.tr)||E.is(i.tl)||E.is(i.tc)||E.is(i.te)||E.is(i.be))),cached:{}};this.storage=_objectSpread2({},o,{},L);var $={clientX:e,clientY:a};S?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_RESIZE_START$1,$):A?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_ROTATE_START$1,$):R&&_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_DRAG_START$1,$);var j=c.move,F=c.resize,G=c.rotate,H=S?E_RESIZE$1:A?E_ROTATE$1:E_DRAG$2,U=S&&F||A&&G||R&&j;n.notify(ON_GETSTATE$2,this,{clientX:e,clientY:a,actionName:H,triggerEvent:U,factor:y,revX:v,revY:x,doW:m,doH:b}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,a=this.options;if(r.isTarget){var n=this._cursorPoint(t),o=n.x,i=n.y;r.e=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,l=r.doDrag,c=r.doResize,u=r.cursor,h=a.cursorMove,f=a.cursorResize,_=a.cursorRotate;isUndef(u)&&(l?u=h:s?u=_:c&&(u=f),helper(document.body).css({cursor:u}))}}},{key:"_end",value:function(t){var e=t.clientX,a=t.clientY,n=this.options.each,o=this.observable,i=this.storage,s=this.storage,l=s.doResize,c=s.doDrag,u=s.doRotate,h=s.frame,f=s.handles.radius,_=s.isTarget,T=this.proxyMethods;if(_){var p=l?E_RESIZE$1:c?E_DRAG$2:E_ROTATE$1;i.doResize=!1,i.doDrag=!1,i.doRotate=!1,i.doSetCenter=!1,i.doDraw=!1,i.onExecution=!1,i.cursor=null,this._apply(p);var d={clientX:e,clientY:a};T.onDrop.call(this,d),l?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_RESIZE_END$1,d):u?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_ROTATE_END$1,d):c&&_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_DRAG_END$1,d);var E=n.move,y=n.resize,v=n.rotate,x=l&&y||u&&v||c&&E;o.notify(ON_APPLY$2,this,{clientX:e,clientY:a,actionName:p,triggerEvent:x}),cancelAnimFrame(h),helper(document.body).css({cursor:"auto"}),isDef(f)&&addClass(f,"".concat(LIB_CLASS_PREFIX,"hidden"))}}},{key:"_compute",value:function(t,e){var r=this.storage.handles,a=helper(t.target),n=this._checkHandles(a,r),o=n.revX,i=n.revY,s=n.doW,l=n.doH,c=_objectWithoutProperties(n,["revX","revY","doW","doH"]),u=this._getState({revX:o,revY:i,doW:s,doH:l}),h=this._cursorPoint(t),f=h.x,_=h.y,T=Math.atan2(_-u.center.y,f-u.center.x);return _objectSpread2({},u,{},c,{handle:Object.values(r).some((function(e){return helper(t.target).is(e)}))?a:helper(e),pressang:T})}},{key:"_checkHandles",value:function(t,e){var r=function(r){return r.some((function(r){return a=e[r],!!isDef(a)&&t.is(a);var a}))};return{revX:r([TOP_LEFT,MIDDLE_LEFT,BOTTOM_LEFT,TOP_CENTER,LEFT_EDGE]),revY:r([TOP_LEFT,TOP_RIGHT,TOP_CENTER,MIDDLE_LEFT,TOP_EDGE]),onTopEdge:r([TOP_CENTER,TOP_RIGHT,TOP_LEFT,TOP_EDGE]),onLeftEdge:r([TOP_LEFT,MIDDLE_LEFT,BOTTOM_LEFT,LEFT_EDGE]),onRightEdge:r([TOP_RIGHT,MIDDLE_RIGHT,BOTTOM_RIGHT,RIGHT_EDGE]),onBottomEdge:r([BOTTOM_RIGHT,BOTTOM_CENTER,BOTTOM_LEFT,BOTTOM_EDGE]),doW:r([MIDDLE_LEFT,MIDDLE_RIGHT,LEFT_EDGE,RIGHT_EDGE]),doH:r([TOP_CENTER,BOTTOM_CENTER,BOTTOM_EDGE,TOP_EDGE])}}},{key:"_destroy",value:function(){var t=this,e=this.el,r=this.storage,a=r.controls,n=r.wrapper;[e,a].map((function(e){return helper(e).off(E_MOUSEDOWN$1,t._onMouseDown).off(E_TOUCHSTART$1,t._onTouchStart)})),n.parentNode.removeChild(n)}},{key:"notifyMove",value:function(){_get(_getPrototypeOf(r.prototype),"_drag",this).apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=_objectWithoutProperties(t,["radians"]),a=this.options.snap.angle;this._rotate(_objectSpread2({radians:snapToGrid(e,a)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,a=t.clientY,n=t.actionName,o=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:a}),o&&(this._apply(n),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,"".concat(n,"End"),{clientX:e,clientY:a}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,a=t.clientY,n=t.actionName,o=t.triggerEvent,i=_objectWithoutProperties(t,["clientX","clientY","actionName","triggerEvent"]);if(o){var s=this._getState(i);this.storage=_objectSpread2({},this.storage,{},s),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,"".concat(n,"Start"),{clientX:e,clientY:a})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,a=t.rotate,n=this.observable;(r||e||a)&&n.subscribe(ON_GETSTATE$2,this).subscribe(ON_APPLY$2,this),r&&n.subscribe(ON_MOVE$2,this),e&&n.subscribe(ON_RESIZE$2,this),a&&n.subscribe(ON_ROTATE$2,this)}},{key:"unsubscribe",value:function(){var t=this,e=this.observable;NOTIFIER_EVENTS$1.map((function(r){return e.unsubscribe(r,t)}))}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;isUndef(t)||(t.onExecution&&helper(document).off(E_MOUSEMOVE$2,this._onMouseMove).off(E_MOUSEUP$2,this._onMouseUp).off(E_TOUCHMOVE$2,this._onTouchMove).off(E_TOUCHEND$2,this._onTouchEnd),removeClass(r,"".concat(LIB_CLASS_PREFIX,"drag")),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,a=t.dy;this.options.draggable&&(this.storage=_objectSpread2({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),_get(_getPrototypeOf(r.prototype),"_drag",this).call(this,{dx:e,dy:a}),this._apply(E_DRAG$2))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,a=t.revX,n=void 0!==a&&a,o=t.revY,i=void 0!==o&&o,s=t.doW,l=void 0!==s&&s,c=t.doH,u=void 0!==c&&c;this.options.resizable&&(this.storage=_objectSpread2({},this.storage,{},this._getState({revX:n,revY:i,doW:l,doH:u})),this._resize({dx:e,dy:r}),this._apply(E_RESIZE$1))}},{key:"exeRotate",value:function(t){var e=t.delta;this.options.rotatable&&(this.storage=_objectSpread2({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:e}),this._apply(E_ROTATE$1))}}]),r}(),cloneMatrix=function(t){return t.map((function(t){return _toConsumableArray(t)}))},flatMatrix=function(t){return t.reduce((function(e,r,a){return[].concat(_toConsumableArray(e),[t[0][a],t[1][a],t[2][a],t[3][a]])}),[])},createIdentityMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return _toConsumableArray(Array(t)).map((function(t,e,r){return r.map((function(){return+!e--}))}))},createTranslateMatrix=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return createIdentityMatrix().map((function(a,n){return a[3]=[t,e,r,1][n],a}))},createScaleMatrix=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return createIdentityMatrix().map((function(n,o){return n[o]=[t,e,r,a][o],n}))},createRotateMatrix=function(t,e){var r=createIdentityMatrix();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r},dropTranslate=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e?cloneMatrix(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r},multiplyMatrixAndPoint=function(t,e){for(var r=[],a=0,n=t.length;a<n;++a){for(var o=0,i=0;i<n;++i)o+=+t[a][i]*e[i];r[a]=o}return r},multiplyMatrix=function(t,e){for(var r=[],a=0;a<e.length;a++){r[a]=[];for(var n=0;n<t[0].length;n++){for(var o=0,i=0;i<t.length;i++)o+=t[i][n]*e[a][i];r[a].push(o)}}return r},matrixInvert=function(t){for(var e,r=cloneMatrix(t),a=r.length,n=[],o=0;o<a;o++)n[o]=[];for(var i=0;i<a;i++)for(var s=0;s<a;s++)n[i][s]=0,i==s&&(n[i][s]=1);for(var l=0;l<a;l++){e=r[l][l];for(var c=0;c<a;c++)r[l][c]/=e,n[l][c]/=e;for(var u=l+1;u<a;u++){e=r[u][l];for(var h=0;h<a;h++)r[u][h]-=r[l][h]*e,n[u][h]-=n[l][h]*e}}for(var f=a-1;f>0;f--)for(var _=f-1;_>=0;_--){e=r[_][f];for(var T=0;T<a;T++)r[_][T]-=r[f][T]*e,n[_][T]-=n[f][T]*e}for(var p=0;p<a;p++)for(var d=0;d<a;d++)r[p][d]=n[p][d];return r},computeTransformMatrix=function(t,e){var r=_slicedToArray(e,3),a=r[0],n=r[1],o=r[2],i=createTranslateMatrix(-a,-n,-o),s=createTranslateMatrix(a,n,o);return multiplyMatrix(multiplyMatrix(i,t),s)},getCurrentTransformMatrix=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=arguments.length>2?arguments[2]:void 0,a=createIdentityMatrix(),n=t,o=r||getTransform(n),i=!1;n&&n instanceof Element;){var s=getTransformOrigin(n,i);if(a=multiplyMatrix(a,computeTransformMatrix(o,s)),i=!0,n===e||null===n.offsetParent)break;n=n.offsetParent,o=getTransform(n)}return a},decompose=function(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),a=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]),n=Math.atan2(-t[0][3]/a,t[1][3]/a),o=Math.asin(t[3][1]/a),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(n=0,o=t[0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:n,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/a},scale:{sX:e,sY:r,sZ:a}}},getTransform=function(t){var e=getStyle(t,"transform")||"none",r=createIdentityMatrix();if("none"===e)return r;var a=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==a.length)return[[+a[0],+a[2],0,+a[4]],[+a[1],+a[3],0,+a[5]],[0,0,1,0],[0,0,0,1]];for(var n=0;n<4;++n)for(var o=0;o<4;++o)r[o][n]=+a[4*n+o];return r},getTransformOrigin=function(t,e){for(var r=getStyle(t,"transform-origin"),a=r?r.split(" "):[],n=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1],o=0;o<a.length;++o)n[o]+=parseFloat(a[o]);return n},getAbsoluteOffset=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=0,a=0,n=!1;t;){var o=getCurrentTransformMatrix(t.offsetParent),i=multiplyMatrixAndPoint(dropTranslate(o,!1),[t.offsetLeft+(n?t.clientLeft:0),t.offsetTop+(n?t.clientTop:0),0,1]),s=_slicedToArray(i,2),l=s[0],c=s[1];if(a+=l,r+=c,e===t)break;n=!0,t=t.offsetParent}return[a,r,0,1]},E_MOUSEDOWN$2=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$2=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,Draggable=function(t){_inherits(r,Transformable);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r,[{key:"_init",value:function(t){var e=this,r=this.options,a=r.rotationPoint,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,l=r.showNormal,c=r.rotatorOffset,u=r.rotatorAnchor,h=t.offsetHeight,f=t.offsetWidth,_=createElement(["sjx-wrapper"]),T=createElement(["sjx-controls"]),p={},d=getCurrentTransformMatrix(t,n),E=_slicedToArray(getAbsoluteOffset(t,n),2),y=E[0],v=E[1],x=["data-sjx-cx","data-sjx-cy"].map((function(e){var r=t.getAttribute(e);return isDef(r)?Number(r):void 0})),m=x.every((function(t){return!isNaN(t)})),b={tl:[0,0,0,1],bl:[0,h,0,1],br:[f,h,0,1],tr:[f,0,0,1],tc:[f/2,0,0,1],ml:[0,h/2,0,1],bc:[f/2,h,0,1],mr:[f,h/2,0,1],center:[f/2,h/2,0,1]},S=Object.entries(b).reduce((function(t,e){var r=_slicedToArray(e,2),a=r[0],n=r[1];return[].concat(_toConsumableArray(t),[[a,multiplyMatrixAndPoint(d,n)]])}),[]).reduce((function(t,e){var r=_slicedToArray(e,2),a=r[0],n=_slicedToArray(r[1],4),o=n[0],i=n[1],s=n[2],l=n[3];return t[a]=[o+y,i+v,s,l],t}),{}),g={},O=null;if(s){var M={},A=1;switch(u){case"n":M.x=S.tc[0],M.y=S.tc[1];break;case"s":M.x=S.bc[0],M.y=S.bc[1],A=-1;break;case"w":M.x=S.ml[0],M.y=S.ml[1],A=-1;break;case"e":default:M.x=S.mr[0],M.y=S.mr[1]}var N="n"===u||"s"===u?Math.atan2(S.bl[1]-S.tl[1],S.bl[0]-S.tl[0]):Math.atan2(S.tl[1]-S.tr[1],S.tl[0]-S.tr[0]);O=[M.x-c*A*Math.cos(N),M.y-c*A*Math.sin(N)];var R=l?renderLine([[M.x,M.y],O],"normal"):null;l&&T.appendChild(R);var C=null;a&&(C=renderLine([S.center,S.center],"radius"),addClass(C,"sjx-hidden"),T.appendChild(C)),g=_objectSpread2({},g,{normal:R,radius:C})}var D={te:[S.tl,S.tr],be:[S.bl,S.br],le:[S.tl,S.bl],re:[S.tr,S.br]},I=i?{tl:S.tl,tr:S.tr,br:S.br,bl:S.bl,tc:S.tc,bc:S.bc,ml:S.ml,mr:S.mr}:{},k=m?[].concat(_toConsumableArray(x),[0,1]):S.center,w=_objectSpread2({},I,{center:a&&s?k:void 0,rotator:O}),P=function(t,e){return Object.keys(t).map((function(r){var a=t[r];if(!isUndef(a)){var n=e(a,r);p[r]=n,T.appendChild(n)}}))};P(D,renderLine),P(w,createHandler),_.appendChild(T),o.appendChild(_),this.storage={wrapper:_,controls:T,handles:_objectSpread2({},p,{},g),parent:t.parentNode,center:{isShifted:m},transform:{ctm:d},box:{width:f,height:h,left:y,top:v},cached:{}},[t,T].map((function(t){return helper(t).on(E_MOUSEDOWN$2,e._onMouseDown).on(E_TOUCHSTART$2,e._onTouchStart)}))}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,a=this.storage.transform.ctm,n=matrixInvert(a);return this._applyMatrixToPoint(dropTranslate(n,!1),e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,a=this.storage.transform.wrapperMatrix,n=matrixInvert(a);return this._applyMatrixToPoint(dropTranslate(n,!1),e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var a=_slicedToArray(multiplyMatrixAndPoint(t,[e,r,0,1]),2);return{x:a[0],y:a[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,a=this.options.container,n=getCurrentTransformMatrix(a);return this._applyMatrixToPoint(matrixInvert(n),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,a=r.restrict,n=r.container,o=null,i=null,s=_getBoundingRect(a,n,e),l=this.getBoundingRect(t),c=_slicedToArray(getMinMaxOf2DIndex(s,0),2),u=c[0],h=c[1],f=_slicedToArray(getMinMaxOf2DIndex(s,1),2),_=f[0],T=f[1],p=0,d=l.length;p<d;p++){var E=_slicedToArray(l[p],2),y=E[0],v=E[1];(y<u||y>h)&&(o=y),(v<_||v>T)&&(i=v)}return{x:o,y:i}}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.cached,a=e.controls,n=e.transform.matrix,o=e.center,i=this.options.applyTranslate,s=helper(a);if(!isUndef(r)){if(t.setAttribute("data-sjx-cx",o.elX),t.setAttribute("data-sjx-cy",o.elY),i){var l=helper(t),c=r.dx,u=r.dy,h=matrixToCSS(n),f=parseFloat(t.style.left||l.css("left")),_=parseFloat(t.style.top||l.css("top"));h.left="".concat(f+c,"px"),h.top="".concat(_+u,"px"),l.css(h),s.css(h)}this.storage.cached={}}}},{key:"_processResize",value:function(t,e){var r=this.el,a=this.storage,n=this.storage,o=n.transform,i=o.matrix,s=o.auxiliary.scale.translateMatrix,l=n.cached,c=(l=void 0===l?{}:l).dist,u=(c=void 0===c?{}:c).dx,h=void 0===u?t:u,f=c.dy,_=void 0===f?e:f,T=n.box,p=T.width,d=T.height,E=n.revX,y=n.revY,v=n.doW,x=n.doH,m=this.options,b=m.proportions,S=m.scalable,g=m.restrict,O=function(t,e){var r=v||!v&&!x?(p+t)/p:(d+e)/d,a=b?p*r:p+t,n=b?d*r:d+e;return[a/p,n/d,a,n]},M=function(t,e){var r=createScaleMatrix(t,e);return multiplyMatrix(multiplyMatrix(s,r),matrixInvert(s))},A=function(t,e){var r=t[0][3],a=t[1][3],n=createTranslateMatrix(r,a),o=createTranslateMatrix(r*(E?-1:1),a*(y?-1:1));return multiplyMatrix(multiplyMatrix(o,e),matrixInvert(n))},N=_slicedToArray(O(t,e),4),R=N[0],C=N[1],D=N[2],I=N[3],k=M(R,C),w=S?multiplyMatrix(k,i):A(k,i);this.storage.cached.box={width:D,height:I};var P=g?this._restrictHandler(w):{x:null,y:null},V=P.x,L=P.y,$=(null!==V||null!==L)&&g,j=$?h:t,F=$?_:e,G=_slicedToArray(O(j,F),4),H=G[0],U=G[1],Y=G[2],X=G[3],B=M(H,U),z=S?multiplyMatrix(B,i):A(B,i);return Y<=MIN_SIZE||X<=MIN_SIZE?{transform:z,width:Y,height:X}:(helper(r).css(_objectSpread2({},matrixToCSS(flatMatrix(z)),{},!S&&{width:"".concat(Y,"px"),height:"".concat(X,"px")})),applyTransformToHandles(a,this.options,{el:r,boxMatrix:z}),a.cached.dist={dx:j,dy:F},{transform:z,width:Y,height:X})}},{key:"_processMove",value:function(t,e){var r=this.el,a=this.storage,n=this.storage,o=n.wrapper,i=n.transform,s=i.matrix,l=i.wrapperMatrix,c=i.auxiliary.translate.parentMatrix,u=n.center,h=n.cached,f=(h=void 0===h?{}:h).dist,_=(f=void 0===f?{}:f).dx,T=void 0===_?t:_,p=f.dy,d=void 0===p?e:p,E=this.options.restrict,y=_slicedToArray(multiplyMatrixAndPoint(c,[t,e,0,1]),2),v=y[0],x=y[1],m=multiplyMatrix(s,createTranslateMatrix(v,x)),b=E?this._restrictHandler(m):{x:null,y:null},S=null!==b.x&&E?T:t,g=null!==b.y&&E?d:e,O=_slicedToArray(multiplyMatrixAndPoint(c,[S,g,0,1]),2),M=O[0],A=O[1],N=multiplyMatrix(s,createTranslateMatrix(M,A)),R=multiplyMatrix(l,createTranslateMatrix(S,g)),C=matrixToCSS(flatMatrix(N)),D=matrixToCSS(flatMatrix(R));return helper(r).css(C),helper(o).css(D),a.cached.dist={dx:S,dy:g,ox:M,oy:A},u.isShifted,N}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage.transform,a=r.matrix,n=r.auxiliary.rotate.translateMatrix,o=this.options.restrict,i=floatToFixed(Math.cos(t),4),s=floatToFixed(Math.sin(t),4),l=createRotateMatrix(s,i),c=multiplyMatrix(multiplyMatrix(matrixInvert(n),l),n),u=multiplyMatrix(a,c),h=o?this._restrictHandler(u):{x:null,y:null},f=h.x,_=h.y;return isDef(f)||isDef(_)?u:(helper(e).css(matrixToCSS(flatMatrix(u))),applyTransformToHandles(this.storage,this.options,{el:e,boxMatrix:u}),u)}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,a=t.doW,n=t.doH,o=this.el,i=this.storage,s=i.handles.center,l=i.parent,c=i.wrapper,u=i.center,h=this.options,f=h.container,_=h.restrict,T=h.scalable,p=_||f,d=p.offsetWidth,E=p.offsetHeight,y=_slicedToArray(getAbsoluteOffset(o,f),2),v=y[0],x=y[1],m=o.offsetLeft,b=o.offsetTop,S=o.offsetWidth,g=o.offsetHeight,O=getTransform(o),M=getCurrentTransformMatrix(o,f),A=getCurrentTransformMatrix(l,f),N=getCurrentTransformMatrix(c,f),R=_?getCurrentTransformMatrix(_,_.parentNode):getCurrentTransformMatrix(f,f.parentNode),C=S/2,D=g/2,I=n?0:e?-C:C,k=a?0:r?-D:D,w=_slicedToArray(multiplyMatrixAndPoint(M,[C,D,0,1]),2),P=w[0]+v,V=w[1]+x,L=s?getTransform(s):createIdentityMatrix(),$=(s?decompose(getCurrentTransformMatrix(s)):{translate:{x:P,y:V}}).translate,j=$.x,F=$.y,G=_slicedToArray(multiplyMatrixAndPoint(multiplyMatrix(matrixInvert(dropTranslate(M)),dropTranslate(L)),[j-P,F-V,0,1]),2),H=G[0],U=G[1],Y=_slicedToArray(multiplyMatrixAndPoint(O,[H,U,0,1]),2),X=Y[0],B=Y[1],z=multiplyMatrixAndPoint(dropTranslate(R),[d,E,0,1]),W=decompose(getCurrentTransformMatrix(o,o.parentNode)).scale,Z=W.sX,K=W.sY;return{transform:{auxiliary:{scale:{translateMatrix:T?createTranslateMatrix(I,k):createTranslateMatrix(n?0:C,a?0:D)},translate:{parentMatrix:matrixInvert(dropTranslate(A))},rotate:{translateMatrix:createTranslateMatrix(X,B)}},scaleX:I,scaleY:k,matrix:O,ctm:M,parentMatrix:A,containerMatrix:R,wrapperMatrix:N,scX:Z,scY:K,containerBox:z},box:{width:S,height:g,left:m,top:b,offset:{left:v,top:x}},center:_objectSpread2({},u,{x:P,y:V,elX:X,elY:B,matrix:L}),revX:e,revY:r,doW:a,doH:n}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,a=r.handles.center,n=r.center.matrix,o=multiplyMatrix(n,createTranslateMatrix(t,e));helper(a).css(_objectSpread2({},matrixToCSS(flatMatrix(o)))),this.storage.center.isShifted=!0}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.el,r=e.offsetHeight,a=e.offsetWidth,n=this.storage,o=n.wrapper,i=n.handles.center,s=this.options.container;if(i){var l=_slicedToArray(getAbsoluteOffset(t,s),2),c=l[0],u=l[1],h=multiplyMatrix(getCurrentTransformMatrix(t,s),matrixInvert(getCurrentTransformMatrix(o,o.parentNode))),f=_slicedToArray(multiplyMatrixAndPoint(h,[a/2,r/2,0,1]),2),_=f[0],T=f[1];helper(i).css({transform:"translate(".concat(_+c,"px, ").concat(T+u,"px)")})}}},{key:"fitControlsToSize",value:function(){var t=this.el;this.storage.wrapper.removeAttribute("transform"),applyTransformToHandles(this.storage,this.options,{el:t})}},{key:"getBoundingRect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.el,r=this.options,a=r.scalable,n=r.restrict,o=this.storage,i=o.box,s=o.box,l=s.width,c=s.height,u=o.cached,h=(u=void 0===u?{}:u).box,f=(h=void 0===h?{}:h).width,_=void 0===f?l:f,T=h.height,p=void 0===T?c:T,d=a?i:_objectSpread2({},i,{width:_,height:p});return _getBoundingRect(e,n,getCurrentTransformMatrix(e,n,t),d)}},{key:"controls",get:function(){return this.storage.wrapper}}]),r}(),createHandler=function(t){var e=_slicedToArray(t,2),r=e[0],a=e[1],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"handler",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=createElement(["sjx-hdl","sjx-hdl-".concat(n)]);return helper(i).css(_objectSpread2({transform:"translate(".concat(r,"px, ").concat(a,"px)")},o)),i},renderLine=function(t,e){var r=_slicedToArray(t,3),a=r[0],n=r[1],o=r[2],i=void 0===o?1:o,s=getLineAttrs(a,n,i),l=s.cx,c=s.cy,u=s.length,h=s.theta,f=createElement(["sjx-hdl-line","sjx-hdl-".concat(e)]);return helper(f).css({transform:"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(h,"deg)"),height:"".concat(i,"px"),width:"".concat(u,"px")}),f},getLineAttrs=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=_slicedToArray(t,2),n=a[0],o=a[1],i=_slicedToArray(e,2),s=i[0],l=i[1],c=Math.sqrt((s-n)*(s-n)+(l-o)*(l-o)),u=(n+s)/2-c/2,h=(o+l)/2-r/2,f=Math.atan2(o-l,n-s)*(180/Math.PI);return{cx:u,cy:h,thickness:r,theta:f,length:c}},applyTransformToHandles=function(t,e,r){var a=t.wrapper,n=t.handles,o=t.transform,i=(o=void 0===o?{}:o).wrapperMatrix,s=void 0===i?getCurrentTransformMatrix(a,a.parentNode):i,l=t.center,c=e.rotationPoint,u=e.rotatable,h=e.resizable,f=e.showNormal,_=e.rotatorOffset,T=e.rotatorAnchor,p=e.container,d=r.el,E=r.el,y=E.offsetHeight,v=E.offsetWidth,x=_slicedToArray(getAbsoluteOffset(d,p),2),m=x[0],b=x[1],S=multiplyMatrix(getCurrentTransformMatrix(d,p),matrixInvert(s)),g=_objectSpread2({tl:[0,0,0,1],tr:[v,0,0,1],bl:[0,y,0,1],br:[v,y,0,1],tc:[v/2,0,0,1],ml:[0,y/2,0,1],bc:[v/2,y,0,1],mr:[v,y/2,0,1]},c&&u&&!l.isShifted&&{center:[v/2,y/2,0,1]}),O=Object.entries(g).reduce((function(t,e){var r=_slicedToArray(e,2),a=r[0],n=r[1];return[].concat(_toConsumableArray(t),[[a,multiplyMatrixAndPoint(S,n)]])}),[]).reduce((function(t,e){var r=_slicedToArray(e,2),a=r[0],n=_slicedToArray(r[1],4),o=n[0],i=n[1],s=n[2],l=n[3];return t[a]=[o+m,i+b,s,l],t}),{}),M=null,A={};if(u){var N,R={},C=1;switch(T){case"n":R.x=O.tc[0],R.y=O.tc[1];break;case"s":R.x=O.bc[0],R.y=O.bc[1],C=-1;break;case"w":R.x=O.ml[0],R.y=O.ml[1],C=-1;break;case"e":default:R.x=O.mr[0],R.y=O.mr[1]}var D="n"===T||"s"===T?Math.atan2(O.bl[1]-O.tl[1],O.bl[0]-O.tl[0]):Math.atan2(O.tl[1]-O.tr[1],O.tl[0]-O.tr[0]),I=_*C;N=[R.x-I*Math.cos(D),R.y-I*Math.sin(D)],M=f?[[R.x,R.y],N]:null,A={rotator:N}}var k=_objectSpread2({},O),w=_objectSpread2({te:[O.tl,O.tr],be:[O.bl,O.br],le:[O.tl,O.bl],re:[O.tr,O.br]},f&&M&&{normal:M});Object.keys(w).forEach((function(t){var e=_slicedToArray(w[t],2),r=e[0],a=e[1],o=getLineAttrs(r,a),i=o.cx,s=o.cy,l=o.length,c=o.theta;helper(n[t]).css({transform:"translate(".concat(i,"px, ").concat(s,"px) rotate(").concat(c,"deg)"),width:"".concat(l,"px")})}));var P=_objectSpread2({},h&&k,{},A);Object.keys(P).forEach((function(t){var e=P[t];if(e){var r=_slicedToArray(e,2),a=r[0],o=r[1];helper(n[t]).css({transform:"translate(".concat(a,"px, ").concat(o,"px)")})}}))},_getBoundingRect=function(t,e,r,a){var n=_slicedToArray(getAbsoluteOffset(t,e),2),o=n[0],i=n[1],s=a||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},l=s.width,c=s.height,u=s.offset,h=u.left,f=u.top;return[[0,0,0,1],[l,0,0,1],[0,c,0,1],[l,c,0,1]].reduce((function(t,e){return[].concat(_toConsumableArray(t),[multiplyMatrixAndPoint(r,e)])}),[]).map((function(t){var e=_slicedToArray(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+h,a+f,n,o]}))},createElement=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=document.createElement("div");return t.forEach((function(t){return addClass(e,t)})),e},svgPoint=createSVGElement("svg").createSVGPoint(),sepRE=/\s*,\s*|\s+/g,allowedElements=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function createSVGElement(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=document.createElementNS("http://www.w3.org/2000/svg",t);return e.forEach((function(t){return addClass(r,t)})),r}var checkChildElements=function t(e){var r=[];return isGroup(e)?forEach.call(e.childNodes,(function(e){if(1===e.nodeType){var a=e.tagName.toLowerCase();-1!==allowedElements.indexOf(a)&&("g"===a&&r.push.apply(r,_toConsumableArray(t(e))),r.push(e))}})):r.push(e),r},createSVGMatrix=function(){return createSVGElement("svg").createSVGMatrix()},createTranslateMatrix$1=function(t,e){var r=createSVGMatrix();return r.e=t,r.f=e,r},createRotateMatrix$1=function(t,e){var r=createSVGMatrix();return r.a=e,r.b=t,r.c=-t,r.d=e,r},createScaleMatrix$1=function(t,e){var r=createSVGMatrix();return r.a=t,r.d=e,r},getTransformToElement=function(t,e){return(e.getScreenCTM&&e.getScreenCTM()||createSVGMatrix()).inverse().multiply(t.getScreenCTM()||createSVGMatrix())},matrixToString=function(t){var e=t.a,r=t.b,a=t.c,n=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(a,",").concat(n,",").concat(o,",").concat(i,")")},pointTo=function(t,e,r){return svgPoint.x=e,svgPoint.y=r,svgPoint.matrixTransform(t)},cloneMatrix$1=function(t){var e=createSVGMatrix();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e},isIdentity=function(t){var e=t.a,r=t.b,a=t.c,n=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===a&&1===n&&0===o&&0===i},checkElement=function(t){var e=t.tagName.toLowerCase();return-1!==allowedElements.indexOf(e)||(warn('Selected element "'.concat(e,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)},isGroup=function(t){return"g"===t.tagName.toLowerCase()},normalizeString=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.replace(/([^e])-/g,"$1 -").replace(/ +/g," ")},parsePoints=function(t){return normalizeString(t).trim().split(sepRE).reduce((function(t,e,r,a){return r%2==0&&t.push(a.slice(r,r+2)),t}),[])},dRE=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,parsePath=function(t){for(var e=dRE.lastIndex=0,r=[];e=dRE.exec(t);){var a=_slicedToArray(e,3),n=a[1],o=a[2],i=n.toUpperCase(),s=normalizeString(o);r.push({relative:n!==i,key:i,cmd:n,values:s.trim().split(sepRE).map((function(t){if(!isNaN(t))return Number(t)}))})}return r},movePath=function(t){var e=t.path,r=t.dx,a=t.dy;try{for(var n=parsePath(e),o="",i=" ",s=!0,l=0,c=n.length;l<c;l++){var u=n[l],h=u.values,f=u.key,_=u.relative,T=[];switch(f){case"M":for(var p=0,d=h.length;p<d;p+=2){var E=_slicedToArray(h.slice(p,p+2),2),y=E[0],v=E[1];_&&!s||(y+=r,v+=a),T.push(y,v),s=!1}break;case"A":for(var x=0,m=h.length;x<m;x+=7){var b=h.slice(x,x+7);_||(b[5]+=r,b[6]+=a),T.push.apply(T,_toConsumableArray(b))}break;case"C":for(var S=0,g=h.length;S<g;S+=6){var O=h.slice(S,S+6);_||(O[0]+=r,O[1]+=a,O[2]+=r,O[3]+=a,O[4]+=r,O[5]+=a),T.push.apply(T,_toConsumableArray(O))}break;case"H":for(var M=0,A=h.length;M<A;M+=1){var N=h.slice(M,M+1);_||(N[0]+=r),T.push(N[0])}break;case"V":for(var R=0,C=h.length;R<C;R+=1){var D=h.slice(R,R+1);_||(D[0]+=a),T.push(D[0])}break;case"L":case"T":for(var I=0,k=h.length;I<k;I+=2){var w=_slicedToArray(h.slice(I,I+2),2),P=w[0],V=w[1];_||(P+=r,V+=a),T.push(P,V)}break;case"Q":case"S":for(var L=0,$=h.length;L<$;L+=4){var j=_slicedToArray(h.slice(L,L+4),4),F=j[0],G=j[1],H=j[2],U=j[3];_||(F+=r,G+=a,H+=r,U+=a),T.push(F,G,H,U)}break;case"Z":h[0]="",i=""}o+=u.cmd+T.join(",")+i}return o}catch(t){warn("Path parsing error: "+t)}},resizePath=function(t){var e=t.path,r=t.localCTM;try{for(var a=parsePath(e),n="",o=" ",i=[],s=!0,l=0,c=a.length;l<c;l++){var u=a[l],h=u.values,f=u.key,_=u.relative;switch(f){case"A":for(var T=[],p=0,d=h.length;p<d;p+=7){var E=_slicedToArray(h.slice(p,p+7),7),y=E[0],v=E[1],x=E[2],m=E[3],b=E[4],S=E[5],g=E[6],O=cloneMatrix$1(r);_&&(O.e=O.f=0);var M=pointTo(O,S,g),A=M.x,N=M.y;T.push(floatToFixed(A),floatToFixed(N)),O.e=O.f=0;var R=pointTo(O,y,v),C=R.x,D=R.y;T.unshift(floatToFixed(C),floatToFixed(D),x,m,b)}i.push(T);break;case"C":for(var I=[],k=0,w=h.length;k<w;k+=6){var P=_slicedToArray(h.slice(k,k+6),6),V=P[0],L=P[1],$=P[2],j=P[3],F=P[4],G=P[5],H=cloneMatrix$1(r);_&&(H.e=H.f=0);var U=pointTo(H,V,L),Y=U.x,X=U.y,B=pointTo(H,$,j),z=B.x,W=B.y,Z=pointTo(H,F,G),K=Z.x,q=Z.y;I.push(floatToFixed(Y),floatToFixed(X),floatToFixed(z),floatToFixed(W),floatToFixed(K),floatToFixed(q))}i.push(I);break;case"H":for(var Q=[],J=0,tt=h.length;J<tt;J+=1){var et=_slicedToArray(h.slice(J,J+1),1)[0],rt=cloneMatrix$1(r);_&&(rt.e=rt.f=0);var at=pointTo(rt,et,0).x;Q.push(floatToFixed(at))}i.push(Q);break;case"V":for(var nt=[],ot=0,it=h.length;ot<it;ot+=1){var st=_slicedToArray(h.slice(ot,ot+1),1)[0],lt=cloneMatrix$1(r);_&&(lt.e=lt.f=0);var ct=pointTo(lt,0,st).y;nt.push(floatToFixed(ct))}i.push(nt);break;case"T":case"L":for(var ut=[],ht=0,ft=h.length;ht<ft;ht+=2){var _t=_slicedToArray(h.slice(ht,ht+2),2),Tt=_t[0],pt=_t[1],dt=cloneMatrix$1(r);_&&(dt.e=dt.f=0);var Et=pointTo(dt,Tt,pt),yt=Et.x,vt=Et.y;ut.push(floatToFixed(yt),floatToFixed(vt))}i.push(ut);break;case"M":for(var xt=[],mt=0,bt=h.length;mt<bt;mt+=2){var St=_slicedToArray(h.slice(mt,mt+2),2),gt=St[0],Ot=St[1],Mt=cloneMatrix$1(r);_&&!s&&(Mt.e=Mt.f=0);var At=pointTo(Mt,gt,Ot),Nt=At.x,Rt=At.y;xt.push(floatToFixed(Nt),floatToFixed(Rt)),s=!1}i.push(xt);break;case"Q":for(var Ct=[],Dt=0,It=h.length;Dt<It;Dt+=4){var kt=_slicedToArray(h.slice(Dt,Dt+4),4),wt=kt[0],Pt=kt[1],Vt=kt[2],Lt=kt[3],$t=cloneMatrix$1(r);_&&($t.e=$t.f=0);var jt=pointTo($t,wt,Pt),Ft=jt.x,Gt=jt.y,Ht=pointTo($t,Vt,Lt),Ut=Ht.x,Yt=Ht.y;Ct.push(floatToFixed(Ft),floatToFixed(Gt),floatToFixed(Ut),floatToFixed(Yt))}i.push(Ct);break;case"S":for(var Xt=[],Bt=0,zt=h.length;Bt<zt;Bt+=4){var Wt=_slicedToArray(h.slice(Bt,Bt+4),4),Zt=Wt[0],Kt=Wt[1],qt=Wt[2],Qt=Wt[3],Jt=cloneMatrix$1(r);_&&(Jt.e=Jt.f=0);var te=pointTo(Jt,Zt,Kt),ee=te.x,re=te.y,ae=pointTo(Jt,qt,Qt),ne=ae.x,oe=ae.y;Xt.push(floatToFixed(ee),floatToFixed(re),floatToFixed(ne),floatToFixed(oe))}i.push(Xt);break;case"Z":i.push([""]),o=""}n+=u.cmd+i[l].join(",")+o}return n}catch(t){warn("Path parsing error: "+t)}},E_DRAG$3=EVENT_EMITTER_CONSTANTS.E_DRAG,E_RESIZE$2=EVENT_EMITTER_CONSTANTS.E_RESIZE,E_MOUSEDOWN$3=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$3=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,DraggableSVG=function(t){_inherits(r,Transformable);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r,[{key:"_init",value:function(t){var e=this,r=this.options,a=r.rotationPoint,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,l=r.rotatorAnchor,c=r.rotatorOffset,u=r.showNormal,h=r.custom,f=t.getBBox(),_=f.x,T=f.y,p=f.width,d=f.height,E=createSVGElement("g",["sjx-svg-wrapper"]),y=createSVGElement("g",["sjx-svg-controls"]),v=["data-sjx-cx","data-sjx-cy"].map((function(e){var r=t.getAttribute(e);return isDef(r)?Number(r):void 0})),x=v.every((function(t){return!isNaN(t)})),m={tl:[_,T],tr:[_+p,T],mr:[_+p,T+d/2],ml:[_,T+d/2],tc:[_+p/2,T],bc:[_+p/2,T+d],br:[_+p,T+d],bl:[_,T+d],center:[_+p/2,T+d/2]},b=getTransformToElement(t,n),S=Object.entries(m).reduce((function(t,e){var r=_slicedToArray(e,2),a=r[0],n=_slicedToArray(r[1],2),o=n[0],i=n[1];return _objectSpread2({},t,_defineProperty({},a,pointTo(b,o,i)))}),{}),g={},O={},M=null;if(s){var A={},N=1;switch(l){case"n":A.x=S.tc.x,A.y=S.tc.y;break;case"s":A.x=S.bc.x,A.y=S.bc.y,N=-1;break;case"w":A.x=S.ml.x,A.y=S.ml.y,N=-1;break;case"e":default:A.x=S.mr.x,A.y=S.mr.y}var R="n"===l||"s"===l?Math.atan2(S.bl.y-S.tl.y,S.bl.x-S.tl.x):Math.atan2(S.tl.y-S.tr.y,S.tl.x-S.tr.x);M={x:A.x-c*N*Math.cos(R),y:A.y-c*N*Math.sin(R)};var C=u?renderLine$1([A,M],THEME_COLOR,"normal"):null;u&&y.appendChild(C);var D=null;a&&((D=createSVGElement("line",["sjx-hidden"])).x1.baseVal.value=S.center.x,D.y1.baseVal.value=S.center.y,D.x2.baseVal.value=v[0]||S.center.x,D.y2.baseVal.value=v[1]||S.center.y,setLineStyle(D,"#fe3232"),D.setAttribute("opacity",.5),y.appendChild(D)),O=_objectSpread2({},O,{normal:C,radius:D})}var I=i?{tl:S.tl,tr:S.tr,br:S.br,bl:S.bl,tc:S.tc,bc:S.bc,ml:S.ml,mr:S.mr}:{},k={te:[S.tl,S.tr],be:[S.bl,S.br],le:[S.tl,S.bl],re:[S.tr,S.br]};Object.keys(k).forEach((function(t){var e=k[t];isUndef(e)||(g[t]=renderLine$1(e,THEME_COLOR,t),y.appendChild(g[t]))}));var w=x?pointTo(createSVGMatrix(),v[0],v[1]):S.center,P=_objectSpread2({},I,{rotator:M,center:a&&s?w:void 0});Object.keys(P).forEach((function(t){var e=P[t];if(!isUndef(e)){var r=e.x,a=e.y,n="center"===t?"#fe3232":THEME_COLOR;isDef(h)&&isFunc(h[t])?g[t]=h[t](b,f,pointTo):g[t]=createHandler$1(r,a,n,t),y.appendChild(g[t])}})),E.appendChild(y),o.appendChild(E),this.storage={wrapper:E,controls:y,handles:_objectSpread2({},g,{},O),parent:t.parentNode,center:{isShifted:x},transform:{ctm:b},bBox:f,cached:{}},[t,y].map((function(t){return helper(t).on(E_MOUSEDOWN$3,e._onMouseDown).on(E_TOUCHSTART$3,e._onTouchStart)}))}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,a=this.options.container;return this._applyMatrixToPoint(a.getScreenCTM().inverse(),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,a=r.container,n=r.restrict,o=null,i=null,s=_getBoundingRect$1(void 0===n?a:n,e),l=this.getBoundingRect(t),c=_slicedToArray(getMinMaxOf2DIndex(s,0),2),u=c[0],h=c[1],f=_slicedToArray(getMinMaxOf2DIndex(s,1),2),_=f[0],T=f[1],p=0,d=l.length;p<d;p++){var E=_slicedToArray(l[p],2),y=E[0],v=E[1];(y<u||y>h)&&(o=y),(v<_||v>T)&&(i=v)}return{x:o,y:i}}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,a=this.storage.transform.ctm.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,a=this.storage.transform.wrapperMatrix.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var a=createSVGElement("svg").createSVGPoint();return a.x=e,a.y=r,a.matrixTransform(t)}},{key:"_apply",value:function(t){var e=this.el,r=this.storage,a=this.storage,n=a.bBox,o=a.cached,i=a.transform,s=a.center,l=this.options,c=this.options,u=c.container,h=c.scalable,f=c.applyTranslate,_=i.matrix,T=i.parentMatrix,p=i.ctm;if(e.setAttribute("data-sjx-cx",s.elX),e.setAttribute("data-sjx-cy",s.elY),!isUndef(o)){var d=o.scaleX,E=o.scaleY,y=o.dist,v=(y=void 0===y?{}:y).dx,x=y.dy,m=y.ox,b=y.oy,S=o.transformMatrix;if(t===E_DRAG$3){if(!f||!v&&!x)return;var g=createTranslateMatrix$1(m,b),O=g.multiply(_).multiply(g.inverse());if(e.setAttribute("transform",matrixToString(O)),isGroup(e))checkChildElements(e).forEach((function(t){var e=createTranslateMatrix$1(v,x),r=e.multiply(getTransformToElement(t,t.parentNode)).multiply(e.inverse());if(isIdentity(r)||t.setAttribute("transform",matrixToString(r)),!isGroup(t)){var a=T.inverse();a.e=a.f=0;var n=pointTo(a,m,b),o=n.x,i=n.y;applyTranslate(t,{x:o,y:i})}}));else applyTranslate(e,{x:m,y:b})}if(t===E_RESIZE$2){if(!S)return;if(!h)if(isGroup(e)){checkChildElements(e).forEach((function(t){if(!isGroup(t)){var a=getTransformToElement(t,e),i=a.inverse().multiply(S).multiply(a);applyResize(t,{scaleX:d,scaleY:E,localCTM:i,bBox:n,container:u,storage:r,cached:o})}}))}else{var M=u.getScreenCTM()||createSVGMatrix(),A=e.getScreenCTM().multiply(S),N=M.inverse().multiply(A),R=p.inverse().multiply(N);applyResize(e,{scaleX:d,scaleY:E,localCTM:R,bBox:n,container:u,storage:r,cached:o})}applyTransformToHandles$1(r,l,{boxMatrix:h?p.multiply(S):p,element:e})}}}},{key:"_processResize",value:function(t,e){var r=this.el,a=this.storage,n=this.storage,o=n.bBox,i=o.width,s=o.height,l=n.revX,c=n.revY,u=n.doW,h=n.doH,f=n.transform,_=f.matrix,T=f.auxiliary.scale.translateMatrix,p=n.cached,d=(p=void 0===p?{}:p).dist,E=(d=void 0===d?{}:d).dx,y=void 0===E?t:E,v=d.dy,x=void 0===v?e:v,m=this.options,b=m.proportions,S=m.scalable,g=m.restrict,O=r.getBBox(),M=O.x,A=O.y,N=function(t,e){var r=u||!u&&!h?(i+t)/i:(s+e)/s,a=b?i*r:i+t,n=b?s*r:s+e;return[a/i,n/s,a,n]},R=function(t,e){var r=createScaleMatrix$1(t,e);return T.multiply(r).multiply(T.inverse())},C=_.multiply(R.apply(void 0,_toConsumableArray(N(t,e)))),D=g?this._restrictHandler(C):{x:null,y:null},I=D.x,k=D.y,w=(null!==I||null!==k)&&g,P=w?y:t,V=w?x:e,L=_slicedToArray(N(P,V),4),$=L[0],j=L[1],F=L[2],G=L[3],H=R($,j),U=_.multiply(H),Y=M-(F-i)*(h?.5:l?1:0),X=A-(G-s)*(u?.5:c?1:0);return S&&r.setAttribute("transform",matrixToString(U)),a.cached=_objectSpread2({},a.cached,{scaleX:$,scaleY:j,transformMatrix:H,resultMatrix:U,dist:{dx:P,dy:V}}),this._apply(E_RESIZE$2),{x:Y,y:X,width:F,height:G,transform:U}}},{key:"_processMove",value:function(t,e){var r=this.storage,a=this.storage,n=a.wrapper,o=a.center,i=a.transform,s=i.matrix,l=i.auxiliary.translate,c=l.translateMatrix,u=l.wrapperTranslateMatrix,h=i.wrapperMatrix,f=i.parentMatrix,_=a.cached,T=(_=void 0===_?{}:_).dist,p=(T=void 0===T?{}:T).dx,d=void 0===p?t:p,E=T.dy,y=void 0===E?e:E,v=this.options.restrict;f.e=f.f=0;var x=pointTo(f.inverse(),t,e),m=x.x,b=x.y,S=createTranslateMatrix$1(m,b).multiply(s),g=v?this._restrictHandler(S):{x:null,y:null},O=null!==g.x&&v?d:t,M=null!==g.y&&v?y:e,A=pointTo(f.inverse(),O,M),N=A.x,R=A.y;r.cached.dist={dx:floatToFixed(O),dy:floatToFixed(M),ox:floatToFixed(N),oy:floatToFixed(R)},c.e=N,c.f=R;var C=c.multiply(s);u.e=O,u.f=M;var D=u.multiply(h);if(n.setAttribute("transform",matrixToString(D)),this.el.setAttribute("transform",matrixToString(C)),o.isShifted){var I=h.inverse();I.e=I.f=0;var k=pointTo(I,O,M),w=k.x,P=k.y;this._moveCenterHandle(-w,-P)}return C}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.wrapper,a=e.transform,n=a.matrix,o=a.wrapperMatrix,i=a.parentMatrix,s=a.auxiliary.rotate,l=s.translateMatrix,c=s.wrapperTranslateMatrix,u=this.options.restrict,h=floatToFixed(Math.cos(t)),f=floatToFixed(Math.sin(t)),_=createRotateMatrix$1(f,h);i.e=i.f=0;var T=i.inverse().multiply(_).multiply(i),p=l.multiply(T).multiply(l.inverse()).multiply(n),d=u?this._restrictHandler(p):{x:null,y:null},E=d.x,y=d.y;if(isDef(E)||isDef(y))return p;var v=c.multiply(_).multiply(c.inverse()).multiply(o);return r.setAttribute("transform",matrixToString(v)),this.el.setAttribute("transform",matrixToString(p)),p}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,a=t.doW,n=t.doH,o=this.el,i=this.storage,s=i.wrapper,l=i.parent,c=i.handles.center,u=this.options,h=u.container,f=u.restrict,_=o.getBBox(),T=_.x,p=_.y,d=_.width,E=_.height,y=getTransformToElement(o,l),v=getTransformToElement(o,h),x=getTransformToElement(s,h),m=getTransformToElement(l,h),b=getTransformToElement(s,s.parentNode),S=m.inverse(),g=T+d*(n?.5:e?1:0),O=p+E*(a?.5:r?1:0),M=T+d/2,A=p+E/2,N=c?c.cx.baseVal.value:M,R=c?c.cy.baseVal.value:A,C=pointTo(x,N,R),D=C.x,I=C.y,k=c?pointTo(S,D,I):pointTo(y,M,A),w=k.x,P=k.y,V=pointTo(v,M,A),L=V.x,$=V.y;storeElementAttributes(this.el),checkChildElements(o).forEach((function(t){t.__ctm__=getTransformToElement(t,t.parentNode),storeElementAttributes(t)}));var j=_objectSpread2({},this.storage.center||{},{x:c?D:L,y:c?I:$,elX:w,elY:P,hx:c?c.cx.baseVal.value:null,hy:c?c.cy.baseVal.value:null}),F=f?getTransformToElement(f,f.parentNode):getTransformToElement(h,h.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:createSVGMatrix(),translateMatrix:createTranslateMatrix$1(g,O)},translate:{parentMatrix:S,translateMatrix:createSVGMatrix(),wrapperTranslateMatrix:createSVGMatrix()},rotate:{translateMatrix:createTranslateMatrix$1(j.elX,j.elY),wrapperTranslateMatrix:createTranslateMatrix$1(j.x,j.y)}},matrix:y,ctm:v,parentMatrix:m,wrapperMatrix:b,containerMatrix:F,scX:Math.sqrt(v.a*v.a+v.b*v.b),scY:Math.sqrt(v.c*v.c+v.d*v.d)},bBox:_,center:j,revX:e,revY:r,doW:a,doH:n}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,a=r.handles,n=a.center,o=a.radius,i=r.center,s=i.hx,l=i.hy;if(!isUndef(n)){var c=s+t,u=l+e;n.cx.baseVal.value=c,n.cy.baseVal.value=u,o.x2.baseVal.value=c,o.y2.baseVal.value=u,this.storage.center.isShifted=!0}}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.storage,r=e.bBox,a=r.width,n=r.height,o=r.x,i=r.y,s=e.handles,l=s.center,c=s.radius;if(l){var u=getTransformToElement(t,t.parentNode),h=pointTo(u,o+a/2,i+n/2),f=h.x,_=h.y;l.cx.baseVal.value=f,l.cy.baseVal.value=_,l.isShifted=!1,c.x2.baseVal.value=f,c.y2.baseVal.value=_}}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.storage.wrapper,r=this.options.container,a=t.getBBox(),n=a.width,o=a.height,i=a.x,s=a.y,l=getTransformToElement(t,r),c=createSVGMatrix();this.storage.transform.wrapperMatrix=c,e.setAttribute("transform",matrixToString(c)),applyTransformToHandles$1(this.storage,this.options,{x:i,y:s,width:n,height:o,boxMatrix:l,element:t})}},{key:"getBoundingRect",value:function(t){var e=this.el,r=this.options.restrict,a=this.storage,n=a.bBox,o=a.transform,i=(o=void 0===o?{}:o).ctm;return _getBoundingRect$1(e,getTransformToElement(e.parentNode,r).multiply(t||i),n)}},{key:"controls",get:function(){return this.storage.wrapper}}]),r}(),applyTranslate=function(t,e){var r=e.x,a=e.y,n=[];switch(t.tagName.toLowerCase()){case"text":var o=isDef(t.x.baseVal[0])?t.x.baseVal[0].value+r:(Number(t.getAttribute("x"))||0)+r,i=isDef(t.y.baseVal[0])?t.y.baseVal[0].value+a:(Number(t.getAttribute("y"))||0)+a;n.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=isDef(t.x.baseVal.value)?t.x.baseVal.value+r:(Number(t.getAttribute("x"))||0)+r,l=isDef(t.y.baseVal.value)?t.y.baseVal.value+a:(Number(t.getAttribute("y"))||0)+a;n.push(["x",s],["y",l]);break;case"circle":case"ellipse":var c=t.cx.baseVal.value+r,u=t.cy.baseVal.value+a;n.push(["cx",c],["cy",u]);break;case"line":var h=t.x1.baseVal.value+r,f=t.y1.baseVal.value+a,_=t.x2.baseVal.value+r,T=t.y2.baseVal.value+a;n.push(["x1",h],["y1",f],["x2",_],["y2",T]);break;case"polygon":case"polyline":var p=parsePoints(t.getAttribute("points")).map((function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+a,t.join(" ")})).join(" ");n.push(["points",p]);break;case"path":var d=t.getAttribute("d");n.push(["d",movePath({path:d,dx:r,dy:a})])}n.forEach((function(e){t.setAttribute(e[0],e[1])}))},applyResize=function(t,e){var r=e.scaleX,a=e.scaleY,n=e.localCTM,o=e.bBox,i=o.width,s=o.height,l=[];switch(t.tagName.toLowerCase()){case"text":case"tspan":var c=t.__data__,u=c.x,h=c.y,f=c.textLength,_=pointTo(n,u,h),T=_.x,p=_.y;l.push(["x",T+(r<0?i:0)],["y",p-(a<0?s:0)],["textLength",Math.abs(r*f)]);break;case"circle":var d=t.__data__,E=d.r,y=d.cx,v=d.cy,x=E*(Math.abs(r)+Math.abs(a))/2,m=pointTo(n,y,v),b=m.x,S=m.y;l.push(["r",x],["cx",b],["cy",S]);break;case"foreignobject":case"image":case"rect":var g=t.__data__,O=g.width,M=g.height,A=g.x,N=g.y,R=pointTo(n,A,N),C=R.x,D=R.y,I=Math.abs(O*r),k=Math.abs(M*a);l.push(["x",C-(r<0?I:0)],["y",D-(a<0?k:0)],["width",I],["height",k]);break;case"ellipse":var w=t.__data__,P=w.rx,V=w.ry,L=w.cx,$=w.cy,j=pointTo(n,L,$),F=j.x,G=j.y,H=createSVGMatrix();H.a=r,H.d=a;var U=pointTo(H,P,V),Y=U.x,X=U.y;l.push(["rx",Math.abs(Y)],["ry",Math.abs(X)],["cx",F],["cy",G]);break;case"line":var B=t.__data__,z=B.resX1,W=B.resY1,Z=B.resX2,K=B.resY2,q=pointTo(n,z,W),Q=q.x,J=q.y,tt=pointTo(n,Z,K),et=tt.x,rt=tt.y;l.push(["x1",Q],["y1",J],["x2",et],["y2",rt]);break;case"polygon":case"polyline":var at=t.__data__.points,nt=parsePoints(at).map((function(t){var e=pointTo(n,Number(t[0]),Number(t[1])),r=e.x,a=e.y;return t[0]=floatToFixed(r),t[1]=floatToFixed(a),t.join(" ")})).join(" ");l.push(["points",nt]);break;case"path":var ot=t.__data__.path;l.push(["d",resizePath({path:ot,localCTM:n})])}l.forEach((function(e){var r=_slicedToArray(e,2),a=r[0],n=r[1];t.setAttribute(a,n)}))},applyTransformToHandles$1=function(t,e,r){var a=e.rotatable,n=e.rotatorAnchor,o=e.rotatorOffset,i=t.wrapper,s=t.handles,l=t.center,c=t.transform,u=(c=void 0===c?{}:c).wrapperMatrix,h=void 0===u?getTransformToElement(i,i.parentNode):u,f=r.boxMatrix,_=r.element.getBBox(),T=_.x,p=_.y,d=_.width,E=_.height,y=d/2,v=E/2,x=h.inverse().multiply(f),m=pointTo(x,T+y,p+v),b=_objectSpread2({tl:[T,p],tr:[T+d,p],mr:[T+d,p+v],ml:[T,p+v],tc:[T+y,p],bc:[T+y,p+E],br:[T+d,p+E],bl:[T,p+E]},!l.isShifted&&{center:[T+y,p+v]}),S=Object.entries(b).reduce((function(t,e){var r=_slicedToArray(e,2),a=r[0],n=r[1];return t[a]=pointTo(x,n[0],n[1]),t}),{}),g={te:[S.tl,S.tr],be:[S.bl,S.br],le:[S.tl,S.bl],re:[S.tr,S.br]};if(a){var O={},M=1;switch(n){case"n":O.x=S.tc.x,O.y=S.tc.y;break;case"s":O.x=S.bc.x,O.y=S.bc.y,M=-1;break;case"w":O.x=S.ml.x,O.y=S.ml.y,M=-1;break;case"e":default:O.x=S.mr.x,O.y=S.mr.y}var A="n"===n||"s"===n?Math.atan2(S.bl.y-S.tl.y,S.bl.x-S.tl.x):Math.atan2(S.tl.y-S.tr.y,S.tl.x-S.tr.x),N=o*M,R={x:O.x-N*Math.cos(A),y:O.y-N*Math.sin(A)},C=s.normal,D=s.radius;isDef(C)&&(C.x1.baseVal.value=O.x,C.y1.baseVal.value=O.y,C.x2.baseVal.value=R.x,C.y2.baseVal.value=R.y),isDef(D)&&(D.x1.baseVal.value=m.x,D.y1.baseVal.value=m.y,l.isShifted||(D.x2.baseVal.value=m.x,D.y2.baseVal.value=m.y)),S.rotator=R}Object.keys(g).forEach((function(t){var e=s[t],r=_slicedToArray(g[t],2),a=r[0],n=r[1];isUndef(a)||isUndef(e)||Object.entries({x1:a.x,y1:a.y,x2:n.x,y2:n.y}).map((function(t){var r=_slicedToArray(t,2),a=r[0],n=r[1];return e.setAttribute(a,n)}))})),Object.keys(S).forEach((function(t){var e=s[t],r=S[t];isUndef(r)||isUndef(e)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))}))},createHandler$1=function(t,e,r,a){var n=createSVGElement("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(a)]),o={cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"};return Object.entries(o).forEach((function(t){var e=_slicedToArray(t,2),r=e[0],a=e[1];return n.setAttribute(r,a)})),n},setLineStyle=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},storeElementAttributes=function(t){switch(t.tagName.toLowerCase()){case"text":var e=isDef(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,r=isDef(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,a=isDef(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null;t.__data__={x:e,y:r,textLength:a};break;case"circle":var n=t.r.baseVal.value,o=t.cx.baseVal.value,i=t.cy.baseVal.value;t.__data__={r:n,cx:o,cy:i};break;case"foreignobject":case"image":case"rect":var s=t.width.baseVal.value,l=t.height.baseVal.value,c=t.x.baseVal.value,u=t.y.baseVal.value;t.__data__={width:s,height:l,x:c,y:u};break;case"ellipse":var h=t.rx.baseVal.value,f=t.ry.baseVal.value,_=t.cx.baseVal.value,T=t.cy.baseVal.value;t.__data__={rx:h,ry:f,cx:_,cy:T};break;case"line":var p=t.x1.baseVal.value,d=t.y1.baseVal.value,E=t.x2.baseVal.value,y=t.y2.baseVal.value;t.__data__={resX1:p,resY1:d,resX2:E,resY2:y};break;case"polygon":case"polyline":var v=t.getAttribute("points");t.__data__={points:v};break;case"path":var x=t.getAttribute("d");t.__data__={path:x}}},renderLine$1=function(t,e,r){var a=_slicedToArray(t,2),n=a[0],o=a[1],i=createSVGElement("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),s={x1:n.x,y1:n.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return Object.entries(s).forEach((function(t){var e=_slicedToArray(t,2),r=e[0],a=e[1];return i.setAttribute(r,a)})),i},_getBoundingRect$1=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getBBox(),a=r.x,n=r.y,o=r.width,i=r.height,s=[[a,n],[a+o,n],[a+o,n+i],[a,n+i]];return s.map((function(t){var r=_slicedToArray(t,2),a=r[0],n=r[1],o=pointTo(e,a,n);return[o.x,o.y]}))};function drag(t,e){if(this.length){var r=isDef(e)&&e instanceof Observable?e:new Observable;return arrReduce.call(this,(function(e,a){return a instanceof SVGElement?checkElement(a)&&e.push(new DraggableSVG(a,t,r)):e.push(new Draggable(a,t,r)),e}),[])}}var EMITTER_EVENTS$2=EVENT_EMITTER_CONSTANTS.EMITTER_EVENTS,E_MOUSEDOWN$4=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$4=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,Cloneable=function(t){_inherits(r,SubjectModel);var e=_createSuper(r);function r(t,a){var n;return _classCallCheck(this,r),(n=e.call(this,t)).enable(a),n}return _createClass(r,[{key:"_init",value:function(){var t=this,e=this.el,r=this.options,a=helper(e),n=r.style,o=r.appendTo,i=_objectSpread2({position:"absolute","z-index":"2147483647"},n);this.storage={css:i,parent:isDef(o)?helper(o)[0]:document.body},a.on(E_MOUSEDOWN$4,this._onMouseDown).on(E_TOUCHSTART$4,this._onTouchStart),EMITTER_EVENTS$2.slice(0,3).forEach((function(e){t.eventDispatcher.registerEvent(e)}))}},{key:"_processOptions",value:function(t){var e={},r=null,a=document,n=function(){},o=function(){},i=function(){},s=function(){};if(isDef(t)){var l=t.style,c=t.appendTo,u=t.stack,h=t.onInit,f=t.onMove,_=t.onDrop,T=t.onDestroy;e=isDef(l)&&"object"===_typeof(l)?l:e,r=c||null;var p=isDef(u)?helper(u)[0]:document;n=createMethod(h),o=createMethod(f),i=isFunc(_)?function(t){var e=this.storage.clone;objectsCollide(e,p)&&_.call(this,t,this.el,e)}:function(){},s=createMethod(T)}this.options={style:e,appendTo:r,stack:a},this.proxyMethods={onInit:n,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,a=this.storage,n=this.el,o=a.parent,i=a.css,s=getOffset(o),l=s.left,c=s.top;i.left="".concat(e-l,"px"),i.top="".concat(r-c,"px");var u=n.cloneNode(!0);helper(u).css(i),a.clientX=e,a.clientY=r,a.cx=e,a.cy=r,a.clone=u,helper(o)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,a=this.storage;a.clientX=e,a.clientY=r,a.doDraw=!0,a.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,a=e.frameId;e.doDraw=!1,cancelAnimFrame(a),isUndef(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=requestAnimFrame(this._animate);var e=t.doDraw,r=t.clientX,a=t.clientY,n=t.cx,o=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-n,dy:a-o}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,a="translate(".concat(t,"px, ").concat(e,"px)");helper(r).css({transform:a,webkitTranform:a,mozTransform:a,msTransform:a,otransform:a})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;isUndef(t)||(helper(r).off(E_MOUSEDOWN$4,this._onMouseDown).off(E_TOUCHSTART$4,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),r}();function clone(t){if(this.length)return arrMap.call(this,(function(e){return new Cloneable(e,t)}))}var Subjx=function(t){_inherits(r,Helper);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r,[{key:"drag",value:function(){return drag.call.apply(drag,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return clone.call.apply(clone,[this].concat(Array.prototype.slice.call(arguments)))}}]),r}();function subjx(t){return new Subjx(t)}Object.defineProperty(subjx,"createObservable",{value:function(){return new Observable}}),Object.defineProperty(subjx,"Subjx",{value:Subjx}),Object.defineProperty(subjx,"Observable",{value:Observable}),module.exports=subjx;
