/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=c(t);if(e){var a=c(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return h(this,r)}}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},x=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},m=Array.prototype,g=m.forEach,_=m.slice,E=m.map,M=m.reduce,T=console.warn,k=function(t){return null!=t},w=function(t){return null==t},O=function(t){return"function"==typeof t},S=function(t){return O(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}},A=function(){function r(n){if(e(this,r),"string"==typeof n){var a=document.querySelectorAll(n);this.length=a.length;for(var o=0;o<this.length;o++)this[o]=a[o]}else if("object"!==t(n)||1!==n.nodeType&&n!==document)if(n instanceof r){this.length=n.length;for(var i=0;i<this.length;i++)this[i]=n[i]}else{if(!k(c=n)||"object"!==t(c)||!(Array.isArray(c)||k(window.Symbol)&&"function"==typeof c[window.Symbol.iterator]||k(c.forEach)||"number"==typeof c.length&&(0===c.length||c.length>0&&c.length-1 in c)))throw new Error("Passed parameter must be selector/element/elementArray");this.length=n.length;for(var s=0;s<this.length;s++)1===n[s].nodeType&&(this[s]=n[s])}else this[0]=n,this.length=1;var c}return n(r,[{key:"css",value:function(e){var r=function(t){for(var r=t.length;r--;)return t[r].currentStyle?t[r].currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[r],"")[e]:t[r].style[e]},n=function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style},a={setStyle:function(t){return n(this,t)},getStyle:function(){return r(this)}};return"string"==typeof e?a.getStyle.apply(this,_.call(arguments,1)):"object"!==t(e)&&e?(T("Method ".concat(e," does not exist")),!1):a.setStyle.apply(this,arguments)}},{key:"on",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=arguments[1]:R(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}},{key:"off",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=null:R(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}},{key:"is",value:function(t){if(w(t))return!1;for(var e=N(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),r}();function R(t,e,r,n,a,o){var i=function(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode};!0===o?document.addEventListener?t.addEventListener(e,i,a||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,a||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function N(t){return new A(t)}var j=["","-webkit-","-moz-","-ms-","-o-"],D={NOTIFIER_EVENTS:["ongetstate","onapply","onmove","onresize","onrotate"],ON_GETSTATE:"ongetstate",ON_APPLY:"onapply",ON_MOVE:"onmove",ON_RESIZE:"onresize",ON_ROTATE:"onrotate"},V={EMITTER_EVENTS:["dragStart","drag",,"dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],E_DRAG_START:"dragStart",E_DRAG:"drag",E_DRAG_END:"dragEnd",E_RESIZE_START:"resizeStart",E_RESIZE:"resize",E_RESIZE_END:"resizeEnd",E_ROTATE_START:"rotateStart",E_ROTATE:"rotate",E_ROTATE_END:"rotateEnd",E_SET_POINT_START:"setPointStart",E_SET_POINT_END:"setPointEnd"},P="mousedown",C="mouseup",Y="mousemove",X="touchstart",z="touchend",L="touchmove",I={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},H={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},B=D.ON_GETSTATE,G=D.ON_APPLY,F=D.ON_MOVE,W=D.ON_RESIZE,q=D.ON_ROTATE,Z=function(){function t(){e(this,t),this.observers={}}return n(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return w(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(k(r[t])){var n=r[t].indexOf(e);r[t].splice(n,1)}return this}},{key:"notify",value:function(t,e,r){w(this.observers[t])||this.observers[t].forEach((function(n){if(e!==n)switch(t){case F:n.notifyMove(r);break;case q:n.notifyRotate(r);break;case W:n.notifyResize(r);break;case G:n.notifyApply(r);break;case B:n.notifyGetState(r)}}))}}]),t}(),U=function(){function t(r){e(this,t),this.name=r,this.callbacks=[]}return n(t,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),t}(),Q=function(){function t(){e(this,t),this.events={}}return n(t,[{key:"registerEvent",value:function(t){this.events[t]=new U(t)}},{key:"emit",value:function(t,e,r){this.events[e].callbacks.forEach((function(e){e.call(t,r)}))}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),$=V.E_DRAG,J=Y,K=C,tt=L,et=z,rt=function(){function t(r){e(this,t),this.el=r,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new Q,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return n(t,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){nt()}},{key:"_init",value:function(){nt()}},{key:"_destroy",value:function(){nt()}},{key:"_processOptions",value:function(){nt()}},{key:"_start",value:function(){nt()}},{key:"_moving",value:function(){nt()}},{key:"_end",value:function(){nt()}},{key:"_animate",value:function(){nt()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,n=u(t,["dx","dy"]),a=i({dx:e,dy:r,transform:this._processMove(e,r)},n);this.proxyMethods.onMove.call(this,a),this._emitEvent($,a)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),N(document).on(J,this._onMouseMove).on(K,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),N(document).on(tt,this._onTouchMove).on(et,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){N(document).off(J,this._onMouseMove).off(K,this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){N(document).off(tt,this._onTouchMove).off(et,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),t}(),nt=function(){throw Error("Method not implemented")},at=Math.PI/180,ot=function(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0},it=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return Number(t.toFixed(e))},st=function(t,e){var r=t.map((function(t){return t[e]}));return[Math.min.apply(Math,d(r)),Math.max.apply(Math,d(r))]},ct=function(t){return t.getBoundingClientRect()},lt=function(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach((function(e){return t.classList.add(e)}))}return t}},ut=function(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach((function(e){return t.classList.remove(e)}))}return t}},ht=function(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}},ft=function(t,e){var r,n=window.getComputedStyle(t),a=null,o=function(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=y(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}(j);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(a=n.getPropertyValue("".concat(i).concat(e))||a)break}}catch(t){o.e(t)}finally{o.f()}return a},vt=D.NOTIFIER_EVENTS,dt=D.ON_GETSTATE,yt=D.ON_APPLY,pt=D.ON_MOVE,bt=D.ON_RESIZE,xt=D.ON_ROTATE,mt=V.EMITTER_EVENTS,gt=V.E_DRAG_START,_t=V.E_DRAG,Et=V.E_DRAG_END,Mt=V.E_RESIZE_START,Tt=V.E_RESIZE,kt=V.E_RESIZE_END,wt=V.E_ROTATE_START,Ot=V.E_ROTATE,St=V.E_ROTATE_END,At=I,Rt=H,Nt=P,jt=X,Dt=Y,Vt=C,Pt=L,Ct=z,Yt=At.TOP_LEFT,Xt=At.TOP_CENTER,zt=At.TOP_RIGHT,Lt=At.BOTTOM_LEFT,It=At.BOTTOM_RIGHT,Ht=At.BOTTOM_CENTER,Bt=At.MIDDLE_LEFT,Gt=At.MIDDLE_RIGHT,Ft=Rt.TOP_EDGE,Wt=Rt.BOTTOM_EDGE,qt=Rt.LEFT_EDGE,Zt=Rt.RIGHT_EDGE,Ut=function(r){s(o,rt);var a=f(o);function o(t,r,n){var i;if(e(this,o),(i=a.call(this,t)).constructor===o)throw new TypeError("Cannot construct Transformable instances directly");return i.observable=n,mt.forEach((function(t){return i.eventDispatcher.registerEvent(t)})),i.enable(r),i}return n(o,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,r=u(t,["radians"]),n=i({transform:this._processRotate(e),delta:e},r);this.proxyMethods.onRotate.call(this,n),this._emitEvent(Ot,n)}},{key:"_resize",value:function(t){var e=t.dx,r=t.dy,n=u(t,["dx","dy"]),a=i(i({},this._processResize(e,r)),{},{dx:e,dy:r},n);this.proxyMethods.onResize.call(this,a),this._emitEvent(Tt,a)}},{key:"_processOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.el;lt(r,"".concat("sjx-","drag"));var n=e.each,a=void 0===n?{move:!1,resize:!1,rotate:!1}:n,o=e.snap,s=void 0===o?{x:10,y:10,angle:10}:o,c=e.axis,l=void 0===c?"xy":c,u=e.cursorMove,h=void 0===u?"auto":u,f=e.cursorResize,v=void 0===f?"auto":f,d=e.cursorRotate,y=void 0===d?"auto":d,p=e.rotationPoint,b=void 0!==p&&p,x=e.restrict,m=e.draggable,g=void 0===m||m,_=e.resizable,E=void 0===_||_,M=e.rotatable,T=void 0===M||M,k=e.scalable,w=void 0!==k&&k,O=e.applyTranslate,A=void 0!==O&&O,R=e.onInit,j=void 0===R?function(){}:R,D=e.onDrop,V=void 0===D?function(){}:D,P=e.onMove,C=void 0===P?function(){}:P,Y=e.onResize,X=void 0===Y?function(){}:Y,z=e.onRotate,L=void 0===z?function(){}:z,I=e.onDestroy,H=void 0===I?function(){}:I,B=e.container,G=void 0===B?r.parentNode:B,F=e.controlsContainer,W=void 0===F?G:F,q=e.proportions,Z=void 0!==q&&q,U=e.rotatorAnchor,Q=void 0===U?null:U,$=e.rotatorOffset,J=void 0===$?50:$,K=e.showNormal,tt=void 0===K||K,et=e.custom;this.options={axis:l,cursorMove:h,cursorRotate:y,cursorResize:v,rotationPoint:b,restrict:x?N(x)[0]||document.body:null,container:N(G)[0],controlsContainer:N(W)[0],snap:i(i({},s),{},{angle:s.angle*at}),each:a,proportions:Z,draggable:g,resizable:E,rotatable:T,scalable:w,applyTranslate:A,custom:"object"===t(et)&&et||null,rotatorAnchor:Q,rotatorOffset:J,showNormal:tt},this.proxyMethods={onInit:S(j),onDrop:S(V),onMove:S(C),onResize:S(X),onRotate:S(L),onDestroy:S(H)},this.subscribe(a)}},{key:"_animate",value:function(){var t=this.observable,e=this.storage,r=this.options;if(!w(e)&&(e.frame=b(this._animate),e.doDraw)){e.doDraw=!1;var n=e.dox,a=e.doy,o=e.clientX,s=e.clientY,c=e.doDrag,l=e.doResize,u=e.doRotate,h=e.doSetCenter,f=e.revX,v=e.revY,d=r.snap,y=r.each,p=y.move,x=y.resize,m=y.rotate,g=r.draggable,_=r.resizable,E=r.rotatable;if(l&&_){var M=e.transform,T=M.scX,k=M.scY,O=e.cx,S=e.cy,A=this._pointToElement({x:o,y:s}),R=A.x,N=A.y,j=n?ot(R-O,d.x/T):0,D=a?ot(N-S,d.y/k):0,V={dx:j=n?f?-j:j:0,dy:D=a?v?-D:D:0,clientX:o,clientY:s};this._resize(V),x&&t.notify(bt,this,V)}if(c&&g){var P=e.nx,C=e.ny,Y={dx:n?ot(o-P,d.x):0,dy:a?ot(s-C,d.y):0,clientX:o,clientY:s};this._drag(Y),p&&t.notify(pt,this,Y)}if(u&&E){var X=e.pressang,z=e.center,L=Math.atan2(s-z.y,o-z.x)-X,I={clientX:o,clientY:s};this._rotate(i({radians:ot(L,d.angle)},I)),m&&t.notify(xt,this,i({radians:L},I))}if(h&&E){var H=e.bx,B=e.by,G=this._pointToControls({x:o,y:s}),F=G.x,W=G.y;this._moveCenterHandle(F-H,W-B)}}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.observable,a=this.storage,o=this.storage.handles,s=this.options,c=s.axis,l=s.each,u=this.el,h=Object.values(o).some((function(e){return N(t.target).is(e)}))||u.contains(t.target);if(a.isTarget=h,h){var f=this._compute(t,u);Object.keys(f).map((function(t){return a[t]=f[t]}));var v=f.onRightEdge,d=f.onBottomEdge,y=f.onTopEdge,p=f.onLeftEdge,b=f.handle,x=f.factor,m=f.revX,g=f.revY,_=f.doW,E=f.doH,M=v||d||y||p,T=o.rotator,w=o.center,O=o.radius;k(O)&&ut(O,"".concat("sjx-","hidden"));var S=b.is(T),A=!!k(w)&&b.is(w),R=u.contains(t.target)&&!(S||M||A),j=this._cursorPoint({clientX:e,clientY:r}),D=j.x,V=j.y,P=this._pointToElement({x:D,y:V}),C=P.x,Y=P.y,X=this._pointToControls({x:D,y:V}),z={clientX:e,clientY:r,cx:C,cy:Y,nx:D,ny:V,bx:X.x,by:X.y,doResize:M,doDrag:R,doRotate:S,doSetCenter:A,onExecution:!0,cursor:null,dox:/\x/.test(c)&&(!M||(b.is(o.ml)||b.is(o.mr)||b.is(o.tl)||b.is(o.tr)||b.is(o.bl)||b.is(o.br)||b.is(o.le)||b.is(o.re))),doy:/\y/.test(c)&&(!M||(b.is(o.br)||b.is(o.bl)||b.is(o.bc)||b.is(o.tr)||b.is(o.tl)||b.is(o.tc)||b.is(o.te)||b.is(o.be))),cached:{}};this.storage=i(i({},a),z);var L={clientX:e,clientY:r};M?this._emitEvent(Mt,L):S?this._emitEvent(wt,L):R&&this._emitEvent(gt,L);var I=l.move,H=l.resize,B=l.rotate,G=M?Tt:S?Ot:_t,F=M&&H||S&&B||R&&I;n.notify(dt,this,{clientX:e,clientY:r,actionName:G,triggerEvent:F,factor:x,revX:m,revY:g,doW:_,doH:E}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,n=this.options;if(r.isTarget){var a=this._cursorPoint(t),o=a.x,i=a.y;r.e=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,c=r.doDrag,l=r.doResize,u=r.cursor,h=n.cursorMove,f=n.cursorResize,v=n.cursorRotate;w(u)&&(c?u=h:s?u=v:l&&(u=f),N(document.body).css({cursor:u}))}}},{key:"_end",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.each,a=this.observable,o=this.storage,i=this.storage,s=i.doResize,c=i.doDrag,l=i.doRotate,u=i.frame,h=i.handles.radius,f=i.isTarget,v=this.proxyMethods;if(f){var d=s?Tt:c?_t:Ot;o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(d);var y={clientX:e,clientY:r};v.onDrop.call(this,y),s?this._emitEvent(kt,y):l?this._emitEvent(St,y):c&&this._emitEvent(Et,y);var p=n.move,b=n.resize,m=n.rotate,g=s&&b||l&&m||c&&p;a.notify(yt,this,{clientX:e,clientY:r,actionName:d,triggerEvent:g}),x(u),N(document.body).css({cursor:"auto"}),k(h)&&lt(h,"".concat("sjx-","hidden"))}}},{key:"_compute",value:function(t,e){var r=this.storage.handles,n=N(t.target),a=this._checkHandles(n,r),o=a.revX,s=a.revY,c=a.doW,l=a.doH,h=u(a,["revX","revY","doW","doH"]),f=this._getState({revX:o,revY:s,doW:c,doH:l}),v=this._cursorPoint(t),d=v.x,y=v.y,p=Math.atan2(y-f.center.y,d-f.center.x);return i(i(i({},f),h),{},{handle:Object.values(r).some((function(e){return N(t.target).is(e)}))?n:N(e),pressang:p})}},{key:"_checkHandles",value:function(t,e){var r=function(r){return r.some((function(r){return n=e[r],!!k(n)&&t.is(n);var n}))};return{revX:r([Yt,Bt,Lt,Xt,qt]),revY:r([Yt,zt,Xt,Bt,Ft]),onTopEdge:r([Xt,zt,Yt,Ft]),onLeftEdge:r([Yt,Bt,Lt,qt]),onRightEdge:r([zt,Gt,It,Zt]),onBottomEdge:r([It,Ht,Lt,Wt]),doW:r([Bt,Gt,qt,Zt]),doH:r([Xt,Ht,Wt,Ft])}}},{key:"_destroy",value:function(){var t=this,e=this.el,r=this.storage,n=r.controls,a=r.wrapper;[e,n].map((function(e){return N(e).off(Nt,t._onMouseDown).off(jt,t._onTouchStart)})),a.parentNode.removeChild(a)}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=u(t,["radians"]),n=this.options.snap.angle;this._rotate(i({radians:ot(e,n)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:r}),a&&(this._apply(n),this._emitEvent("".concat(n,"End"),{clientX:e,clientY:r}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent,o=u(t,["clientX","clientY","actionName","triggerEvent"]);if(a){var s=this._getState(o);this.storage=i(i({},this.storage),s),this._emitEvent("".concat(n,"Start"),{clientX:e,clientY:r})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,a=this.observable;(r||e||n)&&a.subscribe(dt,this).subscribe(yt,this),r&&a.subscribe(pt,this),e&&a.subscribe(bt,this),n&&a.subscribe(xt,this)}},{key:"unsubscribe",value:function(){var t=this,e=this.observable;vt.map((function(r){return e.unsubscribe(r,t)}))}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;w(t)||(t.onExecution&&N(document).off(Dt,this._onMouseMove).off(Vt,this._onMouseUp).off(Pt,this._onTouchMove).off(Ct,this._onTouchEnd),ut(r,"".concat("sjx-","drag")),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,r=t.dy;this.options.draggable&&(this.storage=i(i({},this.storage),this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:r}),this._apply(_t))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,n=t.revX,a=void 0!==n&&n,o=t.revY,s=void 0!==o&&o,c=t.doW,l=void 0!==c&&c,u=t.doH,h=void 0!==u&&u;this.options.resizable&&(this.storage=i(i({},this.storage),this._getState({revX:a,revY:s,doW:l,doH:h})),this._resize({dx:e,dy:r}),this._apply(Tt))}},{key:"exeRotate",value:function(t){var e=t.delta;this.options.rotatable&&(this.storage=i(i({},this.storage),this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:e}),this._apply(Ot))}}]),o}(),Qt=function(t){return t.map((function(t){return d(t)}))},$t=function(t){return t.reduce((function(e,r,n){return[].concat(d(e),[t[0][n],t[1][n],t[2][n],t[3][n]])}),[])},Jt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return d(Array(t)).map((function(t,e,r){return r.map((function(){return+!e--}))}))},Kt=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Jt().map((function(n,a){return n[3]=[t,e,r,1][a],n}))},te=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e?Qt(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r},ee=function(t,e){for(var r=[],n=0,a=t.length;n<a;++n){for(var o=0,i=0;i<a;++i)o+=+t[n][i]*e[i];r[n]=o}return r},re=function(t,e){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var a=0;a<t[0].length;a++){for(var o=0,i=0;i<t.length;i++)o+=t[i][a]*e[n][i];r[n].push(o)}}return r},ne=function(t){for(var e,r=Qt(t),n=r.length,a=[],o=0;o<n;o++)a[o]=[];for(var i=0;i<n;i++)for(var s=0;s<n;s++)a[i][s]=0,i==s&&(a[i][s]=1);for(var c=0;c<n;c++){e=r[c][c];for(var l=0;l<n;l++)r[c][l]/=e,a[c][l]/=e;for(var u=c+1;u<n;u++){e=r[u][c];for(var h=0;h<n;h++)r[u][h]-=r[c][h]*e,a[u][h]-=a[c][h]*e}}for(var f=n-1;f>0;f--)for(var v=f-1;v>=0;v--){e=r[v][f];for(var d=0;d<n;d++)r[v][d]-=r[f][d]*e,a[v][d]-=a[f][d]*e}for(var y=0;y<n;y++)for(var p=0;p<n;p++)r[y][p]=a[y][p];return r},ae=function(t,e){var r=v(e,3),n=r[0],a=r[1],o=r[2],i=Kt(-n,-a,-o),s=Kt(n,a,o);return re(re(i,t),s)},oe=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=arguments.length>2?arguments[2]:void 0,n=Jt(),a=t,o=r||se(a),i=!1;a&&a instanceof Element;){var s=ce(a,i);if(n=re(n,ae(o,s)),i=!0,a===e||null===a.offsetParent)break;a=a.offsetParent,o=se(a)}return n},ie=function(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),n=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]),a=Math.atan2(-t[0][3]/n,t[1][3]/n),o=Math.asin(t[3][1]/n),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(a=0,o=t[0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:a,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/n},scale:{sX:e,sY:r,sZ:n}}},se=function(t){var e=ft(t,"transform")||"none",r=Jt();if("none"===e)return r;var n=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==n.length)return[[+n[0],+n[2],0,+n[4]],[+n[1],+n[3],0,+n[5]],[0,0,1,0],[0,0,0,1]];for(var a=0;a<4;++a)for(var o=0;o<4;++o)r[o][a]=+n[4*a+o];return r},ce=function(t,e){for(var r=ft(t,"transform-origin"),n=r?r.split(" "):[],a=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1],o=0;o<n.length;++o)a[o]+=parseFloat(n[o]);return a},le=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=0,n=0,a=!1;t;){var o=oe(t.offsetParent),i=ee(te(o,!1),[t.offsetLeft+(a?t.clientLeft:0),t.offsetTop+(a?t.clientTop:0),0,1]),s=v(i,2),c=s[0],l=s[1];if(n+=c,r+=l,e===t)break;a=!0,t=t.offsetParent}return[n,r,0,1]},ue=P,he=X,fe=function(t){s(a,Ut);var r=f(a);function a(){return e(this,a),r.apply(this,arguments)}return n(a,[{key:"_init",value:function(t){var e=this,r=this.options,n=r.rotationPoint,a=r.container,o=r.controlsContainer,s=r.resizable,c=r.rotatable,l=r.showNormal,u=r.rotatorOffset,h=r.rotatorAnchor,f=t.offsetHeight,y=t.offsetWidth,p=xe(["sjx-wrapper"]),b=xe(["sjx-controls"]),x={},m=oe(t,a),g=v(le(t,a),2),_=g[0],E=g[1],M=["data-sjx-cx","data-sjx-cy"].map((function(e){var r=t.getAttribute(e);return k(r)?Number(r):void 0})),T=M.every((function(t){return!isNaN(t)})),O={tl:[0,0,0,1],bl:[0,f,0,1],br:[y,f,0,1],tr:[y,0,0,1],tc:[y/2,0,0,1],ml:[0,f/2,0,1],bc:[y/2,f,0,1],mr:[y,f/2,0,1],center:[y/2,f/2,0,1]},S=Object.entries(O).reduce((function(t,e){var r=v(e,2),n=r[0],a=r[1];return[].concat(d(t),[[n,ee(m,a)]])}),[]).reduce((function(t,e){var r=v(e,2),n=r[0],a=v(r[1],4),o=a[0],i=a[1],s=a[2],c=a[3];return t[n]=[o+_,i+E,s,c],t}),{}),A={},R=null;if(c){var j={},D=1;switch(h){case"n":j.x=S.tc[0],j.y=S.tc[1];break;case"s":j.x=S.bc[0],j.y=S.bc[1],D=-1;break;case"w":j.x=S.ml[0],j.y=S.ml[1],D=-1;break;case"e":default:j.x=S.mr[0],j.y=S.mr[1]}var V="n"===h||"s"===h?Math.atan2(S.bl[1]-S.tl[1],S.bl[0]-S.tl[0]):Math.atan2(S.tl[1]-S.tr[1],S.tl[0]-S.tr[0]);R=[j.x-u*D*Math.cos(V),j.y-u*D*Math.sin(V)];var P=l?de([[j.x,j.y],R],"normal"):null;l&&b.appendChild(P);var C=null;n&&(C=de([S.center,S.center],"radius"),lt(C,"sjx-hidden"),b.appendChild(C)),A=i(i({},A),{},{normal:P,radius:C})}var Y={te:[S.tl,S.tr],be:[S.bl,S.br],le:[S.tl,S.bl],re:[S.tr,S.br]},X=s?{tl:S.tl,tr:S.tr,br:S.br,bl:S.bl,tc:S.tc,bc:S.bc,ml:S.ml,mr:S.mr}:{},z=T?[].concat(d(M),[0,1]):S.center,L=i(i({},X),{},{center:n&&c?z:void 0,rotator:R}),I=function(t,e){return Object.keys(t).map((function(r){var n=t[r];if(!w(n)){var a=e(n,r);x[r]=a,b.appendChild(a)}}))};I(Y,de),I(L,ve),p.appendChild(b),o.appendChild(p),this.storage={wrapper:p,controls:b,handles:i(i({},x),A),parent:t.parentNode,center:{isShifted:T},cached:{}},[t,b].map((function(t){return N(t).on(ue,e._onMouseDown).on(he,e._onTouchStart)}))}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm,a=ne(n);return this._applyMatrixToPoint(te(a,!1),e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.wrapperMatrix,a=ne(n);return this._applyMatrixToPoint(te(a,!1),e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=v(ee(t,[e,r,0,1]),2);return{x:n[0],y:n[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container,a=oe(n);return this._applyMatrixToPoint(ne(a),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,n=r.restrict,a=r.container,o=null,i=null,s=be(n,a,e),c=this.getBoundingRect(t),l=v(st(s,0),2),u=l[0],h=l[1],f=v(st(s,1),2),d=f[0],y=f[1],p=0,b=c.length;p<b;p++){var x=v(c[p],2),m=x[0],g=x[1];(m<u||m>h)&&(o=m),(g<d||g>y)&&(i=g)}return{x:o,y:i}}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.cached,n=e.controls,a=e.transform.matrix,o=e.center,i=this.options.applyTranslate,s=N(n);if(!w(r)){if(t.setAttribute("data-sjx-cx",o.elX),t.setAttribute("data-sjx-cy",o.elY),i){var c=N(t),l=r.dx,u=r.dy,h=ht(a),f=parseFloat(t.style.left||c.css("left")),v=parseFloat(t.style.top||c.css("top"));h.left="".concat(f+l,"px"),h.top="".concat(v+u,"px"),c.css(h),s.css(h)}this.storage.cached={}}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.transform,s=o.matrix,c=o.auxiliary.scale.translateMatrix,l=a.cached,u=(l=void 0===l?{}:l).dist,h=(u=void 0===u?{}:u).dx,f=void 0===h?t:h,d=u.dy,y=void 0===d?e:d,p=a.box,b=p.width,x=p.height,m=a.revX,g=a.revY,_=a.doW,E=a.doH,M=this.options,T=M.proportions,k=M.scalable,w=M.restrict,O=function(t,e){var r=_||!_&&!E?(b+t)/b:(x+e)/x,n=T?b*r:b+t,a=T?x*r:x+e;return[n/b,a/x,n,a]},S=function(t,e){var r=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Jt().map((function(a,o){return a[o]=[t,e,r,n][o],a}))}(t,e);return re(re(c,r),ne(c))},A=function(t,e){var r=t[0][3],n=t[1][3],a=Kt(r,n),o=Kt(r*(m?-1:1),n*(g?-1:1));return re(re(o,e),ne(a))},R=v(O(t,e),4),j=R[0],D=R[1],V=R[2],P=R[3],C=S(j,D),Y=k?re(C,s):A(C,s);this.storage.cached.box={width:V,height:P};var X=w?this._restrictHandler(Y):{x:null,y:null},z=X.x,L=X.y,I=(null!==z||null!==L)&&w,H=I?f:t,B=I?y:e,G=v(O(H,B),4),F=G[0],W=G[1],q=G[2],Z=G[3],U=S(F,W),Q=k?re(U,s):A(U,s);return q<=2||Z<=2||(N(r).css(i(i({},ht($t(Q))),!k&&{width:"".concat(q,"px"),height:"".concat(Z,"px")})),pe(n,this.options,{el:r,boxMatrix:Q}),n.cached.dist={dx:H,dy:B}),{transform:Q,width:q,height:Z}}},{key:"_processMove",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.wrapper,i=a.transform,s=i.matrix,c=i.wrapperMatrix,l=i.auxiliary.translate.parentMatrix,u=a.center,h=a.cached,f=(h=void 0===h?{}:h).dist,d=(f=void 0===f?{}:f).dx,y=void 0===d?t:d,p=f.dy,b=void 0===p?e:p,x=this.options.restrict,m=v(ee(l,[t,e,0,1]),2),g=m[0],_=m[1],E=re(s,Kt(g,_)),M=x?this._restrictHandler(E):{x:null,y:null},T=null!==M.x&&x?y:t,k=null!==M.y&&x?b:e,w=v(ee(l,[T,k,0,1]),2),O=w[0],S=w[1],A=re(s,Kt(O,S)),R=re(c,Kt(T,k)),j=ht($t(A)),D=ht($t(R));return N(r).css(j),N(o).css(D),n.cached.dist={dx:T,dy:k},u.isShifted,A}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage.transform,n=r.matrix,a=r.auxiliary.rotate.translateMatrix,o=this.options.restrict,i=it(Math.cos(t),4),s=function(t,e){var r=Jt();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r}(it(Math.sin(t),4),i),c=re(re(ne(a),s),a),l=re(n,c),u=o?this._restrictHandler(l):{x:null,y:null},h=u.x,f=u.y;return k(h)||k(f)||(N(e).css(ht($t(l))),pe(this.storage,this.options,{el:e,boxMatrix:l})),l}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,s=this.storage,c=s.handles.center,l=s.parent,u=s.wrapper,h=s.center,f=this.options,d=f.container,y=f.restrict,p=f.scalable,b=y||d,x=b.offsetWidth,m=b.offsetHeight,g=v(le(o,d),2),_=g[0],E=g[1],M=o.offsetLeft,T=o.offsetTop,k=o.offsetWidth,w=o.offsetHeight,O=se(o),S=oe(o,d),A=oe(l,d),R=oe(u,d),N=y?oe(y,y.parentNode):oe(d,d.parentNode),j=k/2,D=w/2,V=a?0:e?-j:j,P=n?0:r?-D:D,C=v(ee(S,[j,D,0,1]),2),Y=C[0]+_,X=C[1]+E,z=c?se(c):Jt(),L=(c?ie(oe(c)):{translate:{x:Y,y:X}}).translate,I=L.x,H=L.y,B=v(ee(re(ne(te(S)),te(z)),[I-Y,H-X,0,1]),2),G=B[0],F=B[1],W=v(ee(O,[G,F,0,1]),2),q=W[0],Z=W[1],U=ee(te(N),[x,m,0,1]),Q=ie(oe(o,o.parentNode)).scale,$=Q.sX,J=Q.sY;return{transform:{auxiliary:{scale:{translateMatrix:p?Kt(V,P):Kt(a?0:j,n?0:D)},translate:{parentMatrix:ne(te(A))},rotate:{translateMatrix:Kt(q,Z)}},scaleX:V,scaleY:P,matrix:O,ctm:S,parentMatrix:A,containerMatrix:N,wrapperMatrix:R,scX:$,scY:J,containerBox:U},box:{width:k,height:w,left:M,top:T,offset:{left:_,top:E}},center:i(i({},h),{},{x:Y,y:X,elX:q,elY:Z,matrix:z}),revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,a=r.center.matrix,o=re(a,Kt(t,e));N(n).css(i({},ht($t(o)))),this.storage.center.isShifted=!0}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.el,r=e.offsetHeight,n=e.offsetWidth,a=this.storage,o=a.wrapper,i=a.handles.center,s=this.options.container;if(i){var c=v(le(t,s),2),l=c[0],u=c[1],h=re(oe(t,s),ne(oe(o,o.parentNode))),f=v(ee(h,[n/2,r/2,0,1]),2),d=f[0],y=f[1];N(i).css({transform:"translate(".concat(d+l,"px, ").concat(y+u,"px)")})}}},{key:"fitControlsToSize",value:function(){var t=this.el;this.storage.wrapper.removeAttribute("transform"),pe(this.storage,this.options,{el:t})}},{key:"getBoundingRect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.el,r=this.options,n=r.scalable,a=r.restrict,o=this.storage,s=o.box,c=o.box,l=c.width,u=c.height,h=o.cached,f=(h=void 0===h?{}:h).box,v=(f=void 0===f?{}:f).width,d=void 0===v?l:v,y=f.height,p=void 0===y?u:y,b=n?s:i(i({},s),{},{width:d,height:p});return be(e,a,oe(e,a,t),b)}},{key:"controls",get:function(){return this.storage.wrapper}}]),a}(),ve=function(t){var e=v(t,2),r=e[0],n=e[1],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"handler",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=xe(["sjx-hdl","sjx-hdl-".concat(a)]);return N(s).css(i({transform:"translate(".concat(r,"px, ").concat(n,"px)")},o)),s},de=function(t,e){var r=v(t,3),n=r[0],a=r[1],o=r[2],i=void 0===o?1:o,s=ye(n,a,i),c=s.cx,l=s.cy,u=s.length,h=s.theta,f=xe(["sjx-hdl-line","sjx-hdl-".concat(e)]);return N(f).css({transform:"translate(".concat(c,"px, ").concat(l,"px) rotate(").concat(h,"deg)"),height:"".concat(i,"px"),width:"".concat(u,"px")}),f},ye=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=v(t,2),a=n[0],o=n[1],i=v(e,2),s=i[0],c=i[1],l=Math.sqrt((s-a)*(s-a)+(c-o)*(c-o)),u=(a+s)/2-l/2,h=(o+c)/2-r/2,f=Math.atan2(o-c,a-s)*(180/Math.PI);return{cx:u,cy:h,thickness:r,theta:f,length:l}},pe=function(t,e,r){var n=t.wrapper,a=t.handles,o=t.transform,s=(o=void 0===o?{}:o).wrapperMatrix,c=void 0===s?oe(n,n.parentNode):s,l=t.center,u=e.rotationPoint,h=e.rotatable,f=e.resizable,y=e.showNormal,p=e.rotatorOffset,b=e.rotatorAnchor,x=e.container,m=r.el,g=r.el,_=g.offsetHeight,E=g.offsetWidth,M=v(le(m,x),2),T=M[0],k=M[1],w=re(oe(m,x),ne(c)),O=i({tl:[0,0,0,1],tr:[E,0,0,1],bl:[0,_,0,1],br:[E,_,0,1],tc:[E/2,0,0,1],ml:[0,_/2,0,1],bc:[E/2,_,0,1],mr:[E,_/2,0,1]},u&&h&&!l.isShifted&&{center:[E/2,_/2,0,1]}),S=Object.entries(O).reduce((function(t,e){var r=v(e,2),n=r[0],a=r[1];return[].concat(d(t),[[n,ee(w,a)]])}),[]).reduce((function(t,e){var r=v(e,2),n=r[0],a=v(r[1],4),o=a[0],i=a[1],s=a[2],c=a[3];return t[n]=[o+T,i+k,s,c],t}),{}),A=null,R={};if(h){var j,D={},V=1;switch(b){case"n":D.x=S.tc[0],D.y=S.tc[1];break;case"s":D.x=S.bc[0],D.y=S.bc[1],V=-1;break;case"w":D.x=S.ml[0],D.y=S.ml[1],V=-1;break;case"e":default:D.x=S.mr[0],D.y=S.mr[1]}var P="n"===b||"s"===b?Math.atan2(S.bl[1]-S.tl[1],S.bl[0]-S.tl[0]):Math.atan2(S.tl[1]-S.tr[1],S.tl[0]-S.tr[0]),C=p*V;j=[D.x-C*Math.cos(P),D.y-C*Math.sin(P)],A=y?[[D.x,D.y],j]:null,R={rotator:j}}var Y=i({},S),X=i({te:[S.tl,S.tr],be:[S.bl,S.br],le:[S.tl,S.bl],re:[S.tr,S.br]},y&&A&&{normal:A});Object.keys(X).forEach((function(t){var e=v(X[t],2),r=e[0],n=e[1],o=ye(r,n),i=o.cx,s=o.cy,c=o.length,l=o.theta;N(a[t]).css({transform:"translate(".concat(i,"px, ").concat(s,"px) rotate(").concat(l,"deg)"),width:"".concat(c,"px")})}));var z=i(i({},f&&Y),R);Object.keys(z).forEach((function(t){var e=z[t];if(e){var r=v(e,2),n=r[0],o=r[1];N(a[t]).css({transform:"translate(".concat(n,"px, ").concat(o,"px)")})}}))},be=function(t,e,r,n){var a=v(le(t,e),2),o=a[0],i=a[1],s=n||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},c=s.width,l=s.height,u=s.offset,h=u.left,f=u.top;return[[0,0,0,1],[c,0,0,1],[0,l,0,1],[c,l,0,1]].reduce((function(t,e){return[].concat(d(t),[ee(r,e)])}),[]).map((function(t){var e=v(t,4),r=e[0],n=e[1],a=e[2],o=e[3];return[r+h,n+f,a,o]}))},xe=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=document.createElement("div");return t.forEach((function(t){return lt(e,t)})),e},me=Ee("svg").createSVGPoint(),ge=/\s*,\s*|\s+/g,_e=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Ee(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=document.createElementNS("http://www.w3.org/2000/svg",t);return e.forEach((function(t){return lt(r,t)})),r}var Me=function t(e){var r=[];return Re(e)?g.call(e.childNodes,(function(e){if(1===e.nodeType){var n=e.tagName.toLowerCase();-1!==_e.indexOf(n)&&("g"===n&&r.push.apply(r,d(t(e))),r.push(e))}})):r.push(e),r},Te=function(){return Ee("svg").createSVGMatrix()},ke=function(t,e){var r=Te();return r.e=t,r.f=e,r},we=function(t,e){return(e.getScreenCTM&&e.getScreenCTM()||Te()).inverse().multiply(t.getScreenCTM()||Te())},Oe=function(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(a,",").concat(o,",").concat(i,")")},Se=function(t,e,r){return me.x=e,me.y=r,me.matrixTransform(t)},Ae=function(t){var e=Te();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e},Re=function(t){return"g"===t.tagName.toLowerCase()},Ne=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.replace(/([^e])-/g,"$1 -").replace(/ +/g," ")},je=function(t){return Ne(t).split(ge).reduce((function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t}),[])},De=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,Ve=function(t){for(var e=De.lastIndex=0,r=[];e=De.exec(t);){var n=v(e,3),a=n[1],o=n[2],i=a.toUpperCase(),s=Ne(o);r.push({relative:a!==i,key:i,cmd:a,values:s.trim().split(ge).map((function(t){if(!isNaN(t))return Number(t)}))})}return r},Pe=function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var a=Ve(e),o="",i=" ",s=!0,c=0,l=a.length;c<l;c++){var u=a[c],h=u.values,f=u.key,y=u.relative,p=[];switch(f){case"M":for(var b=0,x=h.length;b<x;b+=2){var m=v(h.slice(b,b+2),2),g=m[0],_=m[1];y&&!s||(g+=r,_+=n),p.push(g,_),s=!1}break;case"A":for(var E=0,M=h.length;E<M;E+=7){var k=h.slice(E,E+7);y||(k[5]+=r,k[6]+=n),p.push.apply(p,d(k))}break;case"C":for(var w=0,O=h.length;w<O;w+=6){var S=h.slice(w,w+6);y||(S[0]+=r,S[1]+=n,S[2]+=r,S[3]+=n,S[4]+=r,S[5]+=n),p.push.apply(p,d(S))}break;case"H":for(var A=0,R=h.length;A<R;A+=1){var N=h.slice(A,A+1);y||(N[0]+=r),p.push(N[0])}break;case"V":for(var j=0,D=h.length;j<D;j+=1){var V=h.slice(j,j+1);y||(V[0]+=n),p.push(V[0])}break;case"L":case"T":for(var P=0,C=h.length;P<C;P+=2){var Y=v(h.slice(P,P+2),2),X=Y[0],z=Y[1];y||(X+=r,z+=n),p.push(X,z)}break;case"Q":case"S":for(var L=0,I=h.length;L<I;L+=4){var H=v(h.slice(L,L+4),4),B=H[0],G=H[1],F=H[2],W=H[3];y||(B+=r,G+=n,F+=r,W+=n),p.push(B,G,F,W)}break;case"Z":h[0]="",i=""}o+=u.cmd+p.join(",")+i}return o}catch(t){T("Path parsing error: "+t)}},Ce=function(t){var e=t.path,r=t.localCTM;try{for(var n=Ve(e),a="",o=" ",i=[],s=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,d=u.relative;switch(f){case"A":for(var y=[],p=0,b=h.length;p<b;p+=7){var x=v(h.slice(p,p+7),7),m=x[0],g=x[1],_=x[2],E=x[3],M=x[4],k=x[5],w=x[6],O=Ae(r);d&&(O.e=O.f=0);var S=Se(O,k,w),A=S.x,R=S.y;y.push(it(A),it(R)),O.e=O.f=0;var N=Se(O,m,g),j=N.x,D=N.y;y.unshift(it(j),it(D),_,E,M)}i.push(y);break;case"C":for(var V=[],P=0,C=h.length;P<C;P+=6){var Y=v(h.slice(P,P+6),6),X=Y[0],z=Y[1],L=Y[2],I=Y[3],H=Y[4],B=Y[5],G=Ae(r);d&&(G.e=G.f=0);var F=Se(G,X,z),W=F.x,q=F.y,Z=Se(G,L,I),U=Z.x,Q=Z.y,$=Se(G,H,B),J=$.x,K=$.y;V.push(it(W),it(q),it(U),it(Q),it(J),it(K))}i.push(V);break;case"H":for(var tt=[],et=0,rt=h.length;et<rt;et+=1){var nt=v(h.slice(et,et+1),1)[0],at=Ae(r);d&&(at.e=at.f=0);var ot=Se(at,nt,0).x;tt.push(it(ot))}i.push(tt);break;case"V":for(var st=[],ct=0,lt=h.length;ct<lt;ct+=1){var ut=v(h.slice(ct,ct+1),1)[0],ht=Ae(r);d&&(ht.e=ht.f=0);var ft=Se(ht,0,ut).y;st.push(it(ft))}i.push(st);break;case"T":case"L":for(var vt=[],dt=0,yt=h.length;dt<yt;dt+=2){var pt=v(h.slice(dt,dt+2),2),bt=pt[0],xt=pt[1],mt=Ae(r);d&&(mt.e=mt.f=0);var gt=Se(mt,bt,xt),_t=gt.x,Et=gt.y;vt.push(it(_t),it(Et))}i.push(vt);break;case"M":for(var Mt=[],Tt=0,kt=h.length;Tt<kt;Tt+=2){var wt=v(h.slice(Tt,Tt+2),2),Ot=wt[0],St=wt[1],At=Ae(r);d&&!s&&(At.e=At.f=0);var Rt=Se(At,Ot,St),Nt=Rt.x,jt=Rt.y;Mt.push(it(Nt),it(jt)),s=!1}i.push(Mt);break;case"Q":for(var Dt=[],Vt=0,Pt=h.length;Vt<Pt;Vt+=4){var Ct=v(h.slice(Vt,Vt+4),4),Yt=Ct[0],Xt=Ct[1],zt=Ct[2],Lt=Ct[3],It=Ae(r);d&&(It.e=It.f=0);var Ht=Se(It,Yt,Xt),Bt=Ht.x,Gt=Ht.y,Ft=Se(It,zt,Lt),Wt=Ft.x,qt=Ft.y;Dt.push(it(Bt),it(Gt),it(Wt),it(qt))}i.push(Dt);break;case"S":for(var Zt=[],Ut=0,Qt=h.length;Ut<Qt;Ut+=4){var $t=v(h.slice(Ut,Ut+4),4),Jt=$t[0],Kt=$t[1],te=$t[2],ee=$t[3],re=Ae(r);d&&(re.e=re.f=0);var ne=Se(re,Jt,Kt),ae=ne.x,oe=ne.y,ie=Se(re,te,ee),se=ie.x,ce=ie.y;Zt.push(it(ae),it(oe),it(se),it(ce))}i.push(Zt);break;case"Z":i.push([""]),o=""}a+=u.cmd+i[c].join(",")+o}return a}catch(t){T("Path parsing error: "+t)}},Ye=V.E_DRAG,Xe=V.E_RESIZE,ze=P,Le=X,Ie=function(t){s(o,Ut);var r=f(o);function o(){return e(this,o),r.apply(this,arguments)}return n(o,[{key:"_init",value:function(t){var e=this,r=this.options,n=r.rotationPoint,o=r.container,s=r.controlsContainer,c=r.resizable,l=r.rotatable,u=r.rotatorAnchor,h=r.rotatorOffset,f=r.showNormal,d=r.custom,y=t.getBBox(),p=y.x,b=y.y,x=y.width,m=y.height,g=Ee("g",["sjx-svg-wrapper"]),_=Ee("g",["sjx-svg-controls"]),E=["data-sjx-cx","data-sjx-cy"].map((function(e){var r=t.getAttribute(e);return k(r)?Number(r):void 0})),M=E.every((function(t){return!isNaN(t)})),T={tl:[p,b],tr:[p+x,b],mr:[p+x,b+m/2],ml:[p,b+m/2],tc:[p+x/2,b],bc:[p+x/2,b+m],br:[p+x,b+m],bl:[p,b+m],center:[p+x/2,b+m/2]},S=we(t,o),A=Object.entries(T).reduce((function(t,e){var r=v(e,2),n=r[0],o=v(r[1],2),s=o[0],c=o[1];return i(i({},t),{},a({},n,Se(S,s,c)))}),{}),R={},j={},D=null;if(l){var V={},P=1;switch(u){case"n":V.x=A.tc.x,V.y=A.tc.y;break;case"s":V.x=A.bc.x,V.y=A.bc.y,P=-1;break;case"w":V.x=A.ml.x,V.y=A.ml.y,P=-1;break;case"e":default:V.x=A.mr.x,V.y=A.mr.y}var C="n"===u||"s"===u?Math.atan2(A.bl.y-A.tl.y,A.bl.x-A.tl.x):Math.atan2(A.tl.y-A.tr.y,A.tl.x-A.tr.x);D={x:V.x-h*P*Math.cos(C),y:V.y-h*P*Math.sin(C)};var Y=f?Ze([V,D],"#00a8ff","normal"):null;f&&_.appendChild(Y);var X=null;n&&((X=Ee("line",["sjx-hidden"])).x1.baseVal.value=A.center.x,X.y1.baseVal.value=A.center.y,X.x2.baseVal.value=E[0]||A.center.x,X.y2.baseVal.value=E[1]||A.center.y,We(X,"#fe3232"),X.setAttribute("opacity",.5),_.appendChild(X)),j=i(i({},j),{},{normal:Y,radius:X})}var z=c?{tl:A.tl,tr:A.tr,br:A.br,bl:A.bl,tc:A.tc,bc:A.bc,ml:A.ml,mr:A.mr}:{},L={te:[A.tl,A.tr],be:[A.bl,A.br],le:[A.tl,A.bl],re:[A.tr,A.br]};Object.keys(L).forEach((function(t){var e=L[t];w(e)||(R[t]=Ze(e,"#00a8ff",t),_.appendChild(R[t]))}));var I=M?Se(Te(),E[0],E[1]):A.center,H=i(i({},z),{},{rotator:D,center:n&&l?I:void 0});Object.keys(H).forEach((function(t){var e=H[t];if(!w(e)){var r=e.x,n=e.y,a="center"===t?"#fe3232":"#00a8ff";k(d)&&O(d[t])?R[t]=d[t](S,y,Se):R[t]=Fe(r,n,a,t),_.appendChild(R[t])}})),g.appendChild(_),s.appendChild(g),this.storage={wrapper:g,controls:_,handles:i(i({},R),j),parent:t.parentNode,center:{isShifted:M},cached:{}},[t,_].map((function(t){return N(t).on(ze,e._onMouseDown).on(Le,e._onTouchStart)}))}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container;return this._applyMatrixToPoint(n.getScreenCTM().inverse(),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,n=r.container,a=r.restrict,o=null,i=null,s=Ue(void 0===a?n:a,e),c=this.getBoundingRect(t),l=v(st(s,0),2),u=l[0],h=l[1],f=v(st(s,1),2),d=f[0],y=f[1],p=0,b=c.length;p<b;p++){var x=v(c[p],2),m=x[0],g=x[1];(m<u||m>h)&&(o=m),(g<d||g>y)&&(i=g)}return{x:o,y:i}}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.wrapperMatrix.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=Ee("svg").createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var e=this.el,r=this.storage,n=this.storage,a=n.bBox,o=n.cached,s=n.transform,c=n.center,l=this.options,u=this.options,h=u.container,f=u.scalable,v=u.applyTranslate,d=s.matrix,y=s.parentMatrix,p=s.ctm;if(e.setAttribute("data-sjx-cx",c.elX),e.setAttribute("data-sjx-cy",c.elY),!w(o)){var b=o.scaleX,x=o.scaleY,m=o.dx,g=o.dy,_=o.ox,E=o.oy,M=o.transformMatrix;if(t===Ye){if(!v||0===m&&0===g)return;var T=ke(m,g),k=T.multiply(d).multiply(T.inverse());if(e.setAttribute("transform",Oe(k)),Re(e))Me(e).forEach((function(t){var e=ke(m,g),r=e.multiply(we(t,t.parentNode)).multiply(e.inverse());if(function(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===n&&1===a&&0===o&&0===i}(r)||t.setAttribute("transform",Oe(r)),!Re(t)){var n=y.inverse();n.e=n.f=0,He(t,i({},Se(n,_,E)))}}));else He(e,{x:m,y:g})}if(t===Xe){if(!M)return;if(!f)if(Re(e)){Me(e).forEach((function(t){if(!Re(t)){var n=we(t,e),i=n.inverse().multiply(M).multiply(n);Be(t,{scaleX:b,scaleY:x,localCTM:i,bBox:a,container:h,storage:r,cached:o})}}))}else{var O=h.getScreenCTM()||Te(),S=e.getScreenCTM().multiply(M),A=O.inverse().multiply(S),R=p.inverse().multiply(A);Be(e,{scaleX:b,scaleY:x,localCTM:R,bBox:a,container:h,storage:r,cached:o})}Ge(r,l,{boxMatrix:f?p.multiply(M):p,element:e})}}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.bBox,s=o.width,c=o.height,l=a.revX,u=a.revY,h=a.doW,f=a.doH,y=a.transform,p=y.matrix,b=y.auxiliary.scale.translateMatrix,x=a.cached,m=(x=void 0===x?{}:x).dist,g=(m=void 0===m?{}:m).dx,_=void 0===g?t:g,E=m.dy,M=void 0===E?e:E,T=this.options,k=T.proportions,w=T.scalable,O=T.restrict,S=r.getBBox(),A=S.x,R=S.y,N=function(t,e){var r=h||!h&&!f?(s+t)/s:(c+e)/c,n=k?s*r:s+t,a=k?c*r:c+e;return[n/s,a/c,n,a]},j=function(t,e){var r=function(t,e){var r=Te();return r.a=t,r.d=e,r}(t,e);return b.multiply(r).multiply(b.inverse())},D=p.multiply(j.apply(void 0,d(N(t,e)))),V=O?this._restrictHandler(D):{x:null,y:null},P=V.x,C=V.y,Y=(null!==P||null!==C)&&O,X=Y?_:t,z=Y?M:e,L=v(N(X,z),4),I=L[0],H=L[1],B=L[2],G=L[3],F=j(I,H),W=p.multiply(F),q=A-(B-s)*(f?.5:l?1:0),Z=R-(G-c)*(h?.5:u?1:0);return w&&r.setAttribute("transform",Oe(W)),n.cached=i(i({},n.cached),{},{scaleX:I,scaleY:H,transformMatrix:F,resultMatrix:W,dist:{dx:X,dy:z}}),this._apply(Xe),{x:q,y:Z,width:B,height:G,transform:W}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=this.storage,a=n.wrapper,o=n.center,i=n.transform,s=i.matrix,c=i.auxiliary.translate,l=c.translateMatrix,u=c.wrapperTranslateMatrix,h=i.wrapperMatrix,f=i.parentMatrix,v=n.cached,d=(v=void 0===v?{}:v).dist,y=(d=void 0===d?{}:d).dx,p=void 0===y?t:y,b=d.dy,x=void 0===b?e:b,m=this.options.restrict;f.e=f.f=0;var g=Se(f.inverse(),t,e),_=g.x,E=g.y,M=ke(_,E).multiply(s),T=m?this._restrictHandler(M):{x:null,y:null},k=null!==T.x&&m?p:t,w=null!==T.y&&m?x:e;r.cached.dist={dx:k,dy:w};var O=Se(f.inverse(),k,w),S=O.x,A=O.y;l.e=S,l.f=A;var R=l.multiply(s);u.e=k,u.f=w;var N=u.multiply(h);if(a.setAttribute("transform",Oe(N)),this.el.setAttribute("transform",Oe(R)),o.isShifted){var j=h.inverse();j.e=j.f=0;var D=Se(j,k,w),V=D.x,P=D.y;this._moveCenterHandle(-V,-P)}return R}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.wrapper,n=e.transform,a=n.matrix,o=n.wrapperMatrix,i=n.parentMatrix,s=n.auxiliary.rotate,c=s.translateMatrix,l=s.wrapperTranslateMatrix,u=this.options.restrict,h=it(Math.cos(t)),f=function(t,e){var r=Te();return r.a=e,r.b=t,r.c=-t,r.d=e,r}(it(Math.sin(t)),h);i.e=i.f=0;var v=i.inverse().multiply(f).multiply(i),d=c.multiply(v).multiply(c.inverse()).multiply(a),y=u?this._restrictHandler(d):{x:null,y:null},p=y.x,b=y.y;if(k(p)||k(b))return d;var x=l.multiply(f).multiply(l.inverse()).multiply(o);return r.setAttribute("transform",Oe(x)),this.el.setAttribute("transform",Oe(d)),d}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,s=this.storage,c=s.wrapper,l=s.parent,u=s.handles.center,h=this.options,f=h.container,v=h.restrict,d=o.getBBox(),y=d.x,p=d.y,b=d.width,x=d.height,m=we(o,l),g=we(o,f),_=we(c,f),E=we(l,f),M=we(c,c.parentNode),T=E.inverse(),k=y+b*(a?.5:e?1:0),w=p+x*(n?.5:r?1:0),O=y+b/2,S=p+x/2,A=u?u.cx.baseVal.value:O,R=u?u.cy.baseVal.value:S,N=Se(_,A,R),j=N.x,D=N.y,V=u?Se(T,j,D):Se(m,O,S),P=V.x,C=V.y,Y=Se(g,O,S),X=Y.x,z=Y.y;qe(this.el),Me(o).forEach((function(t){t.__ctm__=we(t,t.parentNode),qe(t)}));var L=i(i({},this.storage.center||{}),{},{x:u?j:X,y:u?D:z,elX:P,elY:C,hx:u?u.cx.baseVal.value:null,hy:u?u.cy.baseVal.value:null}),I=v?we(v,v.parentNode):we(f,f.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:Te(),translateMatrix:ke(k,w)},translate:{parentMatrix:T,translateMatrix:Te(),wrapperTranslateMatrix:Te()},rotate:{translateMatrix:ke(L.elX,L.elY),wrapperTranslateMatrix:ke(L.x,L.y)}},matrix:m,ctm:g,parentMatrix:E,wrapperMatrix:M,containerMatrix:I,scX:Math.sqrt(g.a*g.a+g.b*g.b),scY:Math.sqrt(g.c*g.c+g.d*g.d)},bBox:d,center:L,revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,a=n.center,o=n.radius,i=r.center,s=i.hx,c=i.hy;if(!w(a)){var l=s+t,u=c+e;a.cx.baseVal.value=l,a.cy.baseVal.value=u,o.x2.baseVal.value=l,o.y2.baseVal.value=u,this.storage.center.isShifted=!0}}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.storage,r=e.bBox,n=r.width,a=r.height,o=r.x,i=r.y,s=e.handles,c=s.center,l=s.radius;if(c){var u=we(t,t.parentNode),h=Se(u,o+n/2,i+a/2),f=h.x,v=h.y;c.cx.baseVal.value=f,c.cy.baseVal.value=v,c.isShifted=!1,l.x2.baseVal.value=f,l.y2.baseVal.value=v}}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.storage.wrapper,r=this.options.container,n=t.getBBox(),a=n.width,o=n.height,i=n.x,s=n.y,c=we(t,r),l=Te();this.storage.transform.wrapperMatrix=l,e.setAttribute("transform",Oe(l)),Ge(this.storage,this.options,{x:i,y:s,width:a,height:o,boxMatrix:c,element:t})}},{key:"getBoundingRect",value:function(t){var e=this.el,r=this.options.restrict,n=this.storage.bBox;return Ue(e,we(e.parentNode,r).multiply(t),n)}},{key:"controls",get:function(){return this.storage.wrapper}}]),o}(),He=function(t,e){var r=e.x,n=e.y,a=[];switch(t.tagName.toLowerCase()){case"text":var o=k(t.x.baseVal[0])?t.x.baseVal[0].value+r:(Number(t.getAttribute("x"))||0)+r,i=k(t.y.baseVal[0])?t.y.baseVal[0].value+n:(Number(t.getAttribute("y"))||0)+n;a.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=k(t.x.baseVal.value)?t.x.baseVal.value+r:(Number(t.getAttribute("x"))||0)+r,c=k(t.y.baseVal.value)?t.y.baseVal.value+n:(Number(t.getAttribute("y"))||0)+n;a.push(["x",s],["y",c]);break;case"circle":case"ellipse":var l=t.cx.baseVal.value+r,u=t.cy.baseVal.value+n;a.push(["cx",l],["cy",u]);break;case"line":var h=t.x1.baseVal.value+r,f=t.y1.baseVal.value+n,v=t.x2.baseVal.value+r,d=t.y2.baseVal.value+n;a.push(["x1",h],["y1",f],["x2",v],["y2",d]);break;case"polygon":case"polyline":var y=je(t.getAttribute("points")).map((function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")})).join(" ");a.push(["points",y]);break;case"path":var p=t.getAttribute("d");a.push(["d",Pe({path:p,dx:r,dy:n})])}a.forEach((function(e){t.setAttribute(e[0],e[1])}))},Be=function(t,e){var r=e.scaleX,n=e.scaleY,a=e.localCTM,o=e.bBox,i=o.width,s=o.height,c=[];switch(t.tagName.toLowerCase()){case"text":case"tspan":var l=t.__data__,u=l.x,h=l.y,f=l.textLength,d=Se(a,u,h),y=d.x,p=d.y;c.push(["x",y+(r<0?i:0)],["y",p-(n<0?s:0)],["textLength",Math.abs(r*f)]);break;case"circle":var b=t.__data__,x=b.r,m=b.cx,g=b.cy,_=x*(Math.abs(r)+Math.abs(n))/2,E=Se(a,m,g),M=E.x,T=E.y;c.push(["r",_],["cx",M],["cy",T]);break;case"foreignobject":case"image":case"rect":var k=t.__data__,w=k.width,O=k.height,S=k.x,A=k.y,R=Se(a,S,A),N=R.x,j=R.y,D=Math.abs(w*r),V=Math.abs(O*n);c.push(["x",N-(r<0?D:0)],["y",j-(n<0?V:0)],["width",D],["height",V]);break;case"ellipse":var P=t.__data__,C=P.rx,Y=P.ry,X=P.cx,z=P.cy,L=Se(a,X,z),I=L.x,H=L.y,B=Te();B.a=r,B.d=n;var G=Se(B,C,Y),F=G.x,W=G.y;c.push(["rx",Math.abs(F)],["ry",Math.abs(W)],["cx",I],["cy",H]);break;case"line":var q=t.__data__,Z=q.resX1,U=q.resY1,Q=q.resX2,$=q.resY2,J=Se(a,Z,U),K=J.x,tt=J.y,et=Se(a,Q,$),rt=et.x,nt=et.y;c.push(["x1",K],["y1",tt],["x2",rt],["y2",nt]);break;case"polygon":case"polyline":var at=t.__data__.points,ot=je(at).map((function(t){var e=Se(a,Number(t[0]),Number(t[1])),r=e.x,n=e.y;return t[0]=it(r),t[1]=it(n),t.join(" ")})).join(" ");c.push(["points",ot]);break;case"path":var st=t.__data__.path;c.push(["d",Ce({path:st,localCTM:a})])}c.forEach((function(e){var r=v(e,2),n=r[0],a=r[1];t.setAttribute(n,a)}))},Ge=function(t,e,r){var n=e.rotatable,a=e.rotatorAnchor,o=e.rotatorOffset,s=t.wrapper,c=t.handles,l=t.center,u=t.transform,h=(u=void 0===u?{}:u).wrapperMatrix,f=void 0===h?we(s,s.parentNode):h,d=r.boxMatrix,y=r.element.getBBox(),p=y.x,b=y.y,x=y.width,m=y.height,g=x/2,_=m/2,E=f.inverse().multiply(d),M=Se(E,p+g,b+_),T=i({tl:[p,b],tr:[p+x,b],mr:[p+x,b+_],ml:[p,b+_],tc:[p+g,b],bc:[p+g,b+m],br:[p+x,b+m],bl:[p,b+m]},!l.isShifted&&{center:[p+g,b+_]}),O=Object.entries(T).reduce((function(t,e){var r=v(e,2),n=r[0],a=r[1];return t[n]=Se(E,a[0],a[1]),t}),{}),S={te:[O.tl,O.tr],be:[O.bl,O.br],le:[O.tl,O.bl],re:[O.tr,O.br]};if(n){var A={},R=1;switch(a){case"n":A.x=O.tc.x,A.y=O.tc.y;break;case"s":A.x=O.bc.x,A.y=O.bc.y,R=-1;break;case"w":A.x=O.ml.x,A.y=O.ml.y,R=-1;break;case"e":default:A.x=O.mr.x,A.y=O.mr.y}var N="n"===a||"s"===a?Math.atan2(O.bl.y-O.tl.y,O.bl.x-O.tl.x):Math.atan2(O.tl.y-O.tr.y,O.tl.x-O.tr.x),j=o*R,D={x:A.x-j*Math.cos(N),y:A.y-j*Math.sin(N)},V=c.normal,P=c.radius;k(V)&&(V.x1.baseVal.value=A.x,V.y1.baseVal.value=A.y,V.x2.baseVal.value=D.x,V.y2.baseVal.value=D.y),k(P)&&(P.x1.baseVal.value=M.x,P.y1.baseVal.value=M.y,l.isShifted||(P.x2.baseVal.value=M.x,P.y2.baseVal.value=M.y)),O.rotator=D}Object.keys(S).forEach((function(t){var e=c[t],r=v(S[t],2),n=r[0],a=r[1];w(n)||w(e)||Object.entries({x1:n.x,y1:n.y,x2:a.x,y2:a.y}).map((function(t){var r=v(t,2),n=r[0],a=r[1];return e.setAttribute(n,a)}))})),Object.keys(O).forEach((function(t){var e=c[t],r=O[t];w(r)||w(e)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))}))},Fe=function(t,e,r,n){var a=Ee("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(n)]),o={cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"};return Object.entries(o).forEach((function(t){var e=v(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)})),a},We=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},qe=function(t){switch(t.tagName.toLowerCase()){case"text":var e=k(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,r=k(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,n=k(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null;t.__data__={x:e,y:r,textLength:n};break;case"circle":var a=t.r.baseVal.value,o=t.cx.baseVal.value,i=t.cy.baseVal.value;t.__data__={r:a,cx:o,cy:i};break;case"foreignobject":case"image":case"rect":var s=t.width.baseVal.value,c=t.height.baseVal.value,l=t.x.baseVal.value,u=t.y.baseVal.value;t.__data__={width:s,height:c,x:l,y:u};break;case"ellipse":var h=t.rx.baseVal.value,f=t.ry.baseVal.value,v=t.cx.baseVal.value,d=t.cy.baseVal.value;t.__data__={rx:h,ry:f,cx:v,cy:d};break;case"line":var y=t.x1.baseVal.value,p=t.y1.baseVal.value,b=t.x2.baseVal.value,x=t.y2.baseVal.value;t.__data__={resX1:y,resY1:p,resX2:b,resY2:x};break;case"polygon":case"polyline":var m=t.getAttribute("points");t.__data__={points:m};break;case"path":var g=t.getAttribute("d");t.__data__={path:g}}},Ze=function(t,e,r){var n=v(t,2),a=n[0],o=n[1],i=Ee("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),s={x1:a.x,y1:a.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return Object.entries(s).forEach((function(t){var e=v(t,2),r=e[0],n=e[1];return i.setAttribute(r,n)})),i},Ue=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getBBox(),n=r.x,a=r.y,o=r.width,i=r.height,s=[[n,a],[n+o,a],[n+o,a+i],[n,a+i]];return s.map((function(t){var r=v(t,2),n=r[0],a=r[1],o=Se(e,n,a);return[o.x,o.y]}))};function Qe(t,e){if(this.length){var r=k(e)&&e instanceof Z?e:new Z;return M.call(this,(function(e,n){var a;return n instanceof SVGElement?(a=n.tagName.toLowerCase(),(-1!==_e.indexOf(a)||(T('Selected element "'.concat(a,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),0))&&e.push(new Ie(n,t,r))):e.push(new fe(n,t,r)),e}),[])}}var $e=V.EMITTER_EVENTS,Je=P,Ke=X,tr=function(r){s(o,rt);var a=f(o);function o(t,r){var n;return e(this,o),(n=a.call(this,t)).enable(r),n}return n(o,[{key:"_init",value:function(){var t=this,e=this.el,r=this.options,n=N(e),a=r.style,o=r.appendTo,s=i({position:"absolute","z-index":"2147483647"},a);this.storage={css:s,parent:k(o)?N(o)[0]:document.body},n.on(Je,this._onMouseDown).on(Ke,this._onTouchStart),$e.slice(0,3).forEach((function(e){t.eventDispatcher.registerEvent(e)}))}},{key:"_processOptions",value:function(e){var r={},n=null,a=document,o=function(){},i=function(){},s=function(){},c=function(){};if(k(e)){var l=e.style,u=e.appendTo,h=e.stack,f=e.onInit,v=e.onMove,d=e.onDrop,y=e.onDestroy;r=k(l)&&"object"===t(l)?l:r,n=u||null;var p=k(h)?N(h)[0]:document;o=S(f),i=S(v),s=O(d)?function(t){var e,r,n,a,o,i,s,c,l,u,h=this.storage.clone;(r=p,n=ct(e=h),a=n.top,o=n.left,i=ct(r),s=i.top,c=i.left,l=N(e),u=N(r),!(a<s||a+parseFloat(l.css("height"))>s+parseFloat(u.css("height"))||o<c||o+parseFloat(l.css("width"))>c+parseFloat(u.css("width"))))&&d.call(this,t,this.el,h)}:function(){},c=S(y)}this.options={style:r,appendTo:n,stack:a},this.proxyMethods={onInit:o,onDrop:s,onMove:i,onDestroy:c}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,a=this.el,o=n.parent,i=n.css,s=ct(o),c=s.left,l=s.top;i.left="".concat(e-c,"px"),i.top="".concat(r-l,"px");var u=a.cloneNode(!0);N(u).css(i),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=u,N(o)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage;n.clientX=e,n.clientY=r,n.doDraw=!0,n.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,x(n),w(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=b(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,a=t.cx,o=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-a,dy:n-o}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,n="translate(".concat(t,"px, ").concat(e,"px)");N(r).css({transform:n,webkitTranform:n,mozTransform:n,msTransform:n,otransform:n})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;w(t)||(N(r).off(Je,this._onMouseDown).off(Ke,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),o}();function er(t){if(this.length)return E.call(this,(function(e){return new tr(e,t)}))}var rr=function(t){s(a,A);var r=f(a);function a(){return e(this,a),r.apply(this,arguments)}return n(a,[{key:"drag",value:function(){return Qe.call.apply(Qe,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return er.call.apply(er,[this].concat(Array.prototype.slice.call(arguments)))}}]),a}();function nr(t){return new rr(t)}Object.defineProperty(nr,"createObservable",{value:function(){return new Z}}),Object.defineProperty(nr,"Subjx",{value:rr}),Object.defineProperty(nr,"Observable",{value:Z}),module.exports=nr;
