/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function C(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function tt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){C(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(n){return function(){var t,e=o(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return l(this,t)}}function ie(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw o}}return r}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function F(t){return null==t}function Y(t){return"function"==typeof t}function et(t){return Y(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var q=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},g=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,e=t.forEach,v=t.slice,d=t.map,p=t.reduce,se=console.warn,B=function(t){return null!=t},b=function(){function o(t){if(i(this,o),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==K(t)||1!==t.nodeType&&t!==document)if(t instanceof o){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!function(t){return B(t)&&"object"===K(t)&&(Array.isArray(t)||B(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||B(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");for(var a=this.length=0;a<this.length;a++)1===t.nodeType&&(this[a]=t[a],this.length++)}else this[0]=t,this.length=1}return r(o,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,v.call(arguments,1)):"object"!==K(r)&&r?(se("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.addEventListener?this[a].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[a].attachEvent("on".concat(t),e):this[a]["on".concat(t)]=e:x(this[a],t,e,r,n,!0);return this}},{key:"off",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[a].removeEventListener(t,e,r):document.detachEvent?this[a].detachEvent("on".concat(t),e):this[a]["on".concat(t)]=null:x(this[a],t,e,r,n,!1);return this}},{key:"is",value:function(t){if(F(t))return!1;for(var e=rt(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),o}();function x(t,e,r,n,a,o){function i(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,a||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,a||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function rt(t){return new b(t)}function Z(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0}function ce(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}function _(t,e){var r=t.map(function(t){return t[e]});return[Math.min.apply(Math,W(r)),Math.max.apply(Math,W(r))]}function m(t){return t.getBoundingClientRect()}function nt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function G(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function U(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function E(t,e){var r,n=window.getComputedStyle(t),a=null,o=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=h(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){i=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}(P);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(a=n.getPropertyValue("".concat(i).concat(e))||a)break}}catch(t){o.e(t)}finally{o.f()}return a}function M(t){return t.map(function(t){return W(t)})}function Q(n){return n.reduce(function(t,e,r){return[].concat(W(t),[n[0][r],n[1][r],n[2][r],n[3][r]])},[])}function $(t){return W(Array(0<arguments.length&&void 0!==t?t:4)).map(function(t,e,r){return r.map(function(){return+!e--})})}function J(r,n,t){var a=2<arguments.length&&void 0!==t?t:0;return $().map(function(t,e){return t[3]=[r,n,a,1][e],t})}function at(t,e){var r=!(1<arguments.length&&void 0!==e)||e?M(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r}function ot(t,e){for(var r=[],n=0,a=t.length;n<a;++n){for(var o=0,i=0;i<a;++i)o+=+t[n][i]*e[i];r[n]=o}return r}function it(t,e){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var a=0;a<t[0].length;a++){for(var o=0,i=0;i<t.length;i++)o+=t[i][a]*e[n][i];r[n].push(o)}}return r}function st(t){for(var e,r=M(t),n=r.length,a=[],o=0;o<n;o++)a[o]=[];for(var i=0;i<n;i++)for(var s=0;s<n;s++)a[i][s]=0,i==s&&(a[i][s]=1);for(var c=0;c<n;c++){e=r[c][c];for(var l=0;l<n;l++)r[c][l]/=e,a[c][l]/=e;for(var u=c+1;u<n;u++){e=r[u][c];for(var h=0;h<n;h++)r[u][h]-=r[c][h]*e,a[u][h]-=a[c][h]*e}}for(var f=n-1;0<f;f--)for(var v=f-1;0<=v;v--){e=r[v][f];for(var d=0;d<n;d++)r[v][d]-=r[f][d]*e,a[v][d]-=a[f][d]*e}for(var y=0;y<n;y++)for(var p=0;p<n;p++)r[y][p]=a[y][p];return r}function ct(t,e,r){for(var n,a,o,i,s,c,l,u=1<arguments.length&&void 0!==e?e:document.body,h=2<arguments.length?r:void 0,f=$(),v=t,d=h||we(v),y=!1;v&&v instanceof Element;){var p=Oe(v,y);if(f=it(f,(n=d,void 0,a=ie(p,3),o=a[0],i=a[1],s=a[2],c=J(-o,-i,-s),l=J(o,i,s),it(it(c,n),l))),y=!0,v===u||null===v.offsetParent)break;v=v.offsetParent,d=we(v)}return f}function lt(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),n=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]),a=Math.atan2(-t[0][3]/n,t[1][3]/n),o=Math.asin(t[3][1]/n),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=t[a=0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:a,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/n},scale:{sX:e,sY:r,sZ:n}}}function ut(t,e){for(var r=1<arguments.length&&void 0!==e?e:document.body,n=0,a=0,o=!1;t;){var i=ct(t.offsetParent),s=ie(ot(at(i,!1),[t.offsetLeft+(o?t.clientLeft:0),t.offsetTop+(o?t.clientTop:0),0,1]),2);if(a+=s[0],n+=s[1],r===t)break;o=!0,t=t.offsetParent}return[a,n,0,1]}var ht=2,X="#00a8ff",ft="sjx-",T="dragStart",k="drag",w="dragEnd",O="resizeStart",S="resize",A="resizeEnd",R="rotateStart",N="rotate",j="rotateEnd",D="setPointStart",V="setPointEnd",P=["","-webkit-","-moz-","-ms-","-o-"],L="ongetstate",I="onapply",z="onmove",H="onresize",vt="onrotate",dt={NOTIFIER_EVENTS:[L,I,z,H,vt],ON_GETSTATE:L,ON_APPLY:I,ON_MOVE:z,ON_RESIZE:H,ON_ROTATE:vt},yt={EMITTER_EVENTS:[T,k,,w,O,S,A,R,N,j,D,V],E_DRAG_START:T,E_DRAG:k,E_DRAG_END:w,E_RESIZE_START:O,E_RESIZE:S,E_RESIZE_END:A,E_ROTATE_START:R,E_ROTATE:N,E_ROTATE_END:j,E_SET_POINT_START:D,E_SET_POINT_END:V},pt="mousedown",bt="mouseup",xt="mousemove",mt="touchstart",gt="touchend",_t="touchmove",Et={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},Mt={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},Tt=dt.ON_GETSTATE,kt=dt.ON_APPLY,wt=dt.ON_MOVE,Ot=dt.ON_RESIZE,St=dt.ON_ROTATE,At=function(){function t(){i(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return F(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(B(r[t])){var n=r[t].indexOf(e);r[t].splice(n,1)}return this}},{key:"notify",value:function(e,r,n){F(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case wt:t.notifyMove(n);break;case St:t.notifyRotate(n);break;case Ot:t.notifyResize(n);break;case kt:t.notifyApply(n);break;case Tt:t.notifyGetState(n)}})}}]),t}(),Rt=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return r(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}(),Nt=function(){function t(){i(this,t),this.events={}}return r(t,[{key:"registerEvent",value:function(t){this.events[t]=new Rt(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),jt=yt.E_DRAG,Dt=xt,Vt=bt,Pt=_t,Ct=gt,Yt=function(){function e(t){i(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new Nt,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){Xt()}},{key:"_init",value:function(){Xt()}},{key:"_destroy",value:function(){Xt()}},{key:"_processOptions",value:function(){Xt()}},{key:"_start",value:function(){Xt()}},{key:"_moving",value:function(){Xt()}},{key:"_end",value:function(){Xt()}},{key:"_animate",value:function(){Xt()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,n=y(t,["dx","dy"]),a=tt({dx:e,dy:r,transform:this._processMove(e,r)},n);this.proxyMethods.onMove.call(this,a),this._emitEvent(jt,a)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),rt(document).on(Dt,this._onMouseMove).on(Vt,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),rt(document).on(Pt,this._onTouchMove).on(Ct,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){rt(document).off(Dt,this._onMouseMove).off(Vt,this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){rt(document).off(Pt,this._onTouchMove).off(Ct,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),Xt=function(){throw Error("Method not implemented")},Lt=Math.PI/180,It=dt.NOTIFIER_EVENTS,zt=dt.ON_GETSTATE,Ht=dt.ON_APPLY,Bt=dt.ON_MOVE,Gt=dt.ON_RESIZE,Ft=dt.ON_ROTATE,Wt=yt.EMITTER_EVENTS,qt=yt.E_DRAG_START,Zt=yt.E_DRAG,Ut=yt.E_DRAG_END,Qt=yt.E_RESIZE_START,$t=yt.E_RESIZE,Jt=yt.E_RESIZE_END,Kt=yt.E_ROTATE_START,te=yt.E_ROTATE,ee=yt.E_ROTATE_END,re=Et,ne=Mt,ae=pt,oe=mt,le=xt,ue=bt,he=_t,fe=gt,ve=re.TOP_LEFT,de=re.TOP_CENTER,ye=re.TOP_RIGHT,pe=re.BOTTOM_LEFT,be=re.BOTTOM_RIGHT,xe=re.BOTTOM_CENTER,me=re.MIDDLE_LEFT,ge=re.MIDDLE_RIGHT,_e=ne.TOP_EDGE,Ee=ne.BOTTOM_EDGE,Me=ne.LEFT_EDGE,Te=ne.RIGHT_EDGE,ke=function(){s(o,Yt);var a=u(o);function o(t,e,r){var n;if(i(this,o),(n=a.call(this,t)).constructor===o)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,Wt.forEach(function(t){return n.eventDispatcher.registerEvent(t)}),n.enable(e),n}return r(o,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,r=y(t,["radians"]),n=tt({transform:this._processRotate(e),delta:e},r);this.proxyMethods.onRotate.call(this,n),this._emitEvent(te,n)}},{key:"_resize",value:function(t){var e=t.dx,r=t.dy,n=y(t,["dx","dy"]),a=tt({},this._processResize(e,r),{dx:e,dy:r},n);this.proxyMethods.onResize.call(this,a),this._emitEvent($t,a)}},{key:"_processOptions",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},r=this.el;nt(r,"".concat(ft,"drag"));var n=e.each,a=void 0===n?{move:!1,resize:!1,rotate:!1}:n,o=e.snap,i=void 0===o?{x:10,y:10,angle:10}:o,s=e.axis,c=void 0===s?"xy":s,l=e.cursorMove,u=void 0===l?"auto":l,h=e.cursorResize,f=void 0===h?"auto":h,v=e.cursorRotate,d=void 0===v?"auto":v,y=e.rotationPoint,p=void 0!==y&&y,b=e.restrict,x=e.draggable,m=void 0===x||x,g=e.resizable,_=void 0===g||g,E=e.rotatable,M=void 0===E||E,T=e.scalable,k=void 0!==T&&T,w=e.applyTranslate,O=void 0!==w&&w,S=e.onInit,A=void 0===S?function(){}:S,R=e.onDrop,N=void 0===R?function(){}:R,j=e.onMove,D=void 0===j?function(){}:j,V=e.onResize,P=void 0===V?function(){}:V,C=e.onRotate,Y=void 0===C?function(){}:C,X=e.onDestroy,L=void 0===X?function(){}:X,I=e.container,z=void 0===I?r.parentNode:I,H=e.controlsContainer,B=void 0===H?z:H,G=e.proportions,F=void 0!==G&&G,W=e.rotatorAnchor,q=void 0===W?null:W,Z=e.rotatorOffset,U=void 0===Z?50:Z,Q=e.showNormal,$=void 0===Q||Q,J=e.custom;this.options={axis:c,cursorMove:u,cursorRotate:d,cursorResize:f,rotationPoint:p,restrict:b?rt(b)[0]||document.body:null,container:rt(z)[0],controlsContainer:rt(B)[0],snap:tt({},i,{angle:i.angle*Lt}),each:a,proportions:F,draggable:m,resizable:_,rotatable:M,scalable:k,applyTranslate:O,custom:"object"===K(J)&&J||null,rotatorAnchor:q,rotatorOffset:U,showNormal:$},this.proxyMethods={onInit:et(A),onDrop:et(N),onMove:et(D),onResize:et(P),onRotate:et(Y),onDestroy:et(L)},this.subscribe(a)}},{key:"_animate",value:function(){var t=this,e=t.observable,r=t.storage,n=t.options;if(!F(r)&&(r.frame=q(t._animate),r.doDraw)){r.doDraw=!1;var a=r.dox,o=r.doy,i=r.clientX,s=r.clientY,c=r.doDrag,l=r.doResize,u=r.doRotate,h=r.doSetCenter,f=r.revX,v=r.revY,d=n.snap,y=n.each,p=y.move,b=y.resize,x=y.rotate,m=n.draggable,g=n.resizable,_=n.rotatable;if(l&&g){var E=r.transform,M=E.scX,T=E.scY,k=r.cx,w=r.cy,O=this._pointToElement({x:i,y:s}),S=O.x,A=O.y,R=a?Z(S-k,d.x/M):0,N=o?Z(A-w,d.y/T):0,j={dx:R=a?f?-R:R:0,dy:N=o?v?-N:N:0,clientX:i,clientY:s};t._resize(j),b&&e.notify(Gt,t,j)}if(c&&m){var D=r.nx,V=r.ny,P={dx:a?Z(i-D,d.x):0,dy:o?Z(s-V,d.y):0,clientX:i,clientY:s};t._drag(P),p&&e.notify(Bt,t,P)}if(u&&_){var C=r.pressang,Y=r.center,X=Math.atan2(s-Y.y,i-Y.x)-C,L={clientX:i,clientY:s};t._rotate(tt({radians:Z(X,d.angle)},L)),x&&e.notify(Ft,t,tt({radians:X},L))}if(h&&_){var I=r.bx,z=r.by,H=this._pointToControls({x:i,y:s}),B=H.x,G=H.y;t._moveCenterHandle(B-I,G-z)}}}},{key:"_start",value:function(e){var t=e.clientX,r=e.clientY,n=this.observable,a=this.storage,o=this.storage.handles,i=this.options,s=i.axis,c=i.each,l=this.el,u=Object.values(o).some(function(t){return rt(e.target).is(t)})||l.contains(e.target);if(a.isTarget=u){var h=this._compute(e,l);Object.keys(h).map(function(t){return a[t]=h[t]});var f=h.onRightEdge,v=h.onBottomEdge,d=h.onTopEdge,y=h.onLeftEdge,p=h.handle,b=h.factor,x=h.revX,m=h.revY,g=h.doW,_=h.doH,E=f||v||d||y,M=o.rotator,T=o.center,k=o.radius;B(k)&&G(k,"".concat(ft,"hidden"));var w=p.is(M),O=!!B(T)&&p.is(T),S=l.contains(e.target)&&!(w||E||O),A=this._cursorPoint({clientX:t,clientY:r}),R=A.x,N=A.y,j=this._pointToElement({x:R,y:N}),D=j.x,V=j.y,P=this._pointToControls({x:R,y:N}),C={clientX:t,clientY:r,cx:D,cy:V,nx:R,ny:N,bx:P.x,by:P.y,doResize:E,doDrag:S,doRotate:w,doSetCenter:O,onExecution:!0,cursor:null,dox:/\x/.test(s)&&(!E||(p.is(o.ml)||p.is(o.mr)||p.is(o.tl)||p.is(o.tr)||p.is(o.bl)||p.is(o.br)||p.is(o.le)||p.is(o.re))),doy:/\y/.test(s)&&(!E||(p.is(o.br)||p.is(o.bl)||p.is(o.bc)||p.is(o.tr)||p.is(o.tl)||p.is(o.tc)||p.is(o.te)||p.is(o.be))),cached:{}};this.storage=tt({},a,{},C);var Y={clientX:t,clientY:r};E?this._emitEvent(Qt,Y):w?this._emitEvent(Kt,Y):S&&this._emitEvent(qt,Y);var X=c.move,L=c.resize,I=c.rotate,z=E?$t:w?te:Zt,H=E&&L||w&&I||S&&X;n.notify(zt,this,{clientX:t,clientY:r,actionName:z,triggerEvent:H,factor:b,revX:x,revY:m,doW:g,doH:_}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,n=this.options;if(r.isTarget){var a=this._cursorPoint(t),o=a.x,i=a.y;r.e=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,c=r.doDrag,l=r.doResize,u=r.cursor,h=n.cursorMove,f=n.cursorResize,v=n.cursorRotate;F(u)&&(c?u=h:s?u=v:l&&(u=f),rt(document.body).css({cursor:u}))}}},{key:"_end",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.each,a=this.observable,o=this.storage,i=this.storage,s=i.doResize,c=i.doDrag,l=i.doRotate,u=i.frame,h=i.handles.radius,f=i.isTarget,v=this.proxyMethods;if(f){var d=s?$t:c?Zt:te;o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(d);var y={clientX:e,clientY:r};v.onDrop.call(this,y),s?this._emitEvent(Jt,y):l?this._emitEvent(ee,y):c&&this._emitEvent(Ut,y);var p=n.move,b=n.resize,x=n.rotate,m=s&&b||l&&x||c&&p;a.notify(Ht,this,{clientX:e,clientY:r,actionName:d,triggerEvent:m}),g(u),rt(document.body).css({cursor:"auto"}),B(h)&&nt(h,"".concat(ft,"hidden"))}}},{key:"_compute",value:function(e,t){var r=this.storage.handles,n=rt(e.target),a=this._checkHandles(n,r),o=a.revX,i=a.revY,s=a.doW,c=a.doH,l=y(a,["revX","revY","doW","doH"]),u=this._getState({revX:o,revY:i,doW:s,doH:c}),h=this._cursorPoint(e),f=h.x,v=h.y,d=Math.atan2(v-u.center.y,f-u.center.x);return tt({},u,{},l,{handle:Object.values(r).some(function(t){return rt(e.target).is(t)})?n:rt(t),pressang:d})}},{key:"_checkHandles",value:function(e,r){function t(t){return t.some(function(t){return function(t){return!!B(t)&&e.is(t)}(r[t])})}return{revX:t([ve,me,pe,de,Me]),revY:t([ve,ye,de,me,_e]),onTopEdge:t([de,ye,ve,_e]),onLeftEdge:t([ve,me,pe,Me]),onRightEdge:t([ye,ge,be,Te]),onBottomEdge:t([be,xe,pe,Ee]),doW:t([me,ge,Me,Te]),doH:t([de,xe,Ee,_e])}}},{key:"_destroy",value:function(){var e=this,t=this.el,r=this.storage,n=r.controls,a=r.wrapper;[t,n].map(function(t){return rt(t).off(ae,e._onMouseDown).off(oe,e._onTouchStart)}),a.parentNode.removeChild(a)}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=y(t,["radians"]),n=this.options.snap.angle;this._rotate(tt({radians:Z(e,n)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:r}),a&&(this._apply(n),this._emitEvent("".concat(n,"End"),{clientX:e,clientY:r}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent,o=y(t,["clientX","clientY","actionName","triggerEvent"]);if(a){var i=this._getState(o);this.storage=tt({},this.storage,{},i),this._emitEvent("".concat(n,"Start"),{clientX:e,clientY:r})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,a=this.observable;(r||e||n)&&a.subscribe(zt,this).subscribe(Ht,this),r&&a.subscribe(Bt,this),e&&a.subscribe(Gt,this),n&&a.subscribe(Ft,this)}},{key:"unsubscribe",value:function(){var e=this,r=this.observable;It.map(function(t){return r.unsubscribe(t,e)})}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;F(t)||(t.onExecution&&rt(document).off(le,this._onMouseMove).off(ue,this._onMouseUp).off(he,this._onTouchMove).off(fe,this._onTouchEnd),G(r,"".concat(ft,"drag")),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,r=t.dy;this.options.draggable&&(this.storage=tt({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:r}),this._apply(Zt))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,n=t.revX,a=void 0!==n&&n,o=t.revY,i=void 0!==o&&o,s=t.doW,c=void 0!==s&&s,l=t.doH,u=void 0!==l&&l;this.options.resizable&&(this.storage=tt({},this.storage,{},this._getState({revX:a,revY:i,doW:c,doH:u})),this._resize({dx:e,dy:r}),this._apply($t))}},{key:"exeRotate",value:function(t){var e=t.delta;this.options.rotatable&&(this.storage=tt({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:e}),this._apply(te))}}]),o}(),we=function(t){var e=E(t,"transform")||"none",r=$();if("none"===e)return r;var n=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==n.length)return[[+n[0],+n[2],0,+n[4]],[+n[1],+n[3],0,+n[5]],[0,0,1,0],[0,0,0,1]];for(var a=0;a<4;++a)for(var o=0;o<4;++o)r[o][a]=+n[4*a+o];return r},Oe=function(t,e){for(var r=E(t,"transform-origin"),n=r?r.split(" "):[],a=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1],o=0;o<n.length;++o)a[o]+=parseFloat(n[o]);return a},Se=pt,Ae=mt,Re=function(){s(e,ke);var t=u(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(r){var e=this,t=this.options,n=t.rotationPoint,a=t.container,o=t.controlsContainer,i=t.resizable,s=t.rotatable,c=t.showNormal,l=t.rotatorOffset,u=t.rotatorAnchor,h=r.offsetHeight,f=r.offsetWidth,v=Ce(["sjx-wrapper"]),d=Ce(["sjx-controls"]),y={},p=ct(r,a),b=ie(ut(r,a),2),x=b[0],m=b[1],g=["data-sjx-cx","data-sjx-cy"].map(function(t){var e=r.getAttribute(t);return B(e)?Number(e):void 0}),_=g.every(function(t){return!isNaN(t)}),E={tl:[0,0,0,1],bl:[0,h,0,1],br:[f,h,0,1],tr:[f,0,0,1],tc:[f/2,0,0,1],ml:[0,h/2,0,1],bc:[f/2,h,0,1],mr:[f,h/2,0,1],center:[f/2,h/2,0,1]},M=Object.entries(E).reduce(function(t,e){var r=ie(e,2),n=r[0],a=r[1];return[].concat(W(t),[[n,ot(p,a)]])},[]).reduce(function(t,e){var r=ie(e,2),n=r[0],a=ie(r[1],4),o=a[0],i=a[1],s=a[2],c=a[3];return t[n]=[o+x,i+m,s,c],t},{}),T={},k=null;if(s){var w={},O=1;switch(u){case"n":w.x=M.tc[0],w.y=M.tc[1];break;case"s":w.x=M.bc[0],w.y=M.bc[1],O=-1;break;case"w":w.x=M.ml[0],w.y=M.ml[1],O=-1;break;case"e":default:w.x=M.mr[0],w.y=M.mr[1]}var S="n"===u||"s"===u?Math.atan2(M.bl[1]-M.tl[1],M.bl[0]-M.tl[0]):Math.atan2(M.tl[1]-M.tr[1],M.tl[0]-M.tr[0]);k=[w.x-l*O*Math.cos(S),w.y-l*O*Math.sin(S)];var A=c?je([[w.x,w.y],k]):null;c&&d.appendChild(A);var R=null;n&&(R=je([M.center,M.center]),nt(R,"sjx-hidden"),d.appendChild(R)),T=tt({},T,{normal:A,radius:R})}function N(n,a){return Object.keys(n).map(function(t){var e=n[t];if(!F(e)){var r=a(e,t);y[t]=r,d.appendChild(r)}})}var j={te:[M.tl,M.tr],be:[M.bl,M.br],le:[M.tl,M.bl],re:[M.tr,M.br]},D=i?{tl:M.tl,tr:M.tr,br:M.br,bl:M.bl,tc:M.tc,bc:M.bc,ml:M.ml,mr:M.mr}:{},V=_?[].concat(W(g),[0,1]):M.center,P=tt({},D,{center:n&&s?V:void 0,rotator:k});N(j,je),N(P,Ne),v.appendChild(d),o.appendChild(v),this.storage={wrapper:v,controls:d,handles:tt({},y,{},T),parent:r.parentNode,center:{isShifted:_},cached:{}},[r,d].map(function(t){return rt(t).on(Se,e._onMouseDown).on(Ae,e._onTouchStart)})}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm,a=st(n);return this._applyMatrixToPoint(at(a,!1),e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.wrapperMatrix,a=st(n);return this._applyMatrixToPoint(at(a,!1),e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=ie(ot(t,[e,r,0,1]),2);return{x:n[0],y:n[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container,a=ct(n);return this._applyMatrixToPoint(st(a),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,n=r.restrict,a=r.container,o=null,i=null,s=Pe(n,a,e),c=this.getBoundingRect(t),l=ie(_(s,0),2),u=l[0],h=l[1],f=ie(_(s,1),2),v=f[0],d=f[1],y=0,p=c.length;y<p;y++){var b=ie(c[y],2),x=b[0],m=b[1];(x<u||h<x)&&(o=x),(m<v||d<m)&&(i=m)}return{x:o,y:i}}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.cached,n=e.controls,a=e.transform.matrix,o=e.center,i=this.options.applyTranslate,s=rt(n);if(!F(r)){if(t.setAttribute("data-sjx-cx",o.elX),t.setAttribute("data-sjx-cy",o.elY),i){var c=rt(t),l=r.dx,u=r.dy,h=U(a),f=parseFloat(t.style.left||c.css("left")),v=parseFloat(t.style.top||c.css("top"));h.left="".concat(f+l,"px"),h.top="".concat(v+u,"px"),c.css(h),s.css(h)}this.storage.cached={}}}},{key:"_processResize",value:function(t,e){function r(t,e){var r=E||!E&&!M?(x+t)/x:(m+e)/m,n=k?x*r:x+t,a=k?m*r:m+e;return[n/x,a/m,n,a]}function n(t,e){var r=function(r,n,t,e){var a=2<arguments.length&&void 0!==t?t:1,o=3<arguments.length&&void 0!==e?e:1;return $().map(function(t,e){return t[e]=[r,n,a,o][e],t})}(t,e);return it(it(u,r),st(u))}function a(t,e){var r=t[0][3],n=t[1][3],a=J(r,n),o=J(r*(g?-1:1),n*(_?-1:1));return it(it(o,e),st(a))}var o=this.el,i=this.storage,s=this.storage,c=s.transform,l=c.matrix,u=c.auxiliary.scale.translateMatrix,h=s.cached,f=(h=void 0===h?{}:h).dist,v=(f=void 0===f?{}:f).dx,d=void 0===v?t:v,y=f.dy,p=void 0===y?e:y,b=s.box,x=b.width,m=b.height,g=s.revX,_=s.revY,E=s.doW,M=s.doH,T=this.options,k=T.proportions,w=T.scalable,O=T.restrict,S=ie(r(t,e),4),A=S[0],R=S[1],N=S[2],j=S[3],D=n(A,R),V=w?it(D,l):a(D,l);this.storage.cached.box={width:N,height:j};var P=O?this._restrictHandler(V):{x:null,y:null},C=P.x,Y=P.y,X=(null!==C||null!==Y)&&O,L=X?d:t,I=X?p:e,z=ie(r(L,I),4),H=z[0],B=z[1],G=z[2],F=z[3];if(!(Math.abs(G)<=ht||Math.abs(F)<=ht)){var W=n(H,B),q=w?it(W,l):a(W,l);return rt(o).css(tt({},U(Q(q)),{},!w&&{width:"".concat(G,"px"),height:"".concat(F,"px")})),Ve(i,this.options,{el:o,boxMatrix:q}),i.cached.dist={dx:L,dy:I},{transform:q,width:G,height:F}}}},{key:"_processMove",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.wrapper,i=a.transform,s=i.matrix,c=i.wrapperMatrix,l=i.auxiliary.translate.parentMatrix,u=a.center,h=a.cached,f=(h=void 0===h?{}:h).dist,v=(f=void 0===f?{}:f).dx,d=void 0===v?t:v,y=f.dy,p=void 0===y?e:y,b=this.options.restrict,x=ie(ot(l,[t,e,0,1]),2),m=x[0],g=x[1],_=it(s,J(m,g)),E=b?this._restrictHandler(_):{x:null,y:null},M=null!==E.x&&b?d:t,T=null!==E.y&&b?p:e,k=ie(ot(l,[M,T,0,1]),2),w=k[0],O=k[1],S=it(s,J(w,O)),A=it(c,J(M,T)),R=U(Q(S)),N=U(Q(A));return rt(r).css(R),rt(o).css(N),n.cached.dist={dx:M,dy:T},u.isShifted,S}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage.transform,n=r.matrix,a=r.auxiliary.rotate.translateMatrix,o=this.options.restrict,i=ce(Math.cos(t),4),s=function(t,e){var r=$();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r}(ce(Math.sin(t),4),i),c=it(it(st(a),s),a),l=it(n,c),u=o?this._restrictHandler(l):{x:null,y:null},h=u.x,f=u.y;return B(h)||B(f)||(rt(e).css(U(Q(l))),Ve(this.storage,this.options,{el:e,boxMatrix:l})),l}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,i=this.storage,s=i.handles.center,c=i.parent,l=i.wrapper,u=i.center,h=this.options,f=h.container,v=h.restrict,d=h.scalable,y=v||f,p=y.offsetWidth,b=y.offsetHeight,x=ie(ut(o,f),2),m=x[0],g=x[1],_=o.offsetLeft,E=o.offsetTop,M=o.offsetWidth,T=o.offsetHeight,k=we(o),w=ct(o,f),O=ct(c,f),S=ct(l,f),A=v?ct(v,v.parentNode):ct(f,f.parentNode),R=M/2,N=T/2,j=a?0:e?-R:R,D=n?0:r?-N:N,V=ie(ot(w,[R,N,0,1]),2),P=V[0]+m,C=V[1]+g,Y=s?we(s):$(),X=(s?lt(ct(s)):{translate:{x:P,y:C}}).translate,L=X.x,I=X.y,z=ie(ot(it(st(at(w)),at(Y)),[L-P,I-C,0,1]),2),H=z[0],B=z[1],G=ie(ot(k,[H,B,0,1]),2),F=G[0],W=G[1],q=ot(at(A),[p,b,0,1]),Z=lt(ct(o,o.parentNode)).scale,U=Z.sX,Q=Z.sY;return{transform:{auxiliary:{scale:{translateMatrix:d?J(j,D):J(a?0:R,n?0:N)},translate:{parentMatrix:st(at(O))},rotate:{translateMatrix:J(F,W)}},scaleX:j,scaleY:D,matrix:k,ctm:w,parentMatrix:O,containerMatrix:A,wrapperMatrix:S,scX:U,scY:Q,containerBox:q},box:{width:M,height:T,left:_,top:E,offset:{left:m,top:g}},center:tt({},u,{x:P,y:C,elX:F,elY:W,matrix:Y}),revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,a=r.center.matrix,o=it(a,J(t,e));rt(n).css(tt({},U(Q(o)))),this.storage.center.isShifted=!0}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.el,r=e.offsetHeight,n=e.offsetWidth,a=this.storage,o=a.wrapper,i=a.handles.center,s=this.options.container;if(i){var c=ie(ut(t,s),2),l=c[0],u=c[1],h=it(ct(t,s),st(ct(o,o.parentNode))),f=ie(ot(h,[n/2,r/2,0,1]),2),v=f[0],d=f[1];rt(i).css({transform:"translate(".concat(v+l,"px, ").concat(d+u,"px)")})}}},{key:"fitControlsToSize",value:function(){var t=this.el;this.storage.wrapper.removeAttribute("transform"),Ve(this.storage,this.options,{el:t})}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,r=this.el,n=this.options,a=n.scalable,o=n.restrict,i=this.storage,s=i.box,c=i.box,l=c.width,u=c.height,h=i.cached,f=(h=void 0===h?{}:h).box,v=(f=void 0===f?{}:f).width,d=void 0===v?l:v,y=f.height,p=a?s:tt({},s,{width:d,height:void 0===y?u:y});return Pe(r,o,ct(r,o,e),p)}},{key:"controls",get:function(){return this.storage.wrapper}}]),e}(),Ne=function(t,e,r){var n=ie(t,2),a=n[0],o=n[1],i=2<arguments.length&&void 0!==r?r:{},s=Ce(["sjx-hdl","sjx-hdl-".concat(1<arguments.length&&void 0!==e?e:"handler")]);return rt(s).css(tt({transform:"translate(".concat(a,"px, ").concat(o,"px)")},i)),s},je=function(t,e){var r=ie(t,3),n=r[0],a=r[1],o=r[2],i=void 0===o?1:o,s=De(n,a,i),c=s.cx,l=s.cy,u=s.length,h=s.theta,f=Ce(["sjx-hdl-line","sjx-hdl-".concat(e)]);return rt(f).css({transform:"translate(".concat(c,"px, ").concat(l,"px) rotate(").concat(h,"deg)"),height:"".concat(i,"px"),width:"".concat(u,"px")}),f},De=function(t,e,r){var n=2<arguments.length&&void 0!==r?r:1,a=ie(t,2),o=a[0],i=a[1],s=ie(e,2),c=s[0],l=s[1],u=Math.sqrt((c-o)*(c-o)+(l-i)*(l-i));return{cx:(o+c)/2-u/2,cy:(i+l)/2-n/2,thickness:n,theta:Math.atan2(i-l,o-c)*(180/Math.PI),length:u}},Ve=function(t,e,r){var n=t.wrapper,l=t.handles,a=t.transform,o=(a=void 0===a?{}:a).wrapperMatrix,i=void 0===o?ct(n,n.parentNode):o,s=t.center,c=e.rotationPoint,u=e.rotatable,h=e.resizable,f=e.showNormal,v=e.rotatorOffset,d=e.rotatorAnchor,y=e.container,p=r.el,b=r.el,x=b.offsetHeight,m=b.offsetWidth,g=ie(ut(p,y),2),_=g[0],E=g[1],M=it(ct(p,y),st(i)),T=tt({tl:[0,0,0,1],tr:[m,0,0,1],bl:[0,x,0,1],br:[m,x,0,1],tc:[m/2,0,0,1],ml:[0,x/2,0,1],bc:[m/2,x,0,1],mr:[m,x/2,0,1]},c&&u&&!s.isShifted&&{center:[m/2,x/2,0,1]}),k=Object.entries(T).reduce(function(t,e){var r=ie(e,2),n=r[0],a=r[1];return[].concat(W(t),[[n,ot(M,a)]])},[]).reduce(function(t,e){var r=ie(e,2),n=r[0],a=ie(r[1],4),o=a[0],i=a[1],s=a[2],c=a[3];return t[n]=[o+_,i+E,s,c],t},{}),w=null,O={};if(u){var S,A={},R=1;switch(d){case"n":A.x=k.tc[0],A.y=k.tc[1];break;case"s":A.x=k.bc[0],A.y=k.bc[1],R=-1;break;case"w":A.x=k.ml[0],A.y=k.ml[1],R=-1;break;case"e":default:A.x=k.mr[0],A.y=k.mr[1]}var N="n"===d||"s"===d?Math.atan2(k.bl[1]-k.tl[1],k.bl[0]-k.tl[0]):Math.atan2(k.tl[1]-k.tr[1],k.tl[0]-k.tr[0]),j=v*R;S=[A.x-j*Math.cos(N),A.y-j*Math.sin(N)],w=f?[[A.x,A.y],S]:null,O={rotator:S}}var D=tt({},k),V=tt({te:[k.tl,k.tr],be:[k.bl,k.br],le:[k.tl,k.bl],re:[k.tr,k.br]},f&&w&&{normal:w});Object.keys(V).forEach(function(t){var e=ie(V[t],2),r=e[0],n=e[1],a=De(r,n),o=a.cx,i=a.cy,s=a.length,c=a.theta;rt(l[t]).css({transform:"translate(".concat(o,"px, ").concat(i,"px) rotate(").concat(c,"deg)"),width:"".concat(s,"px")})});var P=tt({},h&&D,{},O);Object.keys(P).forEach(function(t){var e=P[t];if(e){var r=ie(e,2),n=r[0],a=r[1];rt(l[t]).css({transform:"translate(".concat(n,"px, ").concat(a,"px)")})}})},Pe=function(t,e,r,n){var a=ie(ut(t,e),2),o=a[0],i=a[1],s=n||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},c=s.width,l=s.height,u=s.offset,h=u.left,f=u.top;return[[0,0,0,1],[c,0,0,1],[0,l,0,1],[c,l,0,1]].reduce(function(t,e){return[].concat(W(t),[ot(r,e)])},[]).map(function(t){var e=ie(t,4),r=e[0],n=e[1],a=e[2],o=e[3];return[r+h,n+f,a,o]})},Ce=function(t){var e=0<arguments.length&&void 0!==t?t:[],r=document.createElement("div");return e.forEach(function(t){return nt(r,t)}),r},Ye=Ie("svg").createSVGPoint(),Xe=/[+-]?\d+(\.\d+)?/g,Le=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Ie(t,e){var r=1<arguments.length&&void 0!==e?e:[],n=document.createElementNS("http://www.w3.org/2000/svg",t);return r.forEach(function(t){return nt(n,t)}),n}function ze(t){var r=[];return Qe(t)?e.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==Le.indexOf(e)&&("g"===e&&r.push.apply(r,W(ze(t))),r.push(t))}}):r.push(t),r}function He(){return Ie("svg").createSVGMatrix()}function Be(t,e){var r=He();return r.e=t,r.f=e,r}function Ge(t,e){return(e.getScreenCTM&&e.getScreenCTM()||He()).inverse().multiply(t.getScreenCTM()||He())}function Fe(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(a,",").concat(o,",").concat(i,")")}function We(t,e,r){return Ye.x=e,Ye.y=r,Ye.matrixTransform(t)}function qe(t){var e=He();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function Ze(t){return t.match(Xe).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function Ue(t){for(var e=$e.lastIndex=0,r=[];e=$e.exec(t);){var n=ie(e,3),a=n[1],o=n[2],i=a.toUpperCase(),s=o.replace(/([^e])-/g,"$1 -").replace(/ +/g," ");r.push({relative:a!==i,key:i,cmd:a,values:s.trim().split(Je).map(function(t){if(!isNaN(t))return Number(t)})})}return r}var Qe=function(t){return"g"===t.tagName.toLowerCase()},$e=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,Je=/\s*,\s*|\s+/g,Ke=yt.E_DRAG,tr=yt.E_RESIZE,er=pt,rr=mt,nr=function(){s(e,ke);var t=u(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(r){var e=this,t=this.options,n=t.rotationPoint,a=t.container,o=t.controlsContainer,i=t.resizable,s=t.rotatable,c=t.rotatorAnchor,l=t.rotatorOffset,u=t.showNormal,h=t.custom,f=r.getBBox(),v=f.x,d=f.y,y=f.width,p=f.height,b=Ie("g",["sjx-svg-wrapper"]),x=Ie("g",["sjx-svg-controls"]),m=["data-sjx-cx","data-sjx-cy"].map(function(t){var e=r.getAttribute(t);return B(e)?Number(e):void 0}),g=m.every(function(t){return!isNaN(t)}),_={tl:[v,d],tr:[v+y,d],mr:[v+y,d+p/2],ml:[v,d+p/2],tc:[v+y/2,d],bc:[v+y/2,d+p],br:[v+y,d+p],bl:[v,d+p],center:[v+y/2,d+p/2]},E=Ge(r,a),M=Object.entries(_).reduce(function(t,e){var r=ie(e,2),n=r[0],a=ie(r[1],2),o=a[0],i=a[1];return tt({},t,C({},n,We(E,o,i)))},{}),T={},k={},w=null;if(s){var O={},S=1;switch(c){case"n":O.x=M.tc.x,O.y=M.tc.y;break;case"s":O.x=M.bc.x,O.y=M.bc.y,S=-1;break;case"w":O.x=M.ml.x,O.y=M.ml.y,S=-1;break;case"e":default:O.x=M.mr.x,O.y=M.mr.y}var A="n"===c||"s"===c?Math.atan2(M.bl.y-M.tl.y,M.bl.x-M.tl.x):Math.atan2(M.tl.y-M.tr.y,M.tl.x-M.tr.x);w={x:O.x-l*S*Math.cos(A),y:O.y-l*S*Math.sin(A)};var R=u?ur([O,w],X,"norm"):null;u&&x.appendChild(R);var N=null;n&&((N=Ie("line",["sjx-hidden"])).x1.baseVal.value=M.center.x,N.y1.baseVal.value=M.center.y,N.x2.baseVal.value=m[0]||M.center.x,N.y2.baseVal.value=m[1]||M.center.y,cr(N,"#fe3232"),N.setAttribute("opacity",.5),x.appendChild(N)),k=tt({},k,{normal:R,radius:N})}var j=i?tt({},M,{rotator:w}):{},D={te:[j.tl,j.tr],be:[j.bl,j.br],le:[j.tl,j.bl],re:[j.tr,j.br]};Object.keys(D).forEach(function(t){var e=D[t];F(e)||(T[t]=ur(e,X,t),x.appendChild(T[t]))});var V=g?We(He(),m[0],m[1]):M.center,P=tt({},j,{center:n&&s?V:void 0});Object.keys(P).forEach(function(t){var e=P[t];if(!F(e)){var r=e.x,n=e.y,a="center"===t?"#fe3232":X;B(h)&&Y(h[t])?T[t]=h[t](E,f,We):T[t]=sr(r,n,a,t),x.appendChild(T[t])}}),b.appendChild(x),o.appendChild(b),this.storage={wrapper:b,controls:x,handles:tt({},T,{},k),parent:r.parentNode,center:{isShifted:g},cached:{}},[r,x].map(function(t){return rt(t).on(er,e._onMouseDown).on(rr,e._onTouchStart)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container;return this._applyMatrixToPoint(n.getScreenCTM().inverse(),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,n=r.container,a=r.restrict,o=null,i=null,s=hr(void 0===a?n:a,e),c=this.getBoundingRect(t),l=ie(_(s,0),2),u=l[0],h=l[1],f=ie(_(s,1),2),v=f[0],d=f[1],y=0,p=c.length;y<p;y++){var b=ie(c[y],2),x=b[0],m=b[1];(x<u||h<x)&&(o=x),(m<v||d<m)&&(i=m)}return{x:o,y:i}}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.wrapperMatrix.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=Ie("svg").createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var n=this.el,a=this.storage,e=this.storage,o=e.bBox,i=e.cached,r=e.transform,s=e.center,c=this.options,l=this.options,u=l.container,h=l.scalable,f=l.applyTranslate,v=r.matrix,d=r.parentMatrix,y=r.ctm;if(n.setAttribute("data-sjx-cx",s.elX),n.setAttribute("data-sjx-cy",s.elY),!F(i)){var p=i.scaleX,b=i.scaleY,x=i.dx,m=i.dy,g=i.ox,_=i.oy,E=i.transformMatrix;if(t===Ke){if(!f||0===x&&0===m)return;var M=Be(x,m),T=M.multiply(v).multiply(M.inverse());if(n.setAttribute("transform",Fe(T)),Qe(n))ze(n).forEach(function(t){var e=Be(x,m),r=e.multiply(Ge(t,t.parentNode)).multiply(e.inverse());if(function(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===n&&1===a&&0===o&&0===i}(r)||t.setAttribute("transform",Fe(r)),!Qe(t)){var n=d.inverse();n.e=n.f=0,ar(t,tt({},We(n,g,_)))}});else ar(n,{x:x,y:m})}if(t===tr){if(!E)return;if(!h)if(Qe(n)){ze(n).forEach(function(t){if(!Qe(t)){var e=Ge(t,n),r=e.inverse().multiply(E).multiply(e);or(t,{scaleX:p,scaleY:b,localCTM:r,bBox:o,container:u,storage:a,cached:i})}})}else{var k=u.getScreenCTM()||He(),w=n.getScreenCTM().multiply(E),O=k.inverse().multiply(w),S=y.inverse().multiply(O);or(n,{scaleX:p,scaleY:b,localCTM:S,bBox:o,container:u,storage:a,cached:i})}ir(a,c,{boxMatrix:h?y.multiply(E):y,element:n})}}}},{key:"_processResize",value:function(t,e){function r(t,e){var r=f||!f&&!v?(c+t)/c:(l+e)/l,n=T?c*r:c+t,a=T?l*r:l+e;return[n/c,a/l,n,a]}function n(t,e){var r=function(t,e){var r=He();return r.a=t,r.d=e,r}(t,e);return p.multiply(r).multiply(p.inverse())}var a=this.el,o=this.storage,i=this.storage,s=i.bBox,c=s.width,l=s.height,u=i.revX,h=i.revY,f=i.doW,v=i.doH,d=i.transform,y=d.matrix,p=d.auxiliary.scale.translateMatrix,b=i.cached,x=(b=void 0===b?{}:b).dist,m=(x=void 0===x?{}:x).dx,g=void 0===m?t:m,_=x.dy,E=void 0===_?e:_,M=this.options,T=M.proportions,k=M.scalable,w=M.restrict,O=a.getBBox(),S=O.x,A=O.y,R=y.multiply(n.apply(void 0,W(r(t,e)))),N=w?this._restrictHandler(R):{x:null,y:null},j=N.x,D=N.y,V=(null!==j||null!==D)&&w,P=V?g:t,C=V?E:e,Y=ie(r(P,C),4),X=Y[0],L=Y[1],I=Y[2],z=Y[3];if(!(Math.abs(I)<=ht||Math.abs(z)<=ht)){var H=n(X,L),B=y.multiply(H),G=S-(I-c)*(v?.5:u?1:0),F=A-(z-l)*(f?.5:h?1:0);return k&&a.setAttribute("transform",Fe(B)),o.cached=tt({},o.cached,{scaleX:X,scaleY:L,transformMatrix:H,resultMatrix:B,dist:{dx:P,dy:C}}),this._apply(tr),{x:G,y:F,width:I,height:z,transform:B}}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=this.storage,a=n.wrapper,o=n.center,i=n.transform,s=i.matrix,c=i.auxiliary.translate,l=c.translateMatrix,u=c.wrapperTranslateMatrix,h=i.wrapperMatrix,f=i.parentMatrix,v=n.cached,d=(v=void 0===v?{}:v).dist,y=(d=void 0===d?{}:d).dx,p=void 0===y?t:y,b=d.dy,x=void 0===b?e:b,m=this.options.restrict;f.e=f.f=0;var g=We(f.inverse(),t,e),_=g.x,E=g.y,M=Be(_,E).multiply(s),T=m?this._restrictHandler(M):{x:null,y:null},k=T.x,w=T.y;r.cached.dist={dx:null!==k&&m?p:t,dy:null!==w&&m?x:e};var O=We(f.inverse(),p,x),S=O.x,A=O.y;l.e=S,l.f=A;var R=l.multiply(s);u.e=p,u.f=x;var N=u.multiply(h);if(a.setAttribute("transform",Fe(N)),this.el.setAttribute("transform",Fe(R)),o.isShifted){var j=h.inverse();j.e=j.f=0;var D=We(j,p,x),V=D.x,P=D.y;this._moveCenterHandle(-V,-P)}return R}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.wrapper,n=e.transform,a=n.matrix,o=n.wrapperMatrix,i=n.parentMatrix,s=n.auxiliary.rotate,c=s.translateMatrix,l=s.wrapperTranslateMatrix,u=this.options.restrict,h=ce(Math.cos(t)),f=function(t,e){var r=He();return r.a=e,r.b=t,r.c=-t,r.d=e,r}(ce(Math.sin(t)),h);i.e=i.f=0;var v=i.inverse().multiply(f).multiply(i),d=c.multiply(v).multiply(c.inverse()).multiply(a),y=u?this._restrictHandler(d):{x:null,y:null},p=y.x,b=y.y;if(B(p)||B(b))return d;var x=l.multiply(f).multiply(l.inverse()).multiply(o);return r.setAttribute("transform",Fe(x)),this.el.setAttribute("transform",Fe(d)),d}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,i=this.storage,s=i.wrapper,c=i.parent,l=i.handles.center,u=this.options,h=u.container,f=u.restrict,v=u.rotationPoint,d=o.getBBox(),y=d.x,p=d.y,b=d.width,x=d.height,m=Ge(o,c),g=Ge(o,h),_=Ge(s,h),E=Ge(c,h),M=Ge(s,s.parentNode),T=E.inverse(),k=y+b*(a?.5:e?1:0),w=p+x*(n?.5:r?1:0),O=y+b/2,S=p+x/2,A=v?l.cx.baseVal.value:O,R=v?l.cy.baseVal.value:S,N=We(_,A,R),j=N.x,D=N.y,V=v?We(T,j,D):We(m,O,S),P=V.x,C=V.y,Y=We(g,O,S),X=Y.x,L=Y.y;lr(this.el),ze(o).forEach(function(t){t.__ctm__=Ge(t,t.parentNode),lr(t)});var I=tt({},this.storage.center||{},{x:v?j:X,y:v?D:L,elX:P,elY:C,hx:v?l.cx.baseVal.value:null,hy:v?l.cy.baseVal.value:null}),z=f?Ge(f,f.parentNode):Ge(h,h.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:He(),translateMatrix:Be(k,w)},translate:{parentMatrix:T,translateMatrix:He(),wrapperTranslateMatrix:He()},rotate:{translateMatrix:Be(I.elX,I.elY),wrapperTranslateMatrix:Be(I.x,I.y)}},matrix:m,ctm:g,parentMatrix:E,wrapperMatrix:M,containerMatrix:z,scX:Math.sqrt(g.a*g.a+g.b*g.b),scY:Math.sqrt(g.c*g.c+g.d*g.d)},bBox:d,center:I,revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,a=n.center,o=n.radius,i=r.center,s=i.hx,c=i.hy;if(!F(a)){var l=s+t,u=c+e;a.cx.baseVal.value=l,a.cy.baseVal.value=u,o.x2.baseVal.value=l,o.y2.baseVal.value=u,this.storage.center.isShifted=!0}}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.storage,r=e.bBox,n=r.width,a=r.height,o=r.x,i=r.y,s=e.handles,c=s.center,l=s.radius;if(c){var u=Ge(t,t.parentNode),h=We(u,o+n/2,i+a/2),f=h.x,v=h.y;c.cx.baseVal.value=f,c.cy.baseVal.value=v,c.isShifted=!1,l.x2.baseVal.value=f,l.y2.baseVal.value=v}}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.storage.wrapper,r=this.options.container,n=t.getBBox(),a=n.width,o=n.height,i=n.x,s=n.y,c=Ge(t,r),l=He();this.storage.transform.wrapperMatrix=l,e.setAttribute("transform",Fe(l)),ir(this.storage,this.options,{x:i,y:s,width:a,height:o,boxMatrix:c,element:t})}},{key:"getBoundingRect",value:function(t){var e=this.el,r=this.options.restrict,n=this.storage.bBox;return hr(e,Ge(e.parentNode,r).multiply(t),n)}},{key:"controls",get:function(){return this.storage.wrapper}}]),e}(),ar=function(e,t){var r=t.x,n=t.y,a=[];switch(e.tagName.toLowerCase()){case"text":var o=B(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,i=B(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=B(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=B(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",s],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;a.push(["cx",l],["cy",u]);break;case"line":var h=e.x1.baseVal.value+r,f=e.y1.baseVal.value+n,v=e.x2.baseVal.value+r,d=e.y2.baseVal.value+n;a.push(["x1",h],["y1",f],["x2",v],["y2",d]);break;case"polygon":case"polyline":var y=Ze(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");a.push(["points",y]);break;case"path":var p=e.getAttribute("d");a.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var a=Ue(e),o="",i=" ",s=!0,c=0,l=a.length;c<l;c++){var u=a[c],h=u.values,f=u.key,v=u.relative,d=[];switch(f){case"M":for(var y=0,p=h.length;y<p;y+=2){var b=ie(h.slice(y,y+2),2),x=b[0],m=b[1];v&&!s||(x+=r,m+=n),d.push(x,m),s=!1}break;case"A":for(var g=0,_=h.length;g<_;g+=7){var E=h.slice(g,g+7);v||(E[5]+=r,E[6]+=n),d.push.apply(d,W(E))}break;case"C":for(var M=0,T=h.length;M<T;M+=6){var k=h.slice(M,M+6);v||(k[0]+=r,k[1]+=n,k[2]+=r,k[3]+=n,k[4]+=r,k[5]+=n),d.push.apply(d,W(k))}break;case"H":for(var w=0,O=h.length;w<O;w+=1){var S=h.slice(w,w+1);v||(S[0]+=r),d.push(S[0])}break;case"V":for(var A=0,R=h.length;A<R;A+=1){var N=h.slice(A,A+1);v||(N[0]+=n),d.push(N[0])}break;case"L":case"T":for(var j=0,D=h.length;j<D;j+=2){var V=ie(h.slice(j,j+2),2),P=V[0],C=V[1];v||(P+=r,C+=n),d.push(P,C)}break;case"Q":case"S":for(var Y=0,X=h.length;Y<X;Y+=4){var L=ie(h.slice(Y,Y+4),4),I=L[0],z=L[1],H=L[2],B=L[3];v||(I+=r,z+=n,H+=r,B+=n),d.push(I,z,H,B)}break;case"Z":i=h[0]=""}o+=u.cmd+d.join(",")+i}return o}catch(t){se("Path parsing error: "+t)}}({path:p,dx:r,dy:n})])}a.forEach(function(t){e.setAttribute(t[0],t[1])})},or=function(a,t){var e=t.scaleX,r=t.scaleY,o=t.localCTM,n=t.bBox,i=n.width,s=n.height,c=[];switch(a.tagName.toLowerCase()){case"text":case"tspan":var l=a.__data__,u=l.x,h=l.y,f=l.textLength,v=We(o,u,h),d=v.x,y=v.y;c.push(["x",d+(e<0?i:0)],["y",y-(r<0?s:0)],["textLength",Math.abs(e*f)]);break;case"circle":var p=a.__data__,b=p.r,x=p.cx,m=p.cy,g=b*(Math.abs(e)+Math.abs(r))/2,_=We(o,x,m),E=_.x,M=_.y;c.push(["r",g],["cx",E],["cy",M]);break;case"foreignobject":case"image":case"rect":var T=a.__data__,k=T.width,w=T.height,O=T.x,S=T.y,A=We(o,O,S),R=A.x,N=A.y,j=Math.abs(k*e),D=Math.abs(w*r);c.push(["x",R-(e<0?j:0)],["y",N-(r<0?D:0)],["width",j],["height",D]);break;case"ellipse":var V=a.__data__,P=V.rx,C=V.ry,Y=V.cx,X=V.cy,L=We(o,Y,X),I=L.x,z=L.y,H=He();H.a=e,H.d=r;var B=We(H,P,C),G=B.x,F=B.y;c.push(["rx",Math.abs(G)],["ry",Math.abs(F)],["cx",I],["cy",z]);break;case"line":var W=a.__data__,q=W.resX1,Z=W.resY1,U=W.resX2,Q=W.resY2,$=We(o,q,Z),J=$.x,K=$.y,tt=We(o,U,Q),et=tt.x,rt=tt.y;c.push(["x1",J],["y1",K],["x2",et],["y2",rt]);break;case"polygon":case"polyline":var nt=a.__data__.points,at=Ze(nt).map(function(t){var e=We(o,Number(t[0]),Number(t[1])),r=e.x,n=e.y;return t[0]=r,t[1]=n,t.join(" ")}).join(" ");c.push(["points",at]);break;case"path":var ot=a.__data__.path;c.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=Ue(e),a="",o=" ",i=[],s=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative;switch(f){case"A":for(var d=[],y=0,p=h.length;y<p;y+=7){var b=ie(h.slice(y,y+7),7),x=b[0],m=b[1],g=b[2],_=b[3],E=b[4],M=b[5],T=b[6],k=qe(r);v&&(k.e=k.f=0);var w=We(k,M,T),O=w.x,S=w.y;d.push(ce(O),ce(S)),k.e=k.f=0;var A=We(k,x,m),R=A.x,N=A.y;d.unshift(ce(R),ce(N),g,_,E)}i.push(d);break;case"C":for(var j=[],D=0,V=h.length;D<V;D+=6){var P=ie(h.slice(D,D+6),6),C=P[0],Y=P[1],X=P[2],L=P[3],I=P[4],z=P[5],H=qe(r);v&&(H.e=H.f=0);var B=We(H,C,Y),G=B.x,F=B.y,W=We(H,X,L),q=W.x,Z=W.y,U=We(H,I,z),Q=U.x,$=U.y;j.push(ce(G),ce(F),ce(q),ce(Z),ce(Q),ce($))}i.push(j);break;case"H":for(var J=[],K=0,tt=h.length;K<tt;K+=1){var et=ie(h.slice(K,K+1),1)[0],rt=qe(r);v&&(rt.e=rt.f=0);var nt=We(rt,et,0).x;J.push(ce(nt))}i.push(J);break;case"V":for(var at=[],ot=0,it=h.length;ot<it;ot+=1){var st=ie(h.slice(ot,ot+1),1)[0],ct=qe(r);v&&(ct.e=ct.f=0);var lt=We(ct,0,st).y;at.push(ce(lt))}i.push(at);break;case"T":case"L":for(var ut=[],ht=0,ft=h.length;ht<ft;ht+=2){var vt=ie(h.slice(ht,ht+2),2),dt=vt[0],yt=vt[1],pt=qe(r);v&&(pt.e=pt.f=0);var bt=We(pt,dt,yt),xt=bt.x,mt=bt.y;ut.push(ce(xt),ce(mt))}i.push(ut);break;case"M":for(var gt=[],_t=0,Et=h.length;_t<Et;_t+=2){var Mt=ie(h.slice(_t,_t+2),2),Tt=Mt[0],kt=Mt[1],wt=qe(r);v&&!s&&(wt.e=wt.f=0);var Ot=We(wt,Tt,kt),St=Ot.x,At=Ot.y;gt.push(ce(St),ce(At)),s=!1}i.push(gt);break;case"Q":for(var Rt=[],Nt=0,jt=h.length;Nt<jt;Nt+=4){var Dt=ie(h.slice(Nt,Nt+4),4),Vt=Dt[0],Pt=Dt[1],Ct=Dt[2],Yt=Dt[3],Xt=qe(r);v&&(Xt.e=Xt.f=0);var Lt=We(Xt,Vt,Pt),It=Lt.x,zt=Lt.y,Ht=We(Xt,Ct,Yt),Bt=Ht.x,Gt=Ht.y;Rt.push(ce(It),ce(zt),ce(Bt),ce(Gt))}i.push(Rt);break;case"S":for(var Ft=[],Wt=0,qt=h.length;Wt<qt;Wt+=4){var Zt=ie(h.slice(Wt,Wt+4),4),Ut=Zt[0],Qt=Zt[1],$t=Zt[2],Jt=Zt[3],Kt=qe(r);v&&(Kt.e=Kt.f=0);var te=We(Kt,Ut,Qt),ee=te.x,re=te.y,ne=We(Kt,$t,Jt),ae=ne.x,oe=ne.y;Ft.push(ce(ee),ce(re),ce(ae),ce(oe))}i.push(Ft);break;case"Z":i.push([""]),o=""}a+=u.cmd+i[c].join(",")+o}return a}catch(t){se("Path parsing error: "+t)}}({path:ot,localCTM:o})])}c.forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];a.setAttribute(r,n)})},ir=function(t,e,r){var n=e.rotatable,a=e.rotatorAnchor,o=e.rotatorOffset,i=t.wrapper,s=t.handles,c=t.center,l=t.transform,u=(l=void 0===l?{}:l).wrapperMatrix,h=void 0===u?Ge(i,i.parentNode):u,f=r.boxMatrix,v=r.element.getBBox(),d=v.x,y=v.y,p=v.width,b=v.height,x=p/2,m=b/2,g=h.inverse().multiply(f),_=We(g,d+x,y+m),E=tt({tl:[d,y],tr:[d+p,y],mr:[d+p,y+m],ml:[d,y+m],tc:[d+x,y],bc:[d+x,y+b],br:[d+p,y+b],bl:[d,y+b]},!c.isShifted&&{center:[d+x,y+m]}),M=Object.entries(E).reduce(function(t,e){var r=ie(e,2),n=r[0],a=r[1];return t[n]=We(g,a[0],a[1]),t},{}),T={te:[M.tl,M.tr],be:[M.bl,M.br],le:[M.tl,M.bl],re:[M.tr,M.br]};if(n){var k={},w=1;switch(a){case"n":k.x=M.tc.x,k.y=M.tc.y;break;case"s":k.x=M.bc.x,k.y=M.bc.y,w=-1;break;case"w":k.x=M.ml.x,k.y=M.ml.y,w=-1;break;case"e":default:k.x=M.mr.x,k.y=M.mr.y}var O="n"===a||"s"===a?Math.atan2(M.bl.y-M.tl.y,M.bl.x-M.tl.x):Math.atan2(M.tl.y-M.tr.y,M.tl.x-M.tr.x),S=o*w,A={x:k.x-S*Math.cos(O),y:k.y-S*Math.sin(O)},R=s.normal,N=s.radius;B(R)&&(R.x1.baseVal.value=k.x,R.y1.baseVal.value=k.y,R.x2.baseVal.value=A.x,R.y2.baseVal.value=A.y),B(N)&&(N.x1.baseVal.value=_.x,N.y1.baseVal.value=_.y,c.isShifted||(N.x2.baseVal.value=_.x,N.y2.baseVal.value=_.y)),M.rotator=A}Object.keys(T).forEach(function(t){var a=s[t],e=ie(T[t],2),r=e[0],n=e[1];F(r)||F(a)||Object.entries({x1:r.x,y1:r.y,x2:n.x,y2:n.y}).map(function(t){var e=ie(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)})}),Object.keys(M).forEach(function(t){var e=s[t],r=M[t];F(r)||F(e)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))})},sr=function(t,e,r,n){var a=Ie("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(n)]),o={cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"};return Object.entries(o).forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)}),a},cr=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},lr=function(t){switch(t.tagName.toLowerCase()){case"text":var e=B(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,r=B(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,n=B(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null;t.__data__={x:e,y:r,textLength:n};break;case"circle":var a=t.r.baseVal.value,o=t.cx.baseVal.value,i=t.cy.baseVal.value;t.__data__={r:a,cx:o,cy:i};break;case"foreignobject":case"image":case"rect":var s=t.width.baseVal.value,c=t.height.baseVal.value,l=t.x.baseVal.value,u=t.y.baseVal.value;t.__data__={width:s,height:c,x:l,y:u};break;case"ellipse":var h=t.rx.baseVal.value,f=t.ry.baseVal.value,v=t.cx.baseVal.value,d=t.cy.baseVal.value;t.__data__={rx:h,ry:f,cx:v,cy:d};break;case"line":var y=t.x1.baseVal.value,p=t.y1.baseVal.value,b=t.x2.baseVal.value,x=t.y2.baseVal.value;t.__data__={resX1:y,resY1:p,resX2:b,resY2:x};break;case"polygon":case"polyline":var m=t.getAttribute("points");t.__data__={points:m};break;case"path":var g=t.getAttribute("d");t.__data__={path:g}}},ur=function(t,e,r){var n=ie(t,2),a=n[0],o=n[1],i=Ie("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),s={x1:a.x,y1:a.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return Object.entries(s).forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];return i.setAttribute(r,n)}),i},hr=function(t,o,e){var r=2<arguments.length&&void 0!==e?e:t.getBBox(),n=r.x,a=r.y,i=r.width,s=r.height;return[[n,a],[n+i,a],[n+i,a+s],[n,a+s]].map(function(t){var e=ie(t,2),r=e[0],n=e[1],a=We(o,r,n);return[a.x,a.y]})};function fr(r,t){if(this.length){var n=B(t)&&t instanceof At?t:new At;return p.call(this,function(t,e){return e instanceof SVGElement?function(t){var e=t.tagName.toLowerCase();return-1!==Le.indexOf(e)||(se('Selected element "'.concat(e,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)}(e)&&t.push(new nr(e,r,n)):t.push(new Re(e,r,n)),t},[])}}var vr=yt.EMITTER_EVENTS,dr=pt,yr=mt,pr=function(){s(a,Yt);var n=u(a);function a(t,e){var r;return i(this,a),(r=n.call(this,t)).enable(e),r}return r(a,[{key:"_init",value:function(){var e=this,t=this.el,r=this.options,n=rt(t),a=r.style,o=r.appendTo,i=tt({position:"absolute","z-index":"2147483647"},a);this.storage={css:i,parent:B(o)?rt(o)[0]:document.body},n.on(dr,this._onMouseDown).on(yr,this._onTouchStart),vr.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e={},r=null,n=document,a=function(){},o=function(){},i=function(){},s=function(){};if(B(t)){var c=t.style,l=t.appendTo,u=t.stack,h=t.onInit,f=t.onMove,v=t.onDrop,d=t.onDestroy;e=B(c)&&"object"===K(c)?c:e,r=l||null;var y=B(u)?rt(u)[0]:document;a=et(h),o=et(f),i=Y(v)?function(t){var e=this.storage.clone;!function(t,e){var r=m(t),n=r.top,a=r.left,o=m(e),i=o.top,s=o.left,c=rt(t),l=rt(e);return!(n<i||n+parseFloat(c.css("height"))>i+parseFloat(l.css("height"))||a<s||a+parseFloat(c.css("width"))>s+parseFloat(l.css("width")))}(e,y)||v.call(this,t,this.el,e)}:function(){},s=et(d)}this.options={style:e,appendTo:r,stack:n},this.proxyMethods={onInit:a,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,a=this.el,o=n.parent,i=n.css,s=m(o),c=s.left,l=s.top;i.left="".concat(e-c,"px"),i.top="".concat(r-l,"px");var u=a.cloneNode(!0);rt(u).css(i),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=u,rt(o)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage;n.clientX=e,n.clientY=r,n.doDraw=!0,n.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,g(n),F(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=q(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,a=t.cx,o=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-a,dy:n-o}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,n="translate(".concat(t,"px, ").concat(e,"px)");rt(r).css({transform:n,webkitTranform:n,mozTransform:n,msTransform:n,otransform:n})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;F(t)||(rt(r).off(dr,this._onMouseDown).off(yr,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),a}();function br(e){if(this.length)return d.call(this,function(t){return new pr(t,e)})}var xr=function(){s(e,b);var t=u(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"drag",value:function(){return fr.call.apply(fr,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return br.call.apply(br,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function mr(t){return new xr(t)}return Object.defineProperty(mr,"createObservable",{value:function(){return new At}}),Object.defineProperty(mr,"Subjx",{value:xr}),Object.defineProperty(mr,"Observable",{value:At}),mr});
