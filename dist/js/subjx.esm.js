/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
const t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},{forEach:s,slice:r,map:o,reduce:n}=Array.prototype,{warn:a}=console,i=t=>null!=t,c=t=>null==t,l=t=>"function"==typeof t,h=t=>l(t)?function(){t.call(this,...arguments)}:()=>{};class u{constructor(t){if("string"==typeof t){const e=document.querySelectorAll(t);this.length=e.length;for(let t=0;t<this.length;t++)this[t]=e[t]}else if("object"!=typeof t||1!==t.nodeType&&t!==document)if(t instanceof u){this.length=t.length;for(let e=0;e<this.length;e++)this[e]=t[e]}else{if(!i(e=t)||"object"!=typeof e||!(Array.isArray(e)||i(window.Symbol)&&"function"==typeof e[window.Symbol.iterator]||i(e.forEach)||"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e)))throw new Error("Passed parameter must be selector/element/elementArray");this.length=0;for(let e=0;e<this.length;e++)1===t.nodeType&&(this[e]=t[e],this.length++)}else this[0]=t,this.length=1;var e}css(t){const e={setStyle(t){return((t,e)=>{let s=t.length;for(;s--;)for(const r in e)t[s].style[r]=e[r];return t.style})(this,t)},getStyle(){return(e=>{let s=e.length;for(;s--;)return e[s].currentStyle?e[s].currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e[s],"")[t]:e[s].style[t]})(this)}};return"string"==typeof t?e.getStyle.apply(this,r.call(arguments,1)):"object"!=typeof t&&t?(a(`Method ${t} does not exist`),!1):e.setStyle.apply(this,arguments)}on(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=arguments[1]:d(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}off(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=null:d(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}is(t){if(c(t))return!1;const e=p(t);let s=this.length;for(;s--;)if(this[s]===e[s])return!0;return!1}}function d(t,e,s,r,o,n){const a=function(t){let e=t.target;for(;e&&e!==this;)e.matches(s)&&r.call(e,t),e=e.parentNode};!0===n?document.addEventListener?t.addEventListener(e,a,o||{passive:!1}):document.attachEvent?t.attachEvent(`on${e}`,a):t[`on${e}`]=a:document.removeEventListener?t.removeEventListener(e,a,o||{passive:!1}):document.detachEvent?t.detachEvent(`on${e}`,a):t[`on${e}`]=null}function p(t){return new u(t)}const x=2,y="#00a8ff",f="sjx-",b=["","-webkit-","-moz-","-ms-","-o-"],m={NOTIFIER_EVENTS:["ongetstate","onapply","onmove","onresize","onrotate"],ON_GETSTATE:"ongetstate",ON_APPLY:"onapply",ON_MOVE:"onmove",ON_RESIZE:"onresize",ON_ROTATE:"onrotate"},g={EMITTER_EVENTS:["dragStart","drag",,"dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],E_DRAG_START:"dragStart",E_DRAG:"drag",E_DRAG_END:"dragEnd",E_RESIZE_START:"resizeStart",E_RESIZE:"resize",E_RESIZE_END:"resizeEnd",E_ROTATE_START:"rotateStart",E_ROTATE:"rotate",E_ROTATE_END:"rotateEnd",E_SET_POINT_START:"setPointStart",E_SET_POINT_END:"setPointEnd"},_={E_MOUSEDOWN:"mousedown",E_MOUSEUP:"mouseup",E_MOUSEMOVE:"mousemove",E_TOUCHSTART:"touchstart",E_TOUCHEND:"touchend",E_TOUCHMOVE:"touchmove"},v={TRANSFORM_HANDLES_KEYS:{TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},TRANSFORM_EDGES_KEYS:{TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"}},{ON_GETSTATE:E,ON_APPLY:M,ON_MOVE:T,ON_RESIZE:w,ON_ROTATE:O}=m;class S{constructor(){this.observers={}}subscribe(t,e){const s=this.observers;return c(s[t])&&Object.defineProperty(s,t,{value:[]}),s[t].push(e),this}unsubscribe(t,e){const s=this.observers;if(i(s[t])){const r=s[t].indexOf(e);s[t].splice(r,1)}return this}notify(t,e,s){c(this.observers[t])||this.observers[t].forEach(r=>{if(e!==r)switch(t){case T:r.notifyMove(s);break;case O:r.notifyRotate(s);break;case w:r.notifyResize(s);break;case M:r.notifyApply(s);break;case E:r.notifyGetState(s)}})}}class R{constructor(t){this.name=t,this.callbacks=[]}registerCallback(t){this.callbacks.push(t)}removeCallback(t){const e=this.callbacks(t);this.callbacks.splice(e,1)}}class N{constructor(){this.events={}}registerEvent(t){this.events[t]=new R(t)}emit(t,e,s){this.events[e].callbacks.forEach(e=>{e.call(t,s)})}addEventListener(t,e){this.events[t].registerCallback(e)}removeEventListener(t,e){this.events[t].removeCallback(e)}}const{E_DRAG:A}=g,{E_MOUSEMOVE:k,E_MOUSEUP:D,E_TOUCHMOVE:V,E_TOUCHEND:C}=_;class Y{constructor(t){this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new N,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}enable(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}disable(){P()}_init(){P()}_destroy(){P()}_processOptions(){P()}_start(){P()}_moving(){P()}_end(){P()}_animate(){P()}_drag({dx:t,dy:e,...s}){const r={dx:t,dy:e,transform:this._processMove(t,e),...s};this.proxyMethods.onMove.call(this,r),this._emitEvent(A,r)}_draw(){this._animate()}_onMouseDown(t){this._start(t),p(document).on(k,this._onMouseMove).on(D,this._onMouseUp)}_onTouchStart(t){this._start(t.touches[0]),p(document).on(V,this._onTouchMove).on(C,this._onTouchEnd)}_onMouseMove(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}_onTouchMove(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}_onMouseUp(t){p(document).off(k,this._onMouseMove).off(D,this._onMouseUp),this._end(t,this.el)}_onTouchEnd(t){p(document).off(V,this._onTouchMove).off(C,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}_emitEvent(){this.eventDispatcher.emit(this,...arguments)}on(t,e){return this.eventDispatcher.addEventListener(t,e),this}off(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}const P=()=>{throw Error("Method not implemented")},j=Math.PI/180,X=(t,e)=>{if(0===e)return t;{const s=((t,e)=>0===e?t:Math.round(t/e)*e)(t,e);if(s-t<e)return s}},H=(t,e=6)=>Number(t.toFixed(e)),L=(t,e)=>{const s=t.map(t=>t[e]);return[Math.min(...s),Math.max(...s)]},z=t=>t.getBoundingClientRect(),$=(t,e)=>{if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach(e=>t.classList.add(e))}return t}},I=(t,e)=>{if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach(e=>t.classList.remove(e))}return t}},B=(t,e)=>{const{top:s,left:r}=z(t),{top:o,left:n}=z(e),a=p(t),i=p(e);return!(s<o||s+parseFloat(a.css("height"))>o+parseFloat(i.css("height"))||r<n||r+parseFloat(a.css("width"))>n+parseFloat(i.css("width")))},G=t=>{const e=`matrix3d(${t.join()})`;return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}},F=(t,e)=>{const s=window.getComputedStyle(t);let r=null;for(const t of b)if(r=s.getPropertyValue(`${t}${e}`)||r)break;return r},{NOTIFIER_EVENTS:W,ON_GETSTATE:U,ON_APPLY:q,ON_MOVE:Z,ON_RESIZE:K,ON_ROTATE:Q}=m,{EMITTER_EVENTS:J,E_DRAG_START:tt,E_DRAG:et,E_DRAG_END:st,E_RESIZE_START:rt,E_RESIZE:ot,E_RESIZE_END:nt,E_ROTATE_START:at,E_ROTATE:it,E_ROTATE_END:ct}=g,{TRANSFORM_HANDLES_KEYS:lt,TRANSFORM_EDGES_KEYS:ht}=v,{TOP_LEFT:ut,TOP_CENTER:dt,TOP_RIGHT:pt,BOTTOM_LEFT:xt,BOTTOM_RIGHT:yt,BOTTOM_CENTER:ft,MIDDLE_LEFT:bt,MIDDLE_RIGHT:mt}=lt,{TOP_EDGE:gt,BOTTOM_EDGE:_t,LEFT_EDGE:vt,RIGHT_EDGE:Et}=ht;class Mt extends Y{constructor(t,e,s){if(super(t),this.constructor===Mt)throw new TypeError("Cannot construct Transformable instances directly");this.observable=s,J.forEach(t=>this.eventDispatcher.registerEvent(t)),this.enable(e)}_cursorPoint(){throw Error("'_cursorPoint()' method not implemented")}_rotate({radians:t,...e}){const s={transform:this._processRotate(t),delta:t,...e};this.proxyMethods.onRotate.call(this,s),this._emitEvent(it,s)}_resize({dx:t,dy:e,...s}){const r={...this._processResize(t,e),dx:t,dy:e,...s};this.proxyMethods.onResize.call(this,r),this._emitEvent(ot,r)}_processOptions(t={}){const{el:e}=this;$(e,`${f}drag`);const{each:s={move:!1,resize:!1,rotate:!1},snap:r={x:10,y:10,angle:10},axis:o="xy",cursorMove:n="auto",cursorResize:a="auto",cursorRotate:i="auto",rotationPoint:c=!1,restrict:l,draggable:u=!0,resizable:d=!0,rotatable:x=!0,scalable:y=!1,applyTranslate:b=!1,onInit:m=(()=>{}),onDrop:g=(()=>{}),onMove:_=(()=>{}),onResize:v=(()=>{}),onRotate:E=(()=>{}),onDestroy:M=(()=>{}),container:T=e.parentNode,proportions:w=!1,rotatorAnchor:O=null,rotatorOffset:S=50,showNormal:R=!0,custom:N}=t;this.options={axis:o,cursorMove:n,cursorRotate:i,cursorResize:a,rotationPoint:c,restrict:l?p(l)[0]||document.body:null,container:p(T)[0],snap:{...r,angle:r.angle*j},each:s,proportions:w,draggable:u,resizable:d,rotatable:x,scalable:y,applyTranslate:b,custom:"object"==typeof N&&N||null,rotatorAnchor:O,rotatorOffset:S,showNormal:R},this.proxyMethods={onInit:h(m),onDrop:h(g),onMove:h(_),onResize:h(v),onRotate:h(E),onDestroy:h(M)},this.subscribe(s)}_animate(){const e=this,{observable:s,storage:r,options:o}=e;if(c(r))return;if(r.frame=t(e._animate),!r.doDraw)return;r.doDraw=!1;let{dox:n,doy:a,clientX:i,clientY:l,doDrag:h,doResize:u,doRotate:d,doSetCenter:p,revX:x,revY:y}=r;const{snap:f,each:{move:b,resize:m,rotate:g},draggable:_,resizable:v,rotatable:E}=o;if(u&&v){const{transform:{scX:t,scY:o},cx:c,cy:h}=r,{x:u,y:d}=this._pointToElement({x:i,y:l});let p=n?X(u-c,f.x/t):0,b=a?X(d-h,f.y/o):0;const g={dx:p=n?x?-p:p:0,dy:b=a?y?-b:b:0,clientX:i,clientY:l};e._resize(g),m&&s.notify(K,e,g)}if(h&&_){const{nx:t,ny:o}=r,c={dx:n?X(i-t,f.x):0,dy:a?X(l-o,f.y):0,clientX:i,clientY:l};e._drag(c),b&&s.notify(Z,e,c)}if(d&&E){const{pressang:t,center:o}=r,n=Math.atan2(l-o.y,i-o.x)-t,a={clientX:i,clientY:l};e._rotate({radians:X(n,f.angle),...a}),g&&s.notify(Q,e,{radians:n,...a})}if(p&&E){const{bx:t,by:s}=r,{x:o,y:n}=this._pointToControls({x:i,y:l});e._moveCenterHandle(o-t,n-s)}}_start(t){const{clientX:e,clientY:s}=t,{observable:r,storage:o,storage:{handles:n},options:{axis:a,each:c},el:l}=this,h=Object.values(n).some(e=>p(t.target).is(e))||l.contains(t.target);if(o.isTarget=h,!h)return;const u=this._compute(t,l);Object.keys(u).map(t=>o[t]=u[t]);const{onRightEdge:d,onBottomEdge:x,onTopEdge:y,onLeftEdge:b,handle:m,factor:g,revX:_,revY:v,doW:E,doH:M}=u,T=d||x||y||b,{rotator:w,center:O,radius:S}=n;i(S)&&I(S,`${f}hidden`);const R=m.is(w),N=!!i(O)&&m.is(O),A=l.contains(t.target)&&!(R||T||N),{x:k,y:D}=this._cursorPoint({clientX:e,clientY:s}),{x:V,y:C}=this._pointToElement({x:k,y:D}),{x:Y,y:P}=this._pointToControls({x:k,y:D}),j={clientX:e,clientY:s,cx:V,cy:C,nx:k,ny:D,bx:Y,by:P,doResize:T,doDrag:A,doRotate:R,doSetCenter:N,onExecution:!0,cursor:null,dox:/\x/.test(a)&&(!T||(m.is(n.ml)||m.is(n.mr)||m.is(n.tl)||m.is(n.tr)||m.is(n.bl)||m.is(n.br)||m.is(n.le)||m.is(n.re))),doy:/\y/.test(a)&&(!T||(m.is(n.br)||m.is(n.bl)||m.is(n.bc)||m.is(n.tr)||m.is(n.tl)||m.is(n.tc)||m.is(n.te)||m.is(n.be))),cached:{}};this.storage={...o,...j};const X={clientX:e,clientY:s};T?this._emitEvent(rt,X):R?this._emitEvent(at,X):A&&this._emitEvent(tt,X);const{move:H,resize:L,rotate:z}=c,$=T?ot:R?it:et,B=T&&L||R&&z||A&&H;r.notify(U,this,{clientX:e,clientY:s,actionName:$,triggerEvent:B,factor:g,revX:_,revY:v,doW:E,doH:M}),this._draw()}_moving(t){const{storage:e,options:s}=this;if(!e.isTarget)return;const{x:r,y:o}=this._cursorPoint(t);e.e=t,e.clientX=r,e.clientY=o,e.doDraw=!0;let{doRotate:n,doDrag:a,doResize:i,cursor:l}=e;const{cursorMove:h,cursorResize:u,cursorRotate:d}=s;c(l)&&(a?l=h:n?l=d:i&&(l=u),p(document.body).css({cursor:l}))}_end({clientX:t,clientY:s}){const{options:{each:r},observable:o,storage:n,storage:{doResize:a,doDrag:c,doRotate:l,frame:h,handles:{radius:u},isTarget:d},proxyMethods:x}=this;if(!d)return;const y=a?ot:c?et:it;n.doResize=!1,n.doDrag=!1,n.doRotate=!1,n.doSetCenter=!1,n.doDraw=!1,n.onExecution=!1,n.cursor=null,this._apply(y);const b={clientX:t,clientY:s};x.onDrop.call(this,b),a?this._emitEvent(nt,b):l?this._emitEvent(ct,b):c&&this._emitEvent(st,b);const{move:m,resize:g,rotate:_}=r,v=a&&g||l&&_||c&&m;o.notify(q,this,{clientX:t,clientY:s,actionName:y,triggerEvent:v}),e(h),p(document.body).css({cursor:"auto"}),i(u)&&$(u,`${f}hidden`)}_compute(t,e){const{handles:s}=this.storage,r=p(t.target),{revX:o,revY:n,doW:a,doH:i,...c}=this._checkHandles(r,s),l=this._getState({revX:o,revY:n,doW:a,doH:i}),{x:h,y:u}=this._cursorPoint(t),d=Math.atan2(u-l.center.y,h-l.center.x);return{...l,...c,handle:Object.values(s).some(e=>p(t.target).is(e))?r:p(e),pressang:d}}_checkHandles(t,e){const s=s=>s.some(s=>(e=>!!i(e)&&t.is(e))(e[s]));return{revX:s([ut,bt,xt,dt,vt]),revY:s([ut,pt,dt,bt,gt]),onTopEdge:s([dt,pt,ut,gt]),onLeftEdge:s([ut,bt,xt,vt]),onRightEdge:s([pt,mt,yt,Et]),onBottomEdge:s([yt,ft,xt,_t]),doW:s([bt,mt,vt,Et]),doH:s([dt,ft,_t,gt])}}notifyMove(){this._drag(...arguments)}notifyRotate({radians:t,...e}){const{snap:{angle:s}}=this.options;this._rotate({radians:X(t,s),...e})}notifyResize(){this._resize(...arguments)}notifyApply({clientX:t,clientY:e,actionName:s,triggerEvent:r}){this.proxyMethods.onDrop.call(this,{clientX:t,clientY:e}),r&&(this._apply(s),this._emitEvent(`${s}End`,{clientX:t,clientY:e}))}notifyGetState({clientX:t,clientY:e,actionName:s,triggerEvent:r,...o}){if(r){const r=this._getState(o);this.storage={...this.storage,...r},this._emitEvent(`${s}Start`,{clientX:t,clientY:e})}}subscribe({resize:t,move:e,rotate:s}){const{observable:r}=this;(e||t||s)&&r.subscribe(U,this).subscribe(q,this),e&&r.subscribe(Z,this),t&&r.subscribe(K,this),s&&r.subscribe(Q,this)}unsubscribe(){const{observable:t}=this;W.map(e=>t.unsubscribe(e,this))}disable(){const{storage:t,proxyMethods:e,el:s}=this;c(t)||(I(s,`${f}drag`),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,s),delete this.storage)}exeDrag({dx:t,dy:e}){const{draggable:s}=this.options;s&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._drag({dx:t,dy:e}),this._apply(et))}exeResize({dx:t,dy:e,revX:s=!1,revY:r=!1,doW:o=!1,doH:n=!1}){const{resizable:a}=this.options;a&&(this.storage={...this.storage,...this._getState({revX:s,revY:r,doW:o,doH:n})},this._resize({dx:t,dy:e}),this._apply(ot))}exeRotate({delta:t}){const{rotatable:e}=this.options;e&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._rotate({radians:t}),this._apply(it))}}const Tt=t=>t.map(t=>[...t]),wt=t=>t.reduce((e,s,r)=>[...e,t[0][r],t[1][r],t[2][r],t[3][r]],[]),Ot=(t=4)=>[...Array(t)].map((t,e,s)=>s.map(()=>+!e--)),St=(t,e,s=0)=>Ot().map((r,o)=>(r[3]=[t,e,s,1][o],r)),Rt=(t,e,s=1,r=1)=>Ot().map((o,n)=>(o[n]=[t,e,s,r][n],o)),Nt=(t,e)=>{const s=Ot();return s[0][0]=e,s[0][1]=-t,s[1][0]=t,s[1][1]=e,s},At=(t,e=!0)=>{const s=e?Tt(t):t;return s[0][3]=s[1][3]=s[2][3]=0,s},kt=(t,e)=>{const s=[];for(let r=0,o=t.length;r<o;++r){let n=0;for(let s=0;s<o;++s)n+=+t[r][s]*e[s];s[r]=n}return s},Dt=(t,e)=>{const s=[];for(let r=0;r<e.length;r++){s[r]=[];for(let o=0;o<t[0].length;o++){let n=0;for(let s=0;s<t.length;s++)n+=t[s][o]*e[r][s];s[r].push(n)}}return s},Vt=t=>{const e=Tt(t);let s,r=e.length,o=[];for(let t=0;t<r;t++)o[t]=[];for(let t=0;t<r;t++)for(let e=0;e<r;e++)o[t][e]=0,t==e&&(o[t][e]=1);for(let t=0;t<r;t++){s=e[t][t];for(let n=0;n<r;n++)e[t][n]/=s,o[t][n]/=s;for(let n=t+1;n<r;n++){s=e[n][t];for(let a=0;a<r;a++)e[n][a]-=e[t][a]*s,o[n][a]-=o[t][a]*s}}for(let t=r-1;t>0;t--)for(let n=t-1;n>=0;n--){s=e[n][t];for(let a=0;a<r;a++)e[n][a]-=e[t][a]*s,o[n][a]-=o[t][a]*s}for(let t=0;t<r;t++)for(let s=0;s<r;s++)e[t][s]=o[t][s];return e},Ct=(t,[e,s,r])=>{const o=St(-e,-s,-r),n=St(e,s,r);return Dt(Dt(o,t),n)},Yt=(t,e=document.body,s)=>{let r=Ot(),o=t,n=s||jt(o),a=!1;for(;o&&o instanceof Element;){const t=Xt(o,a);if(r=Dt(r,Ct(n,t)),a=!0,o===e||null===o.offsetParent)break;o=o.offsetParent,n=jt(o)}return r},Pt=t=>{const e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),s=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),r=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]);let o=Math.atan2(-t[0][3]/r,t[1][3]/r),n=Math.asin(t[3][1]/r),a=Math.atan2(-t[3][0]/s,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=0,n=t[0][1]*-Math.PI/2,a=t[0][1]*Math.atan2(t[1][1]/s,t[0][1]/s)),{rotate:{x:o,y:n,z:a},translate:{x:t[0][3]/e,y:t[1][3]/s,z:t[2][3]/r},scale:{sX:e,sY:s,sZ:r}}},jt=t=>{const e=F(t,"transform")||"none",s=Ot();if("none"===e)return s;const r=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==r.length)return[[+r[0],+r[2],0,+r[4]],[+r[1],+r[3],0,+r[5]],[0,0,1,0],[0,0,0,1]];for(let t=0;t<4;++t)for(let e=0;e<4;++e)s[e][t]=+r[4*t+e];return s},Xt=(t,e)=>{const s=F(t,"transform-origin"),r=s?s.split(" "):[],o=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1];for(let t=0;t<r.length;++t)o[t]+=parseFloat(r[t]);return o},Ht=(t,e=document.body)=>{let s=0,r=0,o=!1;for(;t;){const n=Yt(t.offsetParent),[a,i]=kt(At(n,!1),[t.offsetLeft+(o?t.clientLeft:0),t.offsetTop+(o?t.clientTop:0),0,1]);if(r+=a,s+=i,e===t)break;o=!0,t=t.offsetParent}return[r,s,0,1]},{E_MOUSEDOWN:Lt,E_TOUCHSTART:zt}=_;class $t extends Mt{_init(t){const{rotationPoint:e,container:s,resizable:r,rotatable:o,showNormal:n,rotatorOffset:a,rotatorAnchor:l}=this.options,{offsetHeight:h,offsetWidth:u}=t,d=Ut(["sjx-wrapper"]),x=Ut(["sjx-controls"]),y={},f=Yt(t,s),[b,m]=Ht(t,s),g=["data-sjx-cx","data-sjx-cy"].map(e=>{const s=t.getAttribute(e);return i(s)?Number(s):void 0}),_=g.every(t=>!isNaN(t)),v={tl:[0,0,0,1],bl:[0,h,0,1],br:[u,h,0,1],tr:[u,0,0,1],tc:[u/2,0,0,1],ml:[0,h/2,0,1],bc:[u/2,h,0,1],mr:[u,h/2,0,1],center:[u/2,h/2,0,1]},E=Object.entries(v).reduce((t,[e,s])=>[...t,[e,kt(f,s)]],[]).reduce((t,[e,[s,r,o,n]])=>(t[e]=[s+b,r+m,o,n],t),{});let M={},T=null;if(o){const t={};let s=1;switch(l){case"n":t.x=E.tc[0],t.y=E.tc[1];break;case"s":t.x=E.bc[0],t.y=E.bc[1],s=-1;break;case"w":t.x=E.ml[0],t.y=E.ml[1],s=-1;break;case"e":default:t.x=E.mr[0],t.y=E.mr[1]}const r="n"===l||"s"===l?Math.atan2(E.bl[1]-E.tl[1],E.bl[0]-E.tl[0]):Math.atan2(E.tl[1]-E.tr[1],E.tl[0]-E.tr[0]);T=[t.x-a*s*Math.cos(r),t.y-a*s*Math.sin(r)];const o=n?Bt([[t.x,t.y],T]):null;n&&x.appendChild(o);let i=null;e&&(i=Bt([E.center,E.center]),$(i,"sjx-hidden"),x.appendChild(i)),M={...M,normal:o,radius:i}}const w={te:[E.tl,E.tr],be:[E.bl,E.br],le:[E.tl,E.bl],re:[E.tr,E.br]},O=r?{tl:E.tl,tr:E.tr,br:E.br,bl:E.bl,tc:E.tc,bc:E.bc,ml:E.ml,mr:E.mr}:{},S=_?[...g,0,1]:E.center,R={...O,center:e&&o?S:void 0,rotator:T},N=(t,e)=>Object.keys(t).map(s=>{const r=t[s];if(c(r))return;const o=e(r,s);y[s]=o,x.appendChild(o)});N(w,Bt),N(R,It),d.appendChild(x),s.appendChild(d),this.storage={wrapper:d,controls:x,handles:{...y,...M},parent:t.parentNode,center:{isShifted:_},cached:{}},[t,x].map(t=>p(t).on(Lt,this._onMouseDown).on(zt,this._onTouchStart))}_destroy(){const{el:t,storage:{controls:e,wrapper:s}}=this;[t,e].map(t=>p(t).off(Lt,this._onMouseDown).off(zt,this._onTouchStart)),s.parentNode.removeChild(s)}_pointToElement({x:t,y:e}){const{transform:{ctm:s}}=this.storage,r=Vt(s);return this._applyMatrixToPoint(At(r,!1),t,e)}_pointToControls({x:t,y:e}){const{transform:{wrapperMatrix:s}}=this.storage,r=Vt(s);return this._applyMatrixToPoint(At(r,!1),t,e)}_applyMatrixToPoint(t,e,s){const[r,o]=kt(t,[e,s,0,1]);return{x:r,y:o}}_cursorPoint({clientX:t,clientY:e}){const{container:s}=this.options,r=Yt(s);return this._applyMatrixToPoint(Vt(r),t,e)}_restrictHandler(t){const{storage:{transform:{containerMatrix:e}},options:{restrict:s,container:r}}=this;let o=null,n=null;const a=Wt(s,r,e),i=this.getBoundingRect(t),[c,l]=L(a,0),[h,u]=L(a,1);for(let t=0,e=i.length;t<e;t++){const[e,s]=i[t];(e<c||e>l)&&(o=e),(s<h||s>u)&&(n=s)}return{x:o,y:n}}_apply(){const{el:t,storage:{cached:e,controls:s,transform:{matrix:r},center:o},options:{applyTranslate:n}}=this,a=p(s);if(!c(e)){if(t.setAttribute("data-sjx-cx",o.elX),t.setAttribute("data-sjx-cy",o.elY),n){const s=p(t),{dx:o,dy:n}=e,i=G(r),c=parseFloat(t.style.left||s.css("left")),l=parseFloat(t.style.top||s.css("top"));i.left=`${c+o}px`,i.top=`${l+n}px`,s.css(i),a.css(i)}this.storage.cached={}}}_processResize(t,e){const{el:s,storage:r,storage:{transform:{matrix:o,auxiliary:{scale:{translateMatrix:n}}},cached:{dist:{dx:a=t,dy:i=e}={}}={},box:{width:c,height:l},revX:h,revY:u,doW:d,doH:y},options:{proportions:f,scalable:b,restrict:m}}=this,g=(t,e)=>{const s=d||!d&&!y?(c+t)/c:(l+e)/l,r=f?c*s:c+t,o=f?l*s:l+e;return[r/c,o/l,r,o]},_=(t,e)=>{const s=Rt(t,e);return Dt(Dt(n,s),Vt(n))},v=(t,e)=>{const s=t[0][3],r=t[1][3],o=St(s,r),n=St(s*(h?-1:1),r*(u?-1:1));return Dt(Dt(n,e),Vt(o))},[E,M,T,w]=g(t,e),O=_(E,M),S=b?Dt(O,o):v(O,o);this.storage.cached.box={width:T,height:w};const{x:R,y:N}=m?this._restrictHandler(S):{x:null,y:null},A=(null!==R||null!==N)&&m,k=A?a:t,D=A?i:e,[V,C,Y,P]=g(k,D);if(Math.abs(Y)<=x||Math.abs(P)<=x)return;const j=_(V,C),X=b?Dt(j,o):v(j,o);return p(s).css({...G(wt(X)),...!b&&{width:`${Y}px`,height:`${P}px`}}),Ft(r,this.options,{el:s,boxMatrix:X}),r.cached.dist={dx:k,dy:D},{transform:X,width:Y,height:P}}_processMove(t,e){const{el:s,storage:r,storage:{wrapper:o,transform:{matrix:n,wrapperMatrix:a,auxiliary:{translate:{parentMatrix:i}}},center:c,cached:{dist:{dx:l=t,dy:h=e}={}}={}},options:{restrict:u}}=this,[d,x]=kt(i,[t,e,0,1]),y=Dt(n,St(d,x)),{x:f,y:b}=u?this._restrictHandler(y):{x:null,y:null},m=null!==f&&u?l:t,g=null!==b&&u?h:e,[_,v]=kt(i,[m,g,0,1]),E=Dt(n,St(_,v)),M=Dt(a,St(m,g)),T=G(wt(E)),w=G(wt(M));return p(s).css(T),p(o).css(w),r.cached.dist={dx:m,dy:g},c.isShifted,E}_processRotate(t){const{el:e,storage:{transform:{matrix:s,auxiliary:{rotate:{translateMatrix:r}}}},options:{restrict:o}}=this,n=H(Math.cos(t),4),a=H(Math.sin(t),4),c=Nt(a,n),l=Dt(Dt(Vt(r),c),r),h=Dt(s,l),{x:u,y:d}=o?this._restrictHandler(h):{x:null,y:null};return i(u)||i(d)?h:(p(e).css(G(wt(h))),Ft(this.storage,this.options,{el:e,boxMatrix:h}),h)}_getState({revX:t,revY:e,doW:s,doH:r}){const{el:o,storage:{handles:{center:n},parent:a,wrapper:i,center:c},options:{container:l,restrict:h,scalable:u}}=this,{offsetWidth:d,offsetHeight:p}=h||l,[x,y]=Ht(o,l),{offsetLeft:f,offsetTop:b,offsetWidth:m,offsetHeight:g}=o,_=jt(o),v=Yt(o,l),E=Yt(a,l),M=Yt(i,l),T=h?Yt(h,h.parentNode):Yt(l,l.parentNode),w=m/2,O=g/2,S=r?0:t?-w:w,R=s?0:e?-O:O,[N,A]=kt(v,[w,O,0,1]),k=N+x,D=A+y,V=n?jt(n):Ot(),{translate:{x:C,y:Y}}=n?Pt(Yt(n)):{translate:{x:k,y:D}},[P,j]=kt(Dt(Vt(At(v)),At(V)),[C-k,Y-D,0,1]),[X,H]=kt(_,[P,j,0,1]),L=kt(At(T),[d,p,0,1]),{scale:{sX:z,sY:$}}=Pt(Yt(o,o.parentNode));return{transform:{auxiliary:{scale:{translateMatrix:u?St(S,R):St(r?0:w,s?0:O)},translate:{parentMatrix:Vt(At(E))},rotate:{translateMatrix:St(X,H)}},scaleX:S,scaleY:R,matrix:_,ctm:v,parentMatrix:E,containerMatrix:T,wrapperMatrix:M,scX:z,scY:$,containerBox:L},box:{width:m,height:g,left:f,top:b,offset:{left:x,top:y}},center:{...c,x:k,y:D,elX:X,elY:H,matrix:V},revX:t,revY:e,doW:s,doH:r}}_moveCenterHandle(t,e){const{storage:{handles:{center:s},center:{matrix:r}}}=this,o=Dt(r,St(t,e));p(s).css({...G(wt(o))}),this.storage.center.isShifted=!0}resetCenterPoint(){const{el:t,el:{offsetHeight:e,offsetWidth:s},storage:{wrapper:r,handles:{center:o}},options:{container:n}}=this;if(!o)return;const[a,i]=Ht(t,n),c=Dt(Yt(t,n),Vt(Yt(r,r.parentNode))),[l,h]=kt(c,[s/2,e/2,0,1]);p(o).css({transform:`translate(${l+a}px, ${h+i}px)`})}fitControlsToSize(){const{el:t,storage:{wrapper:e}}=this;e.removeAttribute("transform"),Ft(this.storage,this.options,{el:t})}getBoundingRect(t=null){const{el:e,options:{scalable:s,restrict:r},storage:{box:o,box:{width:n,height:a},cached:{box:{width:i=n,height:c=a}={}}={}}}=this,l=s?o:{...o,width:i,height:c};return Wt(e,r,Yt(e,r,t),l)}get controls(){return this.storage.wrapper}}const It=([t,e],s="handler",r={})=>{const o=Ut(["sjx-hdl",`sjx-hdl-${s}`]);return p(o).css({transform:`translate(${t}px, ${e}px)`,...r}),o},Bt=([t,e,s=1],r)=>{const{cx:o,cy:n,length:a,theta:i}=Gt(t,e,s),c=Ut(["sjx-hdl-line",`sjx-hdl-${r}`]);return p(c).css({transform:`translate(${o}px, ${n}px) rotate(${i}deg)`,height:`${s}px`,width:`${a}px`}),c},Gt=(t,e,s=1)=>{const[r,o]=t,[n,a]=e,i=Math.sqrt((n-r)*(n-r)+(a-o)*(a-o));return{cx:(r+n)/2-i/2,cy:(o+a)/2-s/2,thickness:s,theta:Math.atan2(o-a,r-n)*(180/Math.PI),length:i}},Ft=(t,e,s)=>{const{wrapper:r,handles:o,transform:{wrapperMatrix:n=Yt(r,r.parentNode)}={},center:a}=t,{rotationPoint:i,rotatable:c,resizable:l,showNormal:h,rotatorOffset:u,rotatorAnchor:d,container:x}=e,{el:y,el:{offsetHeight:f,offsetWidth:b}}=s,[m,g]=Ht(y,x),_=Dt(Yt(y,x),Vt(n)),v={tl:[0,0,0,1],tr:[b,0,0,1],bl:[0,f,0,1],br:[b,f,0,1],tc:[b/2,0,0,1],ml:[0,f/2,0,1],bc:[b/2,f,0,1],mr:[b,f/2,0,1],...i&&c&&!a.isShifted&&{center:[b/2,f/2,0,1]}},E=Object.entries(v).reduce((t,[e,s])=>[...t,[e,kt(_,s)]],[]).reduce((t,[e,[s,r,o,n]])=>(t[e]=[s+m,r+g,o,n],t),{});let M=null,T={};if(c){const t={};let e=1,s=[];switch(d){case"n":t.x=E.tc[0],t.y=E.tc[1];break;case"s":t.x=E.bc[0],t.y=E.bc[1],e=-1;break;case"w":t.x=E.ml[0],t.y=E.ml[1],e=-1;break;case"e":default:t.x=E.mr[0],t.y=E.mr[1]}const r="n"===d||"s"===d?Math.atan2(E.bl[1]-E.tl[1],E.bl[0]-E.tl[0]):Math.atan2(E.tl[1]-E.tr[1],E.tl[0]-E.tr[0]),o=u*e;s=[t.x-o*Math.cos(r),t.y-o*Math.sin(r)],M=h?[[t.x,t.y],s]:null,T={rotator:s}}const w={...E},O={te:[E.tl,E.tr],be:[E.bl,E.br],le:[E.tl,E.bl],re:[E.tr,E.br],...h&&M&&{normal:M}};Object.keys(O).forEach(t=>{const[e,s]=O[t],{cx:r,cy:n,length:a,theta:i}=Gt(e,s);p(o[t]).css({transform:`translate(${r}px, ${n}px) rotate(${i}deg)`,width:`${a}px`})});const S={...l&&w,...T};Object.keys(S).forEach(t=>{const e=S[t];if(!e)return;const[s,r]=e;p(o[t]).css({transform:`translate(${s}px, ${r}px)`})})},Wt=(t,e,s,r)=>{const[o,n]=Ht(t,e),{width:a,height:i,offset:{left:c,top:l}}=r||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:n}};return[[0,0,0,1],[a,0,0,1],[0,i,0,1],[a,i,0,1]].reduce((t,e)=>[...t,kt(s,e)],[]).map(([t,e,s,r])=>[t+c,e+l,s,r])},Ut=(t=[])=>{const e=document.createElement("div");return t.forEach(t=>$(e,t)),e},qt=Qt("svg").createSVGPoint(),Zt=/[+-]?\d+(\.\d+)?/g,Kt=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Qt(t,e=[]){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return e.forEach(t=>$(s,t)),s}const Jt=t=>{const e=[];return he(t)?s.call(t.childNodes,t=>{if(1===t.nodeType){const s=t.tagName.toLowerCase();-1!==Kt.indexOf(s)&&("g"===s&&e.push(...Jt(t)),e.push(t))}}):e.push(t),e},te=()=>Qt("svg").createSVGMatrix(),ee=(t,e)=>{const s=te();return s.e=t,s.f=e,s},se=(t,e)=>{const s=te();return s.a=e,s.b=t,s.c=-t,s.d=e,s},re=(t,e)=>{const s=te();return s.a=t,s.d=e,s},oe=(t,e)=>{return(e.getScreenCTM&&e.getScreenCTM()||te()).inverse().multiply(t.getScreenCTM()||te())},ne=t=>{const{a:e,b:s,c:r,d:o,e:n,f:a}=t;return`matrix(${e},${s},${r},${o},${n},${a})`},ae=(t,e,s)=>(qt.x=e,qt.y=s,qt.matrixTransform(t)),ie=t=>{const e=te();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e},ce=t=>{const{a:e,b:s,c:r,d:o,e:n,f:a}=t;return 1===e&&0===s&&0===r&&1===o&&0===n&&0===a},le=t=>{const e=t.tagName.toLowerCase();return-1!==Kt.indexOf(e)||(a(`Selected element "${e}" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g`),!1)},he=t=>"g"===t.tagName.toLowerCase(),ue=t=>t.match(Zt).reduce((t,e,s,r)=>(s%2==0&&t.push(r.slice(s,s+2)),t),[]),de=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,pe=/\s*,\s*|\s+/g,xe=t=>{let e=de.lastIndex=0;const s=[];for(;e=de.exec(t);){const[,t,r]=e,o=t.toUpperCase(),n=r.replace(/([^e])-/g,"$1 -").replace(/ +/g," ");s.push({relative:t!==o,key:o,cmd:t,values:n.trim().split(pe).map(t=>{if(!isNaN(t))return Number(t)})})}return s},ye=t=>{const{path:e,dx:s,dy:r}=t;try{const t=xe(e);let o="",n=" ",a=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e],{values:c,key:l,relative:h}=i,u=[];switch(l){case"M":for(let t=0,e=c.length;t<e;t+=2){let[e,o]=c.slice(t,t+2);h&&!a||(e+=s,o+=r),u.push(e,o),a=!1}break;case"A":for(let t=0,e=c.length;t<e;t+=7){const e=c.slice(t,t+7);h||(e[5]+=s,e[6]+=r),u.push(...e)}break;case"C":for(let t=0,e=c.length;t<e;t+=6){const e=c.slice(t,t+6);h||(e[0]+=s,e[1]+=r,e[2]+=s,e[3]+=r,e[4]+=s,e[5]+=r),u.push(...e)}break;case"H":for(let t=0,e=c.length;t<e;t+=1){const e=c.slice(t,t+1);h||(e[0]+=s),u.push(e[0])}break;case"V":for(let t=0,e=c.length;t<e;t+=1){const e=c.slice(t,t+1);h||(e[0]+=r),u.push(e[0])}break;case"L":case"T":for(let t=0,e=c.length;t<e;t+=2){let[e,o]=c.slice(t,t+2);h||(e+=s,o+=r),u.push(e,o)}break;case"Q":case"S":for(let t=0,e=c.length;t<e;t+=4){let[e,o,n,a]=c.slice(t,t+4);h||(e+=s,o+=r,n+=s,a+=r),u.push(e,o,n,a)}break;case"Z":c[0]="",n=""}o+=i.cmd+u.join(",")+n}return o}catch(t){a("Path parsing error: "+t)}},fe=t=>{const{path:e,localCTM:s}=t;try{const t=xe(e);let r="",o=" ";const n=[];let a=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e],{values:c,key:l,relative:h}=i;switch(l){case"A":{const t=[];for(let e=0,r=c.length;e<r;e+=7){const[r,o,n,a,i,l,u]=c.slice(e,e+7),d=ie(s);h&&(d.e=d.f=0);const{x:p,y:x}=ae(d,l,u);t.push(H(p),H(x)),d.e=d.f=0;const{x:y,y:f}=ae(d,r,o);t.unshift(H(y),H(f),n,a,i)}n.push(t);break}case"C":{const t=[];for(let e=0,r=c.length;e<r;e+=6){const[r,o,n,a,i,l]=c.slice(e,e+6),u=ie(s);h&&(u.e=u.f=0);const{x:d,y:p}=ae(u,r,o),{x:x,y:y}=ae(u,n,a),{x:f,y:b}=ae(u,i,l);t.push(H(d),H(p),H(x),H(y),H(f),H(b))}n.push(t);break}case"H":{const t=[];for(let e=0,r=c.length;e<r;e+=1){const[r]=c.slice(e,e+1),o=ie(s);h&&(o.e=o.f=0);const{x:n}=ae(o,r,0);t.push(H(n))}n.push(t);break}case"V":{const t=[];for(let e=0,r=c.length;e<r;e+=1){const[r]=c.slice(e,e+1),o=ie(s);h&&(o.e=o.f=0);const{y:n}=ae(o,0,r);t.push(H(n))}n.push(t);break}case"T":case"L":{const t=[];for(let e=0,r=c.length;e<r;e+=2){const[r,o]=c.slice(e,e+2),n=ie(s);h&&(n.e=n.f=0);const{x:a,y:i}=ae(n,r,o);t.push(H(a),H(i))}n.push(t);break}case"M":{const t=[];for(let e=0,r=c.length;e<r;e+=2){const[r,o]=c.slice(e,e+2),n=ie(s);h&&!a&&(n.e=n.f=0);const{x:i,y:l}=ae(n,r,o);t.push(H(i),H(l)),a=!1}n.push(t);break}case"Q":{const t=[];for(let e=0,r=c.length;e<r;e+=4){const[r,o,n,a]=c.slice(e,e+4),i=ie(s);h&&(i.e=i.f=0);const{x:l,y:u}=ae(i,r,o),{x:d,y:p}=ae(i,n,a);t.push(H(l),H(u),H(d),H(p))}n.push(t);break}case"S":{const t=[];for(let e=0,r=c.length;e<r;e+=4){const[r,o,n,a]=c.slice(e,e+4),i=ie(s);h&&(i.e=i.f=0);const{x:l,y:u}=ae(i,r,o),{x:d,y:p}=ae(i,n,a);t.push(H(l),H(u),H(d),H(p))}n.push(t);break}case"Z":n.push([""]),o=""}r+=i.cmd+n[e].join(",")+o}return r}catch(t){a("Path parsing error: "+t)}},{E_DRAG:be,E_RESIZE:me}=g,{E_MOUSEDOWN:ge,E_TOUCHSTART:_e}=_;class ve extends Mt{_init(t){const{rotationPoint:e,container:s,resizable:r,rotatable:o,rotatorAnchor:n,rotatorOffset:a,showNormal:h,custom:u}=this.options,d=t.getBBox(),{x:x,y:f,width:b,height:m}=d,g=Qt("g",["sjx-svg-wrapper"]),_=Qt("g",["sjx-svg-controls"]),v=["data-sjx-cx","data-sjx-cy"].map(e=>{const s=t.getAttribute(e);return i(s)?Number(s):void 0}),E=v.every(t=>!isNaN(t)),M={tl:[x,f],tr:[x+b,f],mr:[x+b,f+m/2],ml:[x,f+m/2],tc:[x+b/2,f],bc:[x+b/2,f+m],br:[x+b,f+m],bl:[x,f+m],center:[x+b/2,f+m/2]},T=oe(t,s),w=Object.entries(M).reduce((t,[e,[s,r]])=>({...t,[e]:ae(T,s,r)}),{}),O={};let S={},R=null;if(o){const t={};let s=1;switch(n){case"n":t.x=w.tc.x,t.y=w.tc.y;break;case"s":t.x=w.bc.x,t.y=w.bc.y,s=-1;break;case"w":t.x=w.ml.x,t.y=w.ml.y,s=-1;break;case"e":default:t.x=w.mr.x,t.y=w.mr.y}const r="n"===n||"s"===n?Math.atan2(w.bl.y-w.tl.y,w.bl.x-w.tl.x):Math.atan2(w.tl.y-w.tr.y,w.tl.x-w.tr.x);R={x:t.x-a*s*Math.cos(r),y:t.y-a*s*Math.sin(r)};const o=h?Re([t,R],y,"norm"):null;h&&_.appendChild(o);let i=null;e&&((i=Qt("line",["sjx-hidden"])).x1.baseVal.value=w.center.x,i.y1.baseVal.value=w.center.y,i.x2.baseVal.value=v[0]||w.center.x,i.y2.baseVal.value=v[1]||w.center.y,Oe(i,"#fe3232"),i.setAttribute("opacity",.5),_.appendChild(i)),S={...S,normal:o,radius:i}}const N=r?{...w,rotator:R}:{},A={te:[N.tl,N.tr],be:[N.bl,N.br],le:[N.tl,N.bl],re:[N.tr,N.br]};Object.keys(A).forEach(t=>{const e=A[t];c(e)||(O[t]=Re(e,y,t),_.appendChild(O[t]))});const k=E?ae(te(),v[0],v[1]):w.center,D={...N,center:e&&o?k:void 0};Object.keys(D).forEach(t=>{const e=D[t];if(c(e))return;const{x:s,y:r}=e,o="center"===t?"#fe3232":y;i(u)&&l(u[t])?O[t]=u[t](T,d,ae):O[t]=we(s,r,o,t),_.appendChild(O[t])}),g.appendChild(_),s.appendChild(g),this.storage={wrapper:g,controls:_,handles:{...O,...S},parent:t.parentNode,center:{isShifted:E},cached:{}},[t,_].map(t=>p(t).on(ge,this._onMouseDown).on(_e,this._onTouchStart))}_destroy(){const{el:t,storage:{controls:e,wrapper:s}}=this;[t,e].map(t=>p(t).off(ge,this._onMouseDown).off(_e,this._onTouchStart)),s.parentNode.removeChild(s)}_cursorPoint({clientX:t,clientY:e}){const{container:s}=this.options;return this._applyMatrixToPoint(s.getScreenCTM().inverse(),t,e)}_restrictHandler(t){const{storage:{transform:{containerMatrix:e}},options:{restrict:s}}=this;let r=null,o=null;const n=Ne(s,e),a=this.getBoundingRect(t),[i,c]=L(n,0),[l,h]=L(n,1);for(let t=0,e=a.length;t<e;t++){const[e,s]=a[t];(e<i||e>c)&&(r=e),(s<l||s>h)&&(o=s)}return{x:r,y:o}}_pointToElement({x:t,y:e}){const{transform:{ctm:s}}=this.storage,r=s.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,t,e)}_pointToControls({x:t,y:e}){const{transform:{wrapperMatrix:s}}=this.storage,r=s.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,t,e)}_applyMatrixToPoint(t,e,s){const r=Qt("svg").createSVGPoint();return r.x=e,r.y=s,r.matrixTransform(t)}_apply(t){const{el:e,storage:s,storage:{bBox:r,cached:o,transform:n,center:a},options:i,options:{container:l,scalable:h,applyTranslate:u}}=this,{matrix:d,parentMatrix:p,ctm:x}=n;if(e.setAttribute("data-sjx-cx",a.elX),e.setAttribute("data-sjx-cy",a.elY),c(o))return;const{scaleX:y,scaleY:f,dx:b,dy:m,ox:g,oy:_,transformMatrix:v}=o;if(t===be){if(!u||0===b&&0===m)return;const t=ee(b,m),s=t.multiply(d).multiply(t.inverse());if(e.setAttribute("transform",ne(s)),he(e)){Jt(e).forEach(t=>{const e=ee(b,m),s=e.multiply(oe(t,t.parentNode)).multiply(e.inverse());if(ce(s)||t.setAttribute("transform",ne(s)),!he(t)){const e=p.inverse();e.e=e.f=0,Ee(t,{...ae(e,g,_)})}})}else Ee(e,{x:b,y:m})}if(t===me){if(!v)return;if(!h)if(he(e)){Jt(e).forEach(t=>{if(!he(t)){const n=oe(t,e),a=n.inverse().multiply(v).multiply(n);Me(t,{scaleX:y,scaleY:f,localCTM:a,bBox:r,container:l,storage:s,cached:o})}})}else{const t=l.getScreenCTM()||te(),n=e.getScreenCTM().multiply(v),a=t.inverse().multiply(n),i=x.inverse().multiply(a);Me(e,{scaleX:y,scaleY:f,localCTM:i,bBox:r,container:l,storage:s,cached:o})}Te(s,i,{boxMatrix:h?x.multiply(v):x,element:e})}}_processResize(t,e){const{el:s,storage:r,storage:{bBox:{width:o,height:n},revX:a,revY:i,doW:c,doH:l,transform:{matrix:h,auxiliary:{scale:{translateMatrix:u}}},cached:{dist:{dx:d=t,dy:p=e}={}}={}},options:{proportions:y,scalable:f,restrict:b}}=this,{x:m,y:g}=s.getBBox(),_=(t,e)=>{const s=c||!c&&!l?(o+t)/o:(n+e)/n,r=y?o*s:o+t,a=y?n*s:n+e;return[r/o,a/n,r,a]},v=(t,e)=>{const s=re(t,e);return u.multiply(s).multiply(u.inverse())},E=h.multiply(v(..._(t,e))),{x:M,y:T}=b?this._restrictHandler(E):{x:null,y:null},w=(null!==M||null!==T)&&b,O=w?d:t,S=w?p:e,[R,N,A,k]=_(O,S);if(Math.abs(A)<=x||Math.abs(k)<=x)return;const D=v(R,N),V=h.multiply(D),C=m-(A-o)*(l?.5:a?1:0),Y=g-(k-n)*(c?.5:i?1:0);return f&&s.setAttribute("transform",ne(V)),r.cached={...r.cached,scaleX:R,scaleY:N,transformMatrix:D,resultMatrix:V,dist:{dx:O,dy:S}},this._apply(me),{x:C,y:Y,width:A,height:k,transform:V}}_processMove(t,e){const{storage:s,storage:{wrapper:r,center:o,transform:{matrix:n,auxiliary:{translate:{translateMatrix:a,wrapperTranslateMatrix:i}},wrapperMatrix:c,parentMatrix:l},cached:{dist:{dx:h=t,dy:u=e}={}}={}},options:{restrict:d}}=this;l.e=l.f=0;const{x:p,y:x}=ae(l.inverse(),t,e),y=ee(p,x).multiply(n),{x:f,y:b}=d?this._restrictHandler(y):{x:null,y:null};s.cached.dist={dx:null!==f&&d?h:t,dy:null!==b&&d?u:e};const{x:m,y:g}=ae(l.inverse(),h,u);a.e=m,a.f=g;const _=a.multiply(n);i.e=h,i.f=u;const v=i.multiply(c);if(r.setAttribute("transform",ne(v)),this.el.setAttribute("transform",ne(_)),o.isShifted){const t=c.inverse();t.e=t.f=0;const{x:e,y:s}=ae(t,h,u);this._moveCenterHandle(-e,-s)}return _}_processRotate(t){const{storage:{wrapper:e,transform:{matrix:s,wrapperMatrix:r,parentMatrix:o,auxiliary:{rotate:{translateMatrix:n,wrapperTranslateMatrix:a}}}},options:{restrict:c}}=this,l=H(Math.cos(t)),h=H(Math.sin(t)),u=se(h,l);o.e=o.f=0;const d=o.inverse().multiply(u).multiply(o),p=n.multiply(d).multiply(n.inverse()).multiply(s),{x:x,y:y}=c?this._restrictHandler(p):{x:null,y:null};if(i(x)||i(y))return p;const f=a.multiply(u).multiply(a.inverse()).multiply(r);return e.setAttribute("transform",ne(f)),this.el.setAttribute("transform",ne(p)),p}_getState({revX:t,revY:e,doW:s,doH:r}){const{el:o,storage:{wrapper:n,parent:a,handles:{center:i}},options:{container:c,restrict:l,rotationPoint:h}}=this,u=o.getBBox(),{x:d,y:p,width:x,height:y}=u,f=oe(o,a),b=oe(o,c),m=oe(n,c),g=oe(a,c),_=oe(n,n.parentNode),v=g.inverse(),E=d+x*(r?.5:t?1:0),M=p+y*(s?.5:e?1:0),T=d+x/2,w=p+y/2,O=h?i.cx.baseVal.value:T,S=h?i.cy.baseVal.value:w,{x:R,y:N}=ae(m,O,S),{x:A,y:k}=h?ae(v,R,N):ae(f,T,w),{x:D,y:V}=ae(b,T,w);Se(this.el),Jt(o).forEach(t=>{t.__ctm__=oe(t,t.parentNode),Se(t)});const C={...this.storage.center||{},x:h?R:D,y:h?N:V,elX:A,elY:k,hx:h?i.cx.baseVal.value:null,hy:h?i.cy.baseVal.value:null},Y=l?oe(l,l.parentNode):oe(c,c.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:te(),translateMatrix:ee(E,M)},translate:{parentMatrix:v,translateMatrix:te(),wrapperTranslateMatrix:te()},rotate:{translateMatrix:ee(C.elX,C.elY),wrapperTranslateMatrix:ee(C.x,C.y)}},matrix:f,ctm:b,parentMatrix:g,wrapperMatrix:_,containerMatrix:Y,scX:Math.sqrt(b.a*b.a+b.b*b.b),scY:Math.sqrt(b.c*b.c+b.d*b.d),containerBox:c.getBBox()},bBox:u,center:C,revX:t,revY:e,doW:s,doH:r}}_moveCenterHandle(t,e){const{handles:{center:s,radius:r},center:{hx:o,hy:n}}=this.storage;if(c(s))return;const a=o+t,i=n+e;s.cx.baseVal.value=a,s.cy.baseVal.value=i,r.x2.baseVal.value=a,r.y2.baseVal.value=i,this.storage.center.isShifted=!0}resetCenterPoint(){const{el:t,storage:{bBox:{width:e,height:s,x:r,y:o},handles:{center:n,radius:a}}}=this;if(!n)return;const i=oe(t,t.parentNode),{x:c,y:l}=ae(i,r+e/2,o+s/2);n.cx.baseVal.value=c,n.cy.baseVal.value=l,n.isShifted=!1,a.x2.baseVal.value=c,a.y2.baseVal.value=l}fitControlsToSize(){const{el:t,storage:{wrapper:e},options:{container:s}}=this,{width:r,height:o,x:n,y:a}=t.getBBox(),i=oe(t,s),c=te();this.storage.transform.wrapperMatrix=c,e.setAttribute("transform",ne(c)),Te(this.storage,this.options,{x:n,y:a,width:r,height:o,boxMatrix:i,element:t})}getBoundingRect(t){const{el:e,options:{container:s},storage:{bBox:r}}=this;return Ne(e,oe(e.parentNode,s).multiply(t),r)}get controls(){return this.storage.wrapper}}const Ee=(t,{x:e,y:s})=>{const r=[];switch(t.tagName.toLowerCase()){case"text":{const o=i(t.x.baseVal[0])?t.x.baseVal[0].value+e:(Number(t.getAttribute("x"))||0)+e,n=i(t.y.baseVal[0])?t.y.baseVal[0].value+s:(Number(t.getAttribute("y"))||0)+s;r.push(["x",o],["y",n]);break}case"foreignobject":case"use":case"image":case"rect":{const o=i(t.x.baseVal.value)?t.x.baseVal.value+e:(Number(t.getAttribute("x"))||0)+e,n=i(t.y.baseVal.value)?t.y.baseVal.value+s:(Number(t.getAttribute("y"))||0)+s;r.push(["x",o],["y",n]);break}case"circle":case"ellipse":{const o=t.cx.baseVal.value+e,n=t.cy.baseVal.value+s;r.push(["cx",o],["cy",n]);break}case"line":{const o=t.x1.baseVal.value+e,n=t.y1.baseVal.value+s,a=t.x2.baseVal.value+e,i=t.y2.baseVal.value+s;r.push(["x1",o],["y1",n],["x2",a],["y2",i]);break}case"polygon":case"polyline":{const o=ue(t.getAttribute("points")).map(t=>(t[0]=Number(t[0])+e,t[1]=Number(t[1])+s,t.join(" "))).join(" ");r.push(["points",o]);break}case"path":{const o=t.getAttribute("d");r.push(["d",ye({path:o,dx:e,dy:s})]);break}}r.forEach(e=>{t.setAttribute(e[0],e[1])})},Me=(t,e)=>{const{scaleX:s,scaleY:r,localCTM:o,bBox:{width:n,height:a}}=e,i=[];switch(t.tagName.toLowerCase()){case"text":case"tspan":{const{x:e,y:c,textLength:l}=t.__data__,{x:h,y:u}=ae(o,e,c);i.push(["x",h+(s<0?n:0)],["y",u-(r<0?a:0)],["textLength",Math.abs(s*l)]);break}case"circle":{const{r:e,cx:n,cy:a}=t.__data__,c=e*(Math.abs(s)+Math.abs(r))/2,{x:l,y:h}=ae(o,n,a);i.push(["r",c],["cx",l],["cy",h]);break}case"foreignobject":case"image":case"rect":{const{width:e,height:n,x:a,y:c}=t.__data__,{x:l,y:h}=ae(o,a,c),u=Math.abs(e*s),d=Math.abs(n*r);i.push(["x",l-(s<0?u:0)],["y",h-(r<0?d:0)],["width",u],["height",d]);break}case"ellipse":{const{rx:e,ry:n,cx:a,cy:c}=t.__data__,{x:l,y:h}=ae(o,a,c),u=te();u.a=s,u.d=r;const{x:d,y:p}=ae(u,e,n);i.push(["rx",Math.abs(d)],["ry",Math.abs(p)],["cx",l],["cy",h]);break}case"line":{const{resX1:e,resY1:s,resX2:r,resY2:n}=t.__data__,{x:a,y:c}=ae(o,e,s),{x:l,y:h}=ae(o,r,n);i.push(["x1",a],["y1",c],["x2",l],["y2",h]);break}case"polygon":case"polyline":{const{points:e}=t.__data__,s=ue(e).map(t=>{const{x:e,y:s}=ae(o,Number(t[0]),Number(t[1]));return t[0]=e,t[1]=s,t.join(" ")}).join(" ");i.push(["points",s]);break}case"path":{const{path:e}=t.__data__;i.push(["d",fe({path:e,localCTM:o})]);break}}i.forEach(([e,s])=>{t.setAttribute(e,s)})},Te=(t,e,s)=>{const{rotatable:r,rotatorAnchor:o,rotatorOffset:n}=e,{wrapper:a,handles:l,center:h,transform:{wrapperMatrix:u=oe(a,a.parentNode)}={}}=t;let{boxMatrix:d,element:p}=s;const{x:x,y:y,width:f,height:b}=p.getBBox(),m=f/2,g=b/2,_=u.inverse().multiply(d),v=ae(_,x+m,y+g),E={tl:[x,y],tr:[x+f,y],mr:[x+f,y+g],ml:[x,y+g],tc:[x+m,y],bc:[x+m,y+b],br:[x+f,y+b],bl:[x,y+b],...!h.isShifted&&{center:[x+m,y+g]}},M=Object.entries(E).reduce((t,[e,s])=>(t[e]=ae(_,s[0],s[1]),t),{}),T={te:[M.tl,M.tr],be:[M.bl,M.br],le:[M.tl,M.bl],re:[M.tr,M.br]};if(r){const t={};let e=1;switch(o){case"n":t.x=M.tc.x,t.y=M.tc.y;break;case"s":t.x=M.bc.x,t.y=M.bc.y,e=-1;break;case"w":t.x=M.ml.x,t.y=M.ml.y,e=-1;break;case"e":default:t.x=M.mr.x,t.y=M.mr.y}const s="n"===o||"s"===o?Math.atan2(M.bl.y-M.tl.y,M.bl.x-M.tl.x):Math.atan2(M.tl.y-M.tr.y,M.tl.x-M.tr.x),r=n*e,a={x:t.x-r*Math.cos(s),y:t.y-r*Math.sin(s)},{normal:c,radius:u}=l;i(c)&&(c.x1.baseVal.value=t.x,c.y1.baseVal.value=t.y,c.x2.baseVal.value=a.x,c.y2.baseVal.value=a.y),i(u)&&(u.x1.baseVal.value=v.x,u.y1.baseVal.value=v.y,h.isShifted||(u.x2.baseVal.value=v.x,u.y2.baseVal.value=v.y)),M.rotator=a}Object.keys(T).forEach(t=>{const e=l[t],[s,r]=T[t];c(s)||c(e)||Object.entries({x1:s.x,y1:s.y,x2:r.x,y2:r.y}).map(([t,s])=>e.setAttribute(t,s))}),Object.keys(M).forEach(t=>{const e=l[t],s=M[t];c(s)||c(e)||(e.setAttribute("cx",s.x),e.setAttribute("cy",s.y))})},we=(t,e,s,r)=>{const o=Qt("circle",["sjx-svg-hdl",`sjx-svg-hdl-${r}`]),n={cx:t,cy:e,r:4,fill:"#fff",stroke:s,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"};return Object.entries(n).forEach(([t,e])=>o.setAttribute(t,e)),o},Oe=(t,e)=>{t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},Se=t=>{switch(t.tagName.toLowerCase()){case"text":{const e=i(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,s=i(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,r=i(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null;t.__data__={x:e,y:s,textLength:r};break}case"circle":{const e=t.r.baseVal.value,s=t.cx.baseVal.value,r=t.cy.baseVal.value;t.__data__={r:e,cx:s,cy:r};break}case"foreignobject":case"image":case"rect":{const e=t.width.baseVal.value,s=t.height.baseVal.value,r=t.x.baseVal.value,o=t.y.baseVal.value;t.__data__={width:e,height:s,x:r,y:o};break}case"ellipse":{const e=t.rx.baseVal.value,s=t.ry.baseVal.value,r=t.cx.baseVal.value,o=t.cy.baseVal.value;t.__data__={rx:e,ry:s,cx:r,cy:o};break}case"line":{const e=t.x1.baseVal.value,s=t.y1.baseVal.value,r=t.x2.baseVal.value,o=t.y2.baseVal.value;t.__data__={resX1:e,resY1:s,resX2:r,resY2:o};break}case"polygon":case"polyline":{const e=t.getAttribute("points");t.__data__={points:e};break}case"path":{const e=t.getAttribute("d");t.__data__={path:e};break}}},Re=([t,e],s,r)=>{const o=Qt("line",["sjx-svg-line",`sjx-svg-line-${r}`]),n={x1:t.x,y1:t.y,x2:e.x,y2:e.y,stroke:s,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return Object.entries(n).forEach(([t,e])=>o.setAttribute(t,e)),o},Ne=(t,e,s=t.getBBox())=>{const{x:r,y:o,width:n,height:a}=s;return[[r,o],[r+n,o],[r+n,o+a],[r,o+a]].map(([t,s])=>{const{x:r,y:o}=ae(e,t,s);return[r,o]})};function Ae(t,e){if(this.length){const s=i(e)&&e instanceof S?e:new S;return n.call(this,(e,r)=>(r instanceof SVGElement?le(r)&&e.push(new ve(r,t,s)):e.push(new $t(r,t,s)),e),[])}}const{EMITTER_EVENTS:ke}=g,{E_MOUSEDOWN:De,E_TOUCHSTART:Ve}=_;class Ce extends Y{constructor(t,e){super(t),this.enable(e)}_init(){const{el:t,options:e}=this,s=p(t),{style:r,appendTo:o}=e,n={position:"absolute","z-index":"2147483647",...r};this.storage={css:n,parent:i(o)?p(o)[0]:document.body},s.on(De,this._onMouseDown).on(Ve,this._onTouchStart),ke.slice(0,3).forEach(t=>{this.eventDispatcher.registerEvent(t)})}_processOptions(t){let e={},s=null,r=document,o=()=>{},n=()=>{},a=()=>{},c=()=>{};if(i(t)){const{style:r,appendTo:u,stack:d,onInit:x,onMove:y,onDrop:f,onDestroy:b}=t;e=i(r)&&"object"==typeof r?r:e,s=u||null;const m=i(d)?p(d)[0]:document;o=h(x),n=h(y),a=l(f)?function(t){const{clone:e}=this.storage;B(e,m)&&f.call(this,t,this.el,e)}:()=>{},c=h(b)}this.options={style:e,appendTo:s,stack:r},this.proxyMethods={onInit:o,onDrop:a,onMove:n,onDestroy:c}}_start({clientX:t,clientY:e}){const{storage:s,el:r}=this,{parent:o,css:n}=s,{left:a,top:i}=z(o);n.left=`${t-a}px`,n.top=`${e-i}px`;const c=r.cloneNode(!0);p(c).css(n),s.clientX=t,s.clientY=e,s.cx=t,s.cy=e,s.clone=c,p(o)[0].appendChild(c),this._draw()}_moving({clientX:t,clientY:e}){const{storage:s}=this;s.clientX=t,s.clientY=e,s.doDraw=!0,s.doMove=!0}_end(t){const{storage:s}=this,{clone:r,frameId:o}=s;s.doDraw=!1,e(o),c(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete s.clone)}_animate(){const{storage:e}=this;e.frameId=t(this._animate);const{doDraw:s,clientX:r,clientY:o,cx:n,cy:a}=e;s&&(e.doDraw=!1,this._drag({dx:r-n,dy:o-a}))}_processMove(t,e){const{clone:s}=this.storage,r=`translate(${t}px, ${e}px)`;p(s).css({transform:r,webkitTranform:r,mozTransform:r,msTransform:r,otransform:r})}_destroy(){const{storage:t,proxyMethods:e,el:s}=this;c(t)||(p(s).off(De,this._onMouseDown).off(Ve,this._onTouchStart),e.onDestroy.call(this,s),delete this.storage)}disable(){this._destroy()}}function Ye(t){if(this.length)return o.call(this,e=>new Ce(e,t))}class Pe extends u{drag(){return Ae.call(this,...arguments)}clone(){return Ye.call(this,...arguments)}}function je(t){return new Pe(t)}Object.defineProperty(je,"createObservable",{value:()=>new S}),Object.defineProperty(je,"Subjx",{value:Pe}),Object.defineProperty(je,"Observable",{value:S});export default je;
